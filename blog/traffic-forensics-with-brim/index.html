<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Traffic Forensics with Brim | Infomation Security - Blog</title><meta name="description" content="Lab NoteThe lab is provided by TryHackMe - Creators: heavenraiza &amp; RussianPanda.
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/traffic-forensics-with-brim/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Traffic Forensics with Brim
  "><link rel="canonical" href="https://jayngng.github.io/blog/traffic-forensics-with-brim/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Traffic Forensics with Brim</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> October 10, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//traffic_analysis">traffic_analysis</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blueteam">blueteam</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//soc">soc</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="lab-note"><strong>Lab Note</strong></h2><p>The lab is provided by TryHackMe - Creators: <code class="language-plaintext highlighter-rouge">heavenraiza</code> &amp; <code class="language-plaintext highlighter-rouge">RussianPanda</code>.</p><p>Link to access the lab: <a href="https://tryhackme.com/room/mastermindsxlq">Masterminds</a> (Free lab).</p><p>In this lab, we employ <code class="language-plaintext highlighter-rouge">brim</code> to perform traffic forensics. More info about <code class="language-plaintext highlighter-rouge">brim</code> can be found <a href="https://www.brimdata.io/">here</a>.</p><p>Our goal is to answer the questions in <code class="language-plaintext highlighter-rouge">Task 2</code>, <code class="language-plaintext highlighter-rouge">Task 3</code>, and <code class="language-plaintext highlighter-rouge">Task 4</code> of the <a href="https://tryhackme.com/room/mastermindsxlq">lab</a>.</p><p><br></p><h2 id="task-2---infection-1"><strong>Task 2 - [Infection 1]</strong></h2><p><strong>1. Provide the victim’s IP address.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">192.168.75.249</code>.</p></li><li><p>Query:</p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/1.png" title="brimthm/1.png" alt="brimthm/1.png"></div><p><br></p><p><strong>2. The victim attempted to make HTTP connections to two suspicious domains with the status ‘404 Not Found’. Provide the hosts/domains requested.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">cambiasuhistoria.growlab.es, www.letscompareonline.com</code>.</p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" | cut id.orig_h, id.resp_h, id.resp_p, method,host, uri, status_code | uniq -c</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/2.png" title="brimthm/2.png" alt="brimthm/2.png"></div><p><br></p><p><strong>3. The victim made a successful HTTP connection to one of the domains and received the response_body_len of 1,309 (uncompressed content size of the data tr+ Answerferred from the server). Provide the domain and the destination IP address.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">ww25.gocphongthe.com,199.59.242.153</code>.</p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" | cut id.orig_h, id.resp_h, id.resp_p, method,host, uri, response_body_len | uniq -c</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/3.png" title="brimthm/3.png" alt="brimthm/3.png"></div><p><br></p><p><strong>4. How many unique DNS requests were made to cab[.]myfkn[.]com domain (including the capitalized domain)?</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">7</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="dns" | count() by query | sort -r</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/4.png" title="brimthm/4.png" alt="brimthm/4.png"></div><p><br></p><p><strong>5.Provide the URI of the domain bhaktivrind[.]com that the victim reached out over HTTP.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">/cgi-bin/JBbb8/</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" host=="bhaktivrind.com"</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/5.png" title="brimthm/5.png" alt="brimthm/5.png"></div><p><br></p><p><strong>6. Provide the IP address of the malicious server and the executable that the victim downloaded from the server.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">185.239.243.112,catzx.exe</code>.</p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http"</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/6.png" title="brimthm/6.png" alt="brimthm/6.png"></div><p><br></p><p><strong>7. Based on the information gathered from the second question, provide the name of the malware using VirusTotal.</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">Emotet</code></li></ul><p><br></p><h2 id="task-3---infection-2"><strong>Task 3 - [Infection 2]</strong></h2><p><strong>1. Provide the IP address of the victim machine.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">192.168.75.146</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="conn" | cut id.orig_h, id.resp_p, id.resp_h | sort | uniq</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/7.png" title="brimthm/7.png" alt="brimthm/7.png"></div><p><br></p><p><strong>2. Provide the IP address the victim made the POST connections to.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">5.181.156.252</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">method=="POST" | cut ts, uid, id, method, uri, status_code</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/8.png" title="brimthm/8.png" alt="brimthm/8.png"></div><p><br></p><p><strong>3. How many POST connections were made to the IP address in the previous question?</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">3</code></li></ul><p><br></p><p><strong>4. Provide the domain where the binary was downloaded from.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">hypercustom.top</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" | cut id.orig_h, id.resp_h, id.resp_p, method,host, uri | uniq -c</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/9.png" title="brimthm/9.png" alt="brimthm/9.png"></div><p><br></p><p><strong>5. Provide the name of the binary including the full URI.</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">/jollion/apines.exe</code></li></ul><p><br></p><p><strong>6. Provide the IP address of the domain that hosts the binary.</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">45.95.203.28</code></li></ul><p><br></p><p><strong>7. There were 2 Suricata “A Network Trojan was detected” alerts. What were the source and destination IP addresses?</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">192.168.75.146, 45.95.203.28</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">event_type=="alert" | alerts := union(alert.category) by src_ip, dest_ip</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/10.png" title="brimthm/10.png" alt="brimthm/10.png"></div><p><br></p><p><strong>8. Taking a look at <code class="language-plaintext highlighter-rouge">.top</code> domain in HTTP requests, provide the name of the stealer (Trojan that gathers information from a system) involved in this packet capture using <a href="https://urlhaus.abuse.ch/browse/">URLhaus Database</a>.</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">Redline Stealer</code></li></ul><p><br></p><h2 id="task-4---infection-3"><strong>Task 4 - [Infection 3]</strong></h2><p><strong>1. Provide the IP address of the victim machine.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">192.168.75.232</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" | cut id.orig_h, id.resp_h, id.resp_p, method,host, uri | uniq -c</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/11.png" title="brimthm/11.png" alt="brimthm/11.png"></div><p><br></p><p><strong>2. Provide three C2 domains from which the binaries were downloaded (starting from the earliest to the latest in the timestamp)</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">efhoahegue.ru,afhoahegue.ru,xfhoahegue.ru</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" | cut ts, id.orig_h, id.resp_h, id.resp_p, method,host, uri | uniq -c | sort ts</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/12.png" title="brimthm/12.png" alt="brimthm/12.png"></div><p><br></p><p><strong>3. Provide the IP addresses for all three domains in the previous question.</strong></p><ul><li>Answer: <code class="language-plaintext highlighter-rouge">162.217.98.146, 199.21.76.77, 63.251.106.25</code></li></ul><p><br></p><p><strong>4. How many unique DNS queries were made to the domain associated from the first IP address from the previous answer?</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">2</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="dns" query=="efhoahegue.ru"</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/13.png" title="brimthm/13.png" alt="brimthm/13.png"></div><p><br></p><p><strong>5. How many binaries were downloaded from the above domain in total?</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">5</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">_path=="http" host=="efhoahegue.ru"</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/14.png" title="brimthm/14.png" alt="brimthm/14.png"></div><p><br></p><p><strong>6. Provided the user-agent listed to download the binaries.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0</code></p></li><li><p>Explanation:</p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/15.png" title="brimthm/15.png" alt="brimthm/15.png"></div><p><br></p><p><strong>7. Provide the amount of DNS connections made in total for this packet capture.</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">986</code></p></li><li><p>Query: <code class="language-plaintext highlighter-rouge">count() by _path | sort -r</code></p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/16.png" title="brimthm/16.png" alt="brimthm/16.png"></div><p><br></p><p><strong>8. With some OSINT skills, provide the name of the worm using the first domain you have managed to collect from Question 2. (Please use quotation marks for Google searches, don’t use .ru in your search, and DO NOT interact with the domain directly).</strong></p><ul><li><p>Answer: <code class="language-plaintext highlighter-rouge">Phorphiex</code></p></li><li><p>Explanation:</p></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/brimthm/17.png" title="brimthm/17.png" alt="brimthm/17.png"></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2022 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>