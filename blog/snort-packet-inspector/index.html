<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Traffic Analysis with Snort | Infomation Security - Blog</title><meta name="description" content="OverviewIn this post, we will focus on writing Snort rules to detect real-world attacks based on inspecting and analyzing malicious traffic.
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Cuong (Jay) Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/snort-packet-inspector/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Traffic Analysis with Snort
  "><link rel="canonical" href="https://jayngng.github.io/blog/snort-packet-inspector/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">Home</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Traffic Analysis with Snort</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> September 14, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//traffic_analysis">traffic_analysis</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blue">blue</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//snort">snort</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="overview"><strong>Overview</strong></h2><p>In this post, we will focus on writing Snort rules to detect real-world attacks based on inspecting and analyzing malicious traffic.</p><h5 id="tools-used"><strong>Tools used</strong>:</h5><ul><li><code class="language-plaintext highlighter-rouge">Wireshark</code>.</li><li><code class="language-plaintext highlighter-rouge">Snort</code>.</li><li><code class="language-plaintext highlighter-rouge">tcpdump</code>.</li></ul><p><br></p><h4 id="introduction-to-snort"><strong>Introduction to Snort</strong></h4><p>Snort is an open source <strong>IDS</strong> and <strong>IPS</strong>, it can be used as <strong>packet sniffer</strong> or <strong>packet logger</strong>. With a set of rules, Snort can inspect all traffic and link malicious traffic that match the rules. Depending on the rule, Snort is able to prevent or log the traffic.</p><p>Another powerful function of Snort is <strong>custom rules</strong>. Primarily, those rules allow users to monitor traffic in a more flexible way.</p><p>Let’s us see how to create custom rules in the next sections.</p><p><br></p><h4 id="detect-icmp-request--reply-with-snort"><strong>Detect ICMP request &amp; reply with Snort</strong></h4><p>We start with locating the <code class="language-plaintext highlighter-rouge">local.rules</code> file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>locate local.rules
/etc/nsm/rules/local.rules
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">local.rules</code> file is a compilation of custom rules, where we’ll utilize to write our own rules.</p><p>Generally, our rule will look like the following:</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/snort/rule_overview.png" title="snort/rule_overview.png" alt="snort/rule_overview.png"></div><p>It’s very simple to detect <code class="language-plaintext highlighter-rouge">ICMP request or reply</code>. By default, Snort offers the ability to parse the <code class="language-plaintext highlighter-rouge">icmp</code> protocol in Snort rule.</p><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alert icmp any any -&gt; 192.168.1.0/24 any (msg:"ICMP detect!"; sid:10000001; rev:1;)
</code></pre></div></div><p>Let’s apply the rule against a <code class="language-plaintext highlighter-rouge">icmp.pcap</code> file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>snort <span class="nt">-q</span> <span class="nt">--daq</span> pcap <span class="nt">-A</span> console <span class="nt">-c</span> /etc/nsm/rules/local.rules <span class="nt">-r</span> icmp.pcap
02/21-22:25:18.329311  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 213.16.246.5 -&gt; 192.168.1.2
02/21-22:25:20.717067  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.2 -&gt; 192.168.1.6
02/21-22:25:20.717109  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.6 -&gt; 192.168.1.2
02/21-22:25:21.395044  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.6 -&gt; 192.168.1.2
02/21-22:25:21.722816  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.2 -&gt; 192.168.1.6
02/21-22:25:21.722845  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.6 -&gt; 192.168.1.2
02/21-22:25:22.729727  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.2 -&gt; 192.168.1.6
02/21-22:25:22.729760  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000001:1] ICMP detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>ICMP<span class="o">}</span> 192.168.1.6 -&gt; 192.168.1.2
</code></pre></div></div><p>Just like that, we successfully detect the <code class="language-plaintext highlighter-rouge">ICMP</code> packets.</p><h4 id="detect-buffer-overflow-attack-with-snort"><strong>Detect Buffer Overflow attack with Snort</strong></h4><p>Typically, a <strong>Buffer Overflow</strong> attack will contain a large number of “A” letters.</p><p>Let’s us see that in action utilizing <code class="language-plaintext highlighter-rouge">tcpdump</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tcpdump <span class="nt">-nntttt</span> <span class="nt">-A</span> <span class="nt">-r</span> eternalblue.pcap <span class="s2">"port 445 and src 192.168.1.6 and greater 1000"</span>
...
2019-02-22 17:13:34.451071 IP 192.168.1.6.55018 <span class="o">&gt;</span> 192.168.1.4.445: Flags <span class="o">[</span>P.], <span class="nb">seq </span>2112:6268, ack 40, win 237, options <span class="o">[</span>nop,nop,TS val 325529 ecr 38791], length 4156                         
E..p..@.@.%....................<span class="nv">$.</span>..........                                                                                                                                                   
...........8.SMB3......H....................    ............8.................................................................................................................................
..............................................................................................................................................................................................
..............................................................................................................................................................................................
..............................................................................................................................................................................................
..............................................................................................................................................................................................
.................................................................................................................................AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
...
</code></pre></div></div><p>With <code class="language-plaintext highlighter-rouge">Wireshark</code>, we can also find the same traffic.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/snort/eternal.png" title="snort/eternal.png" alt="snort/eternal.png"></div><p>→ There is a high possibility of attacker mounted an <code class="language-plaintext highlighter-rouge">Eternal Blue BoF</code> exploit against a SMB service.</p><p>Generally, the rule is written based on the following characteristics in the traffic:</p><ul><li>Destination port: 445.</li><li>Content: lots of <code class="language-plaintext highlighter-rouge">A</code> letters.</li></ul><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alert tcp any any -&gt; 192.168.1.0/24 445 (msg:"Possible Eternal Blue BoF detect!"; content:"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"; sid:10000002; rev:3;)
</code></pre></div></div><p>Running <code class="language-plaintext highlighter-rouge">snort</code> against the <code class="language-plaintext highlighter-rouge">eternal.pcap</code> traffic, we’re able to detect the BoF attack.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>snort <span class="nt">-q</span> <span class="nt">--daq</span> pcap <span class="nt">-A</span> console <span class="nt">-c</span> /etc/nsm/rules/local.rules <span class="nt">-r</span> eternalblue.pcap <span class="nt">-k</span> none
...
02/22-22:13:34.463024  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000002:3] Possible Eternal Blue BoF detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>TCP<span class="o">}</span> 192.168.1.6:55018 -&gt; 192.168.1.4:445
02/22-22:13:34.463414  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000002:3] Possible Eternal Blue BoF detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>TCP<span class="o">}</span> 192.168.1.6:55018 -&gt; 192.168.1.4:445
02/22-22:13:34.487892  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000002:3] Possible Eternal Blue BoF detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>TCP<span class="o">}</span> 192.168.1.6:55018 -&gt; 192.168.1.4:445
02/22-22:13:34.488099  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000002:3] Possible Eternal Blue BoF detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>TCP<span class="o">}</span> 192.168.1.6:55018 -&gt; 192.168.1.4:445
...
</code></pre></div></div><ul><li>The switch <code class="language-plaintext highlighter-rouge">-k</code> is to disable checksum.</li></ul><h4 id="detect-heartbleed-with-snort"><strong>Detect Heartbleed with Snort</strong></h4><p><code class="language-plaintext highlighter-rouge">Hearbleed</code> is generally an attack sending a crafted payload with the <strong>payload length</strong> &gt; <strong>actual payload length</strong> for a purpose of leaking memory data.</p><p>It’s worth noticing that <code class="language-plaintext highlighter-rouge">Heartbleed</code> doesn’t have a specific pattern as <code class="language-plaintext highlighter-rouge">Eternal Blue</code> we saw previously. However, to mount the attack, the communication protocols mainly used are <code class="language-plaintext highlighter-rouge">Heartbeat Request/Response</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/snort/heartbeat_req.png" title="snort/heartbeat_req.png" alt="snort/heartbeat_req.png"></div><p>This is also where the data is leaked.</p><p>Let’s us further analyze the <code class="language-plaintext highlighter-rouge">Hearbeat Message (Request)</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/snort/hb_req.png" title="snort/hb_req.png" alt="snort/hb_req.png"></div><p>The output demonstrates two important information:</p><p>→ <strong><em>The actual length of payload is</em></strong>: 0 byte</p><p>→ <strong><em>The crafted length is</em></strong>: 16386 bytes</p><p>Therefore, the packet is spotted as abnormality.</p><p>Now, to write a <code class="language-plaintext highlighter-rouge">Heartbleed</code> rule, we might rely on the <code class="language-plaintext highlighter-rouge">Heartbeat</code> protocol and the port 443.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/snort/hb_hex.png" title="snort/hb_hex.png" alt="snort/hb_hex.png"></div><p>More explanations of the above image:</p><table><tbody><tr><td><strong>Color</strong></td><td><strong>Hex</strong></td><td><strong>Meaning</strong></td></tr><tr><td>Yello</td><td>18</td><td>Content-Type: Heartbeat</td></tr><tr><td>Red</td><td>03 02 00</td><td>Version: TLS 1.1</td></tr></tbody></table><p>Putting everything together, our Snort rule is:</p><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alert tcp any any -&gt; 172.16.121.0/24 443 (msg:"Possible Heartbleed detect!"; content:"|18 03 02 00|"; rawbytes;sid:10000003; rev:1;)
</code></pre></div></div><p>Applying the rule against the traffic, we successfully expose the attack.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>snort <span class="nt">-q</span> <span class="nt">-A</span> console <span class="nt">--daq</span> pcap <span class="nt">-c</span> /etc/nsm/rules/local.rules <span class="nt">-k</span> none <span class="nt">-r</span> PCAPs/heart.pcap
04/16-12:00:41.512593  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:10000003:1] Possible Heartbleed detect! <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Priority: 0] <span class="o">{</span>TCP<span class="o">}</span> 172.16.121.1:64667 -&gt; 172.16.121.150:443
</code></pre></div></div><p>There are far more advanced Snort rules, the aboves are just some basic of Snort. We probably want to write more complex rules in the future posts with Snort.</p><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2024 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>