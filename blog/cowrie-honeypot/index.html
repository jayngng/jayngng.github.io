<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Cowrie Honeypot - Honeypot | Infomation Security - Blog</title><meta name="description" content="Lab Description
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/cowrie-honeypot/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Cowrie Honeypot - Honeypot
  "><link rel="canonical" href="https://jayngng.github.io/blog/cowrie-honeypot/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Cowrie Honeypot - Honeypot</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> October 13, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//honeypot">honeypot</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blueteam">blueteam</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//soc">soc</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="lab-description"><strong>Lab Description</strong></h2><ul><li>The lab is provided by TryHackMe - Creators: <code class="language-plaintext highlighter-rouge">CoolComputerMan</code>.</li><li>Link to access the lab: <a href="https://tryhackme.com/room/introductiontohoneypots">here</a>.</li></ul><p>Our final goal is to comprehend <a href="https://github.com/cowrie/cowrie">Cowrie honeypot</a> and it’s functionalities.</p><p><br></p><h2 id="introduction-to-honeypot"><strong>Introduction to Honeypot</strong></h2><p>Honeypot is an intentionally vulnerable machine used to attract attackers and record their activites.</p><p>Here are some highlights of Honeypot’s utilities:</p><ul><li>Alert administrators of potential breaches.</li><li>Understand adversaries, i.e. tools and techniques used.</li><li>Distract attacker away from real infrastructures. This will lend us more time to respond to the attack.</li></ul><p><br></p><h2 id="types-of-honeypots"><strong>Types of Honeypots</strong></h2><h4 id="honeypot-interactivity-and-classification"><strong>Honeypot Interactivity and Classification</strong></h4><p><strong>1. Low-Interaction</strong></p><p>Offer limitation in terms of activities to the adversaries. Basically, the adversaries will be limited in any post-exploitation actions against the Honeypot.</p><p>For instance, <a href="https://github.com/phin3has/mailoney">SMTP Honeypot</a> by <code class="language-plaintext highlighter-rouge">awhitehatter</code>.</p><p><strong>2. Medium-Interaction</strong></p><p>Emulate real environment such as vulnerable services, and underlying OS, shell and file systems. Yet, attackers cannot fully perform post-exploitation procedures.</p><p><a href="https://github.com/cowrie/cowrie">Cowrie honeypot</a> will be a good example.</p><p><strong>3. High-Interaction</strong></p><p>Is usually a Virtual Machines with intentional vulnerabilities. It is crucial to manage this Honeypot well enough, otherwise, adversaries could abuse it as a foundation to compromise other assets.</p><h4 id="deployment-location"><strong>Deployment Location</strong></h4><p><strong>1. Internal honeypots</strong></p><p>Deployed inside LAN. This is typically used as a monitor of a network to hunt threats from the inside.</p><p><strong>2. External honeypots</strong></p><p>Deployed outside LAN. This is typically used as a monitor from outside of a network. This deployment will give us more data since it is likely to be targeted at all times.</p><p><br></p><h2 id="cowrie-honeypot"><strong>Cowrie Honeypot</strong></h2><p>Cowrie honeypot is a Low-, Medium- Interactive shell. We can try to login via SSH service.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ssh root@10.10.150.41                                                              
root@10.10.150.41<span class="s1">'s password: 

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@acmeweb:~# ls 
root@acmeweb:~# ls -al 
drwx------ 1 root root 4096 2013-04-05 12:25 .
drwxr-xr-x 1 root root 4096 2013-04-05 12:03 ..
drwx------ 1 root root 4096 2013-04-05 11:58 .aptitude
-rw-r--r-- 1 root root  570 2013-04-05 11:52 .bashrc
-rw-r--r-- 1 root root  140 2013-04-05 11:52 .profile
drwx------ 1 root root 4096 2013-04-05 12:05 .ssh
</span></code></pre></div></div><p>We can basically execute any command on the target system. Yet, there are two noticeable things:</p><ul><li>We <strong>can’t</strong> execute any <code class="language-plaintext highlighter-rouge">bash</code> script. This is a limitation of a low and medium honeypot.</li><li>Trying to create a file, we log back in, the file is deleted.</li></ul><p><br></p><h2 id="cowrie-logs"><strong>Cowrie Logs</strong></h2><p>Cowrie offers an outstanding ability to log all events that can track every connection and command handled by the system.</p><p>To demonstrate the idea, let’s us inspect a log file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>cowrie.json | jq <span class="s1">'.message'</span>
<span class="s2">"New connection: 10.4.1.61:40342 (10.10.150.41:22) [session: b51c7f5d06d4]"</span> 
<span class="s2">"Remote SSH version: SSH-2.0-OpenSSH_8.4p1 Debian-6"</span> 
<span class="s2">"SSH client hassh fingerprint: ae8bd7dd09970555aa4c6ed22adbbf56"</span> 
<span class="s2">"login attempt [root/] succeeded"</span> 
<span class="s2">"Terminal Size: 190 46"</span> 
<span class="s2">"request_env: LANG=en_US.UTF-8"</span> 
<span class="o">[]</span> 
<span class="s2">"CMD: ls"</span> 
<span class="s2">"CMD: ls -al"</span> 
<span class="s2">"CMD: cat /etc/passwd"</span> 
<span class="s2">"CMD: su phil"</span> 
<span class="s2">"CMD: su phila"</span> 
<span class="s2">"CMD: ls -al"</span> 
<span class="s2">"CMD: ls /home"</span> 
<span class="s2">"CMD: uname -a"</span> 
<span class="s2">"CMD: bash -c 'whoami'"</span> 
<span class="s2">"CMD: whoami"</span> 
<span class="s2">"CMD: vi test.sh"</span> 
<span class="s2">"CMD: nano test.sh"</span> 
<span class="s2">"CMD: stty"</span> 
<span class="s2">"CMD: echo </span><span class="se">\"</span><span class="s2">whoami</span><span class="se">\"</span><span class="s2"> &gt; test.sh"</span> 
<span class="s2">"CMD: bash test.sh"</span> 
<span class="s2">"Saved redir contents with SHA-256 33e7267d8409d63707706f95f3d67ee9be5fd3a2c6ffc60856c9baeca1ae3ed4 to var/lib/cowrie/downloads/33e7267d8409d63707706f95f3d67ee9be5fd3a2c6ffc60856c9baeca1ae3ed4"</span>                                                                                                                                                                                           
<span class="s2">"Closing TTY Log: var/lib/cowrie/tty/62b86306def6e51672e9dcfb4ced59089ace9c056c0bc9597a0a49d73ae2a40a after 178 seconds"</span> 
<span class="s2">"Connection lost after 183 seconds"</span> 
<span class="s2">"New connection: 10.4.1.61:40344 (10.10.150.41:22) [session: 2eae2e2585fe]"</span> 
<span class="s2">"Remote SSH version: SSH-2.0-OpenSSH_8.4p1 Debian-6"</span> 
<span class="s2">"SSH client hassh fingerprint: ae8bd7dd09970555aa4c6ed22adbbf56"</span> 
<span class="s2">"login attempt [root/] succeeded"</span> 
<span class="s2">"Terminal Size: 190 44"</span> 
<span class="s2">"request_env: LANG=en_US.UTF-8"</span> 
<span class="o">[]</span> 
<span class="s2">"CMD: ls"</span> 
<span class="s2">"CMD: ls -al"</span> 
<span class="s2">"CMD: "</span> 
<span class="s2">"Closing TTY Log: var/lib/cowrie/tty/7b69298197ba2c2d62ad31598e0b47682e290c71ff6b87f5e00c3f78c77f3876 after 179 seconds"</span> 
<span class="s2">"Connection lost after 182 seconds"</span>
</code></pre></div></div><p>As we can see, all the system commands are recorded.</p><p><strong>Note:</strong> we also notice that if with the external honeypots, it’s practically impossible to parse the log using CLI. To have a better vision, it’s recommended to commbine with logging platform such as ELK Stack.</p><p><br></p><h2 id="attacks-against-ssh"><strong>Attacks Against SSH</strong></h2><p>Normally, attacks against the SSH service are done via a famous tool named <code class="language-plaintext highlighter-rouge">hydra</code>. Since Cowrie only leaves one SSH opened, it’s relatively easy to mitigate the attack.</p><p><strong>Defense:</strong></p><ul><li>Strong password.</li><li>Public key authentication.</li><li>Fail2ban</li></ul><p>Those are the most ubiquitous ways to effectively mitigate such attacks.</p><p><br></p><h2 id="typical-post-exploitation-activity"><strong>Typical Post Exploitation Activity</strong></h2><p>Typically, the bot will perform post-exploitation activities such as:</p><ul><li>Check target’s kernel version using <code class="language-plaintext highlighter-rouge">uname</code> or <code class="language-plaintext highlighter-rouge">nproc</code>. Besides, they will try to read contents of files such as <code class="language-plaintext highlighter-rouge">/etc/issue</code> or <code class="language-plaintext highlighter-rouge">/proc/cpuinfo</code>.</li></ul><p>As we notice, Cowrie will return incorrect values of the Debian version when executing <code class="language-plaintext highlighter-rouge">uname -a</code> command.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@acmeweb:~# <span class="nb">cat</span> /etc/issue 
Ubuntu 18.04.5 LTS <span class="se">\n</span> <span class="se">\l</span> <span class="c"># -&gt; Real</span>

root@acmeweb:~# <span class="nb">uname</span> <span class="nt">-a</span> 
Linux acmeweb 3.2.0-4-amd64 <span class="c">#1 SMP Debian 3.2.68-1+deb7u1 x86_64 GNU/Linux</span>
</code></pre></div></div><ul><li><p>Install malicious software using <code class="language-plaintext highlighter-rouge">wget</code> or <code class="language-plaintext highlighter-rouge">curl</code> commands. However, as we mentioned, Cowrie will prevent bash execution to reduce the risks that a Honeypot might take.</p></li><li><p>Delete all logs to prevent forensic activities. Cowrie counters that by logging all activities externally.</p></li></ul><p><br></p><h2 id="identification-techniques"><strong>Identification Techniques</strong></h2><p>After the target is compromised, bots will execute orders of commands to enumerate the target</p><p>For instance, If we investigate the <code class="language-plaintext highlighter-rouge">BotCommands/Sample3.txt</code> file,</p><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
cd ~ &amp;&amp; rm -rf .ssh &amp;&amp; mkdir .ssh &amp;&amp; echo <span class="se">\"</span>ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEArDp4cun2lhr4KUhBGE7VvAcwdli2a8dbnrTOrbMz1+5O73fcBOx8NVbUT0bUanUV9tJ2/9p7+vD0EpZ3Tz/+0kX34uAx1RV/75GVOmNx+9EuWOnvNoaJe0QXxziIg9eLBHpgLMuakb5+BgTFB+rKJAw9u9FSTDengvS8hX1kNFS4Mjux0hJOK8rvcEmPecjdySYMb66nylAKGwCEE6WEQHmd1mUPgHwGQ0hWCwsQk13yCGPK5w6hYp5zYkFnvlC8hGmd4Ww+u97k6pfTGTUbJk14ujvcD9iUKQTTWYYjIIu5PmUux5bsZ0R4WFwdIe6+i6rBLAsPKgAySVKPRK+oRw== mdrfckr<span class="se">\"</span>&gt;&gt;.ssh/authorized_keys &amp;&amp; chmod -R go= ~/.ssh &amp;&amp; cd ~
</code></pre></div></div><p>there is a highly identificable public SSH Key from the <code class="language-plaintext highlighter-rouge">Outlaw</code> group is written into the target system to maintain access.</p><p><br></p><h2 id="ssh-tunnelling"><strong>SSH Tunnelling</strong></h2><p>By default, Cowrie will log and drop all the SSH tunnelling traffic to the destination. This data is beneficial to detect web attacks.</p><p>If we inspect the <code class="language-plaintext highlighter-rouge">Tunnelling/Sample1.txt</code> log, we can see that attacker targets the <code class="language-plaintext highlighter-rouge">wordpress</code> website.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>Sample1.txt 
2021-03-17T10:09:51.052837Z <span class="o">[</span>SSHChannel cowrie-discarded-direct-tcpip <span class="o">(</span>62<span class="o">)</span> on SSHService b<span class="s1">'ssh-connection'</span> on HoneyPotSSHTransport,118939,0.0.0.0] discarded direct-tcp forward request 62 to &lt;A DOMAIN&gt;:80 with data b<span class="s1">'POST /xmlrpc.php HTTP/1.1\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: en-US,en;q=0.9\r\nConnection: keep-alive\r\nContent-Length: 201\r\nContent-Type: application/x-www-form-urlencoded\r\nHost: &lt;A DOMAIN&gt;\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.109 Safari/537.36\r\n\r\n&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;methodCall&gt;&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;admin&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;password11\r&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;
...
</span></code></pre></div></div><p><br></p><h2 id="conclusion"><strong>Conclusion</strong></h2><p>To conclude, Cowrie Honeypot is a great example to demonstrate how attacker’s artifacts are collected for digital forensics activities. Yet, we need to be very careful due to potential risks if it’s not properly configured.</p><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2021 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>