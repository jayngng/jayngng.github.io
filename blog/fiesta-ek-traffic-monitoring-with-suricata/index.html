<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Fiesta EK - Traffic Monitoring with Suricata | Infomation Security - Blog</title><meta name="description" content="DescriptionAnalyze the following packet and answer the questions.
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/fiesta-ek-traffic-monitoring-with-suricata/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Fiesta EK - Traffic Monitoring with Suricata
  "><link rel="canonical" href="https://jayngng.github.io/blog/fiesta-ek-traffic-monitoring-with-suricata/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Fiesta EK - Traffic Monitoring with Suricata</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> September 25, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//traffic_analysis">traffic_analysis</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blueteam">blueteam</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//ek">ek</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 5 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="description"><strong>Description</strong></h2><p>Analyze the following packet and answer the questions.</p><ul><li>Link to download <code class="language-plaintext highlighter-rouge">.pcap</code>: <a href="https://www.malware-traffic-analysis.net/2015/01/18/2015-01-18-traffic-analysis-exercise-1-of-2.pcap.zip">here</a>. (Password: <code class="language-plaintext highlighter-rouge">infected</code>)</li></ul><p><strong>Credit</strong>: <code class="language-plaintext highlighter-rouge">malware-traffic-analysis.net</code>.</p><p><br></p><h2 id="question"><strong>Question</strong></h2><p>For each pcap, answer the following questions:</p><blockquote><p>1) What is the date and time of the activity? 2) What is the IP address of the Windows host that gets infected?<br>3) What is the domain name and IP address of the compromised web site?<br>4) What is the domain name and IP address that delivered the exploit kit (EK)?<br>5) What is the name of the EK?</p></blockquote><p><br></p><h2 id="answer--rationale"><strong>Answer &amp; Rationale</strong></h2><h5 id="1-what-is-the-date-and-time-of-the-activity"><strong>[1]. What is the date and time of the activity?</strong></h5><ul><li><code class="language-plaintext highlighter-rouge">2015-01-08 23:51:21</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/fiesta/1.png" title="fiesta/1.png" alt="fiesta/1.png"></div><h5 id="2-what-is-the-ip-address-of-the-windows-host-that-gets-infected"><strong>[2]. What is the IP address of the Windows host that gets infected?</strong></h5><ul><li><code class="language-plaintext highlighter-rouge">192.168.138.158</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/fiesta/2.png" title="fiesta/2.png" alt="fiesta/2.png"></div><h5 id="3-what-is-the-domain-name-and-ip-address-of-the-compromised-web-site"><strong>[3]. What is the domain name and IP address of the compromised web site?</strong></h5><ul><li>Domain name: <code class="language-plaintext highlighter-rouge">www.subaruoutback.org</code></li><li>IP Address: <code class="language-plaintext highlighter-rouge">108.168.211.93</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/fiesta/3.png" title="fiesta/3.png" alt="fiesta/3.png"></div><h5 id="4-what-is-the-domain-name-and-ip-address-that-delivered-the-exploit-kit-ek"><strong>[4]. What is the domain name and IP address that delivered the exploit kit (EK)?</strong></h5><ul><li>Domain name: <code class="language-plaintext highlighter-rouge">atypefresh.in</code></li><li>IP address: <code class="language-plaintext highlighter-rouge">205.234.186.112</code></li></ul><h5 id="5-what-is-the-ek-name"><strong>[5]. What is the EK name?</strong></h5><ul><li><code class="language-plaintext highlighter-rouge">Fiesta</code> EK.</li></ul><h3 id="snort"><code class="language-plaintext highlighter-rouge">Snort</code></h3><ul><li>Within the Security Onion.</li><li>From the first terminal, <code class="language-plaintext highlighter-rouge">tcpreplay</code> the <code class="language-plaintext highlighter-rouge">1.pcap</code></li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>tcpreplay <span class="nt">-t</span> <span class="nt">-i</span> eth0 1.pcap 
sending out eth0 
processing file: 1.pcap
Actual: 4804 packets <span class="o">(</span>4899622 bytes<span class="o">)</span> sent <span class="k">in </span>0.31 seconds.              Rated: 15805232.0 bps, 120.58 Mbps, 15496.77 pps
Statistics <span class="k">for </span>network device: eth0
        Attempted packets:         4804
        Successful packets:        4804
        Failed packets:            0
        Retried packets <span class="o">(</span>ENOBUFS<span class="o">)</span>: 0
        Retried packets <span class="o">(</span>EAGAIN<span class="o">)</span>:  0
</code></pre></div></div><ul><li>Within the second termial, the <code class="language-plaintext highlighter-rouge">snort</code> rule is triggered.</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>snort <span class="nt">-A</span> console <span class="nt">-c</span> /etc/nsm/securityonion-eth0/snort.conf <span class="nt">-i</span> eth0 <span class="nt">-k</span> none <span class="nt">-q</span> 
09/25-02:51:27.566318  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2019655:5] ET CURRENT_EVENTS Fiesta EK Landing Nov 05 2014 <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 205.234.186.112:80 -&gt; 192.168.138.158:51629
09/25-02:51:27.571936  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51677 -&gt; 205.234.186.112:80
09/25-02:51:27.574725  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018408:1] ET CURRENT_EVENTS Fiesta PDF Exploit Download <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 205.234.186.112:80 -&gt; 192.168.138.158:51677
09/25-02:51:27.644398  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51713 -&gt; 205.234.186.112:80
09/25-02:51:27.731970  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51723 -&gt; 205.234.186.112:80
09/25-02:51:27.754655  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51725 -&gt; 205.234.186.112:80
09/25-02:51:27.755333  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51735 -&gt; 205.234.186.112:80
09/25-02:51:27.797567  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51751 -&gt; 205.234.186.112:80
09/25-02:51:27.861534  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2011582:46] ET POLICY Vulnerable Java Version 1.6.x Detected <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: Potentially Bad Traffic] <span class="o">[</span>Priority: 2] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51989 -&gt; 205.234.186.112:80
09/25-02:51:27.861534  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2014912:6] ET CURRENT_EVENTS Unknown - Java Request  - gt 60char hex-ascii <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51989 -&gt; 205.234.186.112:80
09/25-02:51:27.861534  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2019611:6] ET CURRENT_EVENTS Fiesta Java Exploit/Payload URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51989 -&gt; 205.234.186.112:80
09/25-02:51:27.861534  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: A Network Trojan was detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51989 -&gt; 205.234.186.112:80
</code></pre></div></div><p><br></p><h3 id="suricata"><code class="language-plaintext highlighter-rouge">Suricata</code></h3><ul><li>Offline input.</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>suricata <span class="nt">-c</span> /etc/suricata/suricata.yaml <span class="nt">-r</span> ../../malware-analysis/20150118/1.pcap <span class="nt">-l</span> <span class="nb">.</span>
<span class="nb">cat </span>fast.log | <span class="nb">head</span> <span class="nt">-4</span>
01/08/2015-18:51:31.706476  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: Exploit Kit Activity Detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51682 -&gt; 205.234.186.112:80
01/08/2015-18:51:30.207155  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: Exploit Kit Activity Detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51678 -&gt; 205.234.186.112:80
01/08/2015-18:51:29.324080  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: Exploit Kit Activity Detected] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51666 -&gt; 205.234.186.112:80
01/08/2015-18:51:29.324080  <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>1:2014726:127] ET POLICY Outdated Flash Version M1 <span class="o">[</span><span class="k">**</span><span class="o">]</span> <span class="o">[</span>Classification: Potential Corporate Privacy Violation] <span class="o">[</span>Priority: 1] <span class="o">{</span>TCP<span class="o">}</span> 192.168.138.158:51666 -&gt; 205.234.186.112:80
</code></pre></div></div><ul><li>Reading <code class="language-plaintext highlighter-rouge">eve.json</code> with <code class="language-plaintext highlighter-rouge">evebox</code>.</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>evebox oneshot eve.json                                                                                                                                                              
2021-09-24 23:23:10  INFO evebox::commands::oneshot: Using database filename ./oneshot.sqlite
2021-09-24 23:23:11  INFO evebox::sqlite::init: Found event database schema version <span class="nt">-1</span>        
2021-09-24 23:23:11  INFO evebox::sqlite::init: Initializing SQLite database <span class="o">(</span>sqlite<span class="o">)</span>         
2021-09-24 23:23:11  INFO evebox::sqlite::init: Updating SQLite database to schema version 1 <span class="o">(</span>sqlite<span class="o">)</span>                                                                                         
2021-09-24 23:23:11  INFO evebox::sqlite::init: Updating SQLite database to schema version 2 <span class="o">(</span>sqlite<span class="o">)</span>                                                                                         
2021-09-24 23:23:11  INFO evebox::commands::oneshot: Reading eve.json <span class="o">(</span>166509 bytes<span class="o">)</span>             
</code></pre></div></div><ul><li>Here is how it looks like.</li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/fiesta/4.png" title="fiesta/4.png" alt="fiesta/4.png"></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2021 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>