<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Boss Of The SOC (BOTS) v1 - Threat Hunting with Splunk (I) | Infomation Security - Blog</title><meta name="description" content="Description  The lab is provided by INE - Effectively Using Splunk (S1).  Another very good &amp; free lab: here.
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Cuong (Jay) Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/boss-of-the-soc-bots-v1-events-analysis-with-splunk-i/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Boss Of The SOC (BOTS) v1 - Threat Hunting with Splunk (I)
  "><link rel="canonical" href="https://jayngng.github.io/blog/boss-of-the-soc-bots-v1-events-analysis-with-splunk-i/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">Home</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Boss Of The SOC (BOTS) v1 - Threat Hunting with Splunk (I)</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> August 22, 2023</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//siem">siem</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//traffic_analysis">traffic_analysis</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//soc">soc</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blue">blue</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="description"><strong>Description</strong></h2><ul><li>The lab is provided by INE - Effectively Using Splunk (S1).</li><li>Another very good &amp; free lab: <a href="https://samsclass.info/50/proj/botsv1.htm">here</a>.</li></ul><p>In this post, we’ll proactively hunt for <a href="https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html">Cyber Attack Kill Chain</a> from BOTsv1 dataset using <code class="language-plaintext highlighter-rouge">Splunk</code>.</p><p><br></p><h2 id="step-1---reconnaissance"><strong>Step 1 - Reconnaissance</strong></h2><p>Our organization’s website is <code class="language-plaintext highlighter-rouge">imreallynotbatman.com</code>.</p><p>To begin with, we’ll test if Splunk can access the ingested data by submitting the following query:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" earliest=0</code> with the <code class="language-plaintext highlighter-rouge">Preset: All time</code>.</li></ul><p>We should be able to see the events are adding on as time progesses.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/2.png" title="botsv1/2.png" alt="botsv1/2.png"></div><p>Now, let’s us identify traffic related to the <code class="language-plaintext highlighter-rouge">imreallynotbatman.com</code> website. This can be achieved via the below query:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" imreallynotbatman.com</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/3.png" title="botsv1/3.png" alt="botsv1/3.png"></div><p>There are <code class="language-plaintext highlighter-rouge">78,683</code> events relating to this website. Currently, not all of them are essential to us, we want to narrow down those events to single stream.</p><p>We can observe relevant streams as the following:</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/4.png" title="botsv1/4.png" alt="botsv1/4.png"></div><p><code class="language-plaintext highlighter-rouge">sourcetype</code> of <code class="language-plaintext highlighter-rouge">stream:http</code> is definitely interesting to us, the others are also valuable to check out. For now, we concentrate on the <code class="language-plaintext highlighter-rouge">HTTP</code> traffic.</p><p>In order to list <code class="language-plaintext highlighter-rouge">HTTP</code> streams, we submit the below query:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="stream:http" imreallynotbatman.com</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/5.png" title="botsv1/5.png" alt="botsv1/5.png"></div><p>From the outputs, events are brought down to a decent figure, Yet, it’s still too overwhelming to inspect those traffic manually.</p><p>Good for us, <code class="language-plaintext highlighter-rouge">Splunk</code> is able to sort unique IP addresses. Therefore, we can start investigating the traffic accounting for a large number of requests.</p><p>The query we use here is very similar to the previous one. By adding <code class="language-plaintext highlighter-rouge">... | fields src_ip</code>, we can extract unique source ip address.</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="stream:http" imreallynotbatman.com | fields src_ip</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/6.png" title="botsv1/6.png" alt="botsv1/6.png"></div><p>The addresses - <code class="language-plaintext highlighter-rouge">40.80.148.42</code> and <code class="language-plaintext highlighter-rouge">23.22.63.114</code> involved in most parts of the <code class="language-plaintext highlighter-rouge">HTTP</code> stream. Additionally, there is another approach we can use to count the traffic.</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="stream:http" imreallynotbatman.com | stats count(src_ip) as "Source IP" by src_ip | sort + "Source IP"</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/7.png" title="botsv1/7.png" alt="botsv1/7.png"></div><p>So far, we can safely deduce the <code class="language-plaintext highlighter-rouge">40.80.148.42</code> address is dubious. Now, let’s us further dig into those traffic by specifying <code class="language-plaintext highlighter-rouge">suricata</code> sourcetype.</p><p>The following query will give us a bird’s eye view of all <code class="language-plaintext highlighter-rouge">suricata</code> alerts against this address:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="suricata" src="40.80.148.42" | search event_type=alert | stats count(alert.signature) as "Alert" by alert.signature | sort - "Alert"</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/8.png" title="botsv1/8.png" alt="botsv1/8.png"></div><p>As we can see, multiple attacks are mounted by the APT group. Let’s look at one of the <code class="language-plaintext highlighter-rouge">HTTP</code> request being sent by this adversary. The search is as below:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="stream:http" src="40.80.148.42"</code></li></ul><p>After the query is submitted, we scroll down a little. There is an interesting <code class="language-plaintext highlighter-rouge">HTTP</code> header indicating the existence of <code class="language-plaintext highlighter-rouge">Acunetix</code> vulnerability scanner being used.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/9.png" title="botsv1/9.png" alt="botsv1/9.png"></div><p>If we are interested in victim IP addresses, we can do so by looking up the <code class="language-plaintext highlighter-rouge">dest</code> field. This field reveals us which IP address is targerted by the scanner.</p><p>SPL query to use is same as the previous one.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/10.png" title="botsv1/10.png" alt="botsv1/10.png"></div><p>There are two IP addresses: <code class="language-plaintext highlighter-rouge">192.168.250.70</code> and <code class="language-plaintext highlighter-rouge">192.168.250.40</code>. Obviously, <code class="language-plaintext highlighter-rouge">192.168.250.70</code> is the primary target, which is also the organization’s website.</p><p>If we want to look at <code class="language-plaintext highlighter-rouge">HTTP URI</code> being scanned by this APT group, we can filter the status of <code class="language-plaintext highlighter-rouge">http</code> stream:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="stream:http" status=200 src="40.80.148.42" dest="192.168.250.70" | stats count by uri | sort - count</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/11.png" title="botsv1/11.png" alt="botsv1/11.png"></div><p>Others, we can further inspect the <code class="language-plaintext highlighter-rouge">iis</code> stream for more information:</p><ul><li><code class="language-plaintext highlighter-rouge">index="botsv1" sourcetype="iis"</code></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/12.png" title="botsv1/12.png" alt="botsv1/12.png"></div><p>At this point, we can conclude that the APT group employed <code class="language-plaintext highlighter-rouge">Acunetix</code> vulnerability scanner to perform reconnaissance activities against the <code class="language-plaintext highlighter-rouge">Joomla</code> website hosted on <code class="language-plaintext highlighter-rouge">192.168.250.70</code>.</p><p><br></p><h2 id="step-2---weaponization"><strong>Step 2 - Weaponization</strong></h2><p>In this phase, we’ll start investigating target’s infrastructure and all relevant information related to this APT.</p><p>Bearing with <code class="language-plaintext highlighter-rouge">Splunk</code>, we’re able to derive a relatively good amount of information from <code class="language-plaintext highlighter-rouge">40.80.148.42</code>. Yet, applying same tatiics against the <code class="language-plaintext highlighter-rouge">23.22.63.114</code> address doesn’t yield us a lot of interesting information.</p><p>Now, if we go to the open source such as <a href="https://www.robtex.com/">robtex</a>, or <a href="https://www.threatcrowd.org/">threatcrowd</a> and submit this ip address …</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/13.png" title="botsv1/13.png" alt="botsv1/13.png"></div><p>we can see that this IP address returns some phising domains, which are similar to <strong>Wayne Enterprise</strong>.</p><p>Besides, employing open source like <strong>ThreatCrowd</strong> also reveals us a good deal of information.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/14.png" title="botsv1/14.png" alt="botsv1/14.png"></div><p>Furthermore, if we perform <strong>DNS lookup</strong> against one of the above phising domains, we’ll come across more valuable information i.e. <strong>Email</strong> or <strong>NS</strong>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/15.png" title="botsv1/15.png" alt="botsv1/15.png"></div><p>With the email, we can potentially divulge other infrastructure associated with the APT group.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/16.png" title="botsv1/16.png" alt="botsv1/16.png"></div><p><br></p><h2 id="step-3---delivery-activities"><strong>Step 3 - Delivery Activities</strong></h2><p>In this phase, we want to gather more information, potential malware used by the attackers …</p><p>Website such as <a href="https://www.threatminer.org">ThreatMiner</a> gives us precious information relating to <strong>TTPs</strong> used by the APT.</p><p>Submitting the <code class="language-plaintext highlighter-rouge">23.22.63.114</code> address to <strong>www.threatminer.org</strong> returns a few sample malwares being used by the adversaries …</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/17.png" title="botsv1/17.png" alt="botsv1/17.png"></div><p>Again, if we submit MD5 hashes to open sources as <strong>VirusTotal</strong> or <a href="https://hybrid-analysis.com/sample/ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d?environmentId=100">Hybrid Analysis</a>, we can retrieve metadata about those samples, which is useful in the future investigation.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/botsv1/18.png" title="botsv1/18.png" alt="botsv1/18.png"></div><p><strong>Next post</strong>: we’ll examine <strong>Exploitation</strong>, <strong>Installation</strong>, and <strong>C2</strong> phases used by the APT.</p><p><br></p><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2024 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>