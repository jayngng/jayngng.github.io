<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Splunk - Search Processing Language | Infomation Security - Blog</title><meta name="description" content="Common SPL Commands
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/splunk-search-processing-language/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Splunk - Search Processing Language
  "><link rel="canonical" href="https://jayngng.github.io/blog/splunk-search-processing-language/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Splunk - Search Processing Language</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> August 27, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//siem">siem</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//plunk">plunk</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//soc">soc</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//blue">blue</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 21 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="common-spl-commands"><strong>Common SPL Commands</strong></h1><table><thead><tr><th>Category</th><th>Description</th><th>Commands</th></tr></thead><tbody><tr><td>Sorting Results</td><td>Ordering results and limiting the number of result</td><td><code class="language-plaintext highlighter-rouge">sort</code></td></tr><tr><td>Filtering Results</td><td>Taking a set of events or results and filtering them into a smaller set of results</td><td><code class="language-plaintext highlighter-rouge">search</code>, <code class="language-plaintext highlighter-rouge">where</code>, <code class="language-plaintext highlighter-rouge">dedup</code>, <code class="language-plaintext highlighter-rouge">head</code>, <code class="language-plaintext highlighter-rouge">tail</code></td></tr><tr><td>Grouping Results</td><td>Grouping events so you can see patterns</td><td><code class="language-plaintext highlighter-rouge">transaction</code></td></tr><tr><td>Reporting Results</td><td>Taking search results and generating summary for reporting</td><td><code class="language-plaintext highlighter-rouge">top/rare</code>, <code class="language-plaintext highlighter-rouge">stats</code>, <code class="language-plaintext highlighter-rouge">chart</code>, <code class="language-plaintext highlighter-rouge">timechart</code></td></tr><tr><td>Filtering, Modifying, and Adding fields</td><td>Filtering out or removing some fields to focus on the ones you need, or modifying or adding fields to enrich your results or events.</td><td><code class="language-plaintext highlighter-rouge">fields</code>,<code class="language-plaintext highlighter-rouge">replace</code>,<code class="language-plaintext highlighter-rouge">eval</code>,<code class="language-plaintext highlighter-rouge">rex</code>,<code class="language-plaintext highlighter-rouge">lookup</code></td></tr></tbody></table><hr><h1 id="sorting-results"><strong>Sorting Results</strong></h1><h2 id="sort"><strong>sort</strong></h2><p>The <code class="language-plaintext highlighter-rouge">sort</code> command sorts search results by the specified fields.</p><ul><li>Examples:</li></ul><p><code class="language-plaintext highlighter-rouge">... | sort 0 field1</code></p><p>→ Sort results in ascending order by <code class="language-plaintext highlighter-rouge">field1</code>, returns all results (<code class="language-plaintext highlighter-rouge">0</code> means return everything).</p><p><code class="language-plaintext highlighter-rouge">... | sort field1,-field2</code></p><p>→ Sort <code class="language-plaintext highlighter-rouge">field1</code> in ascending order, and <code class="language-plaintext highlighter-rouge">field2</code> in descending order, returning up to 10,000 results (by default).</p><p><code class="language-plaintext highlighter-rouge">... | sort filename</code></p><p><code class="language-plaintext highlighter-rouge">... | sort num(filename)</code></p><p><code class="language-plaintext highlighter-rouge">... | sort str(filename)</code></p><ul><li>Sort results by <code class="language-plaintext highlighter-rouge">filename</code>.</li></ul><p>→ The first command lets Slunk decide how to sort the field <strong>values</strong>.</p><p>→ The second command asks Splunk to sort <code class="language-plaintext highlighter-rouge">filename</code> <strong>numerically</strong>.</p><p>→ The thrid command tells Splunk to sort the values <strong>lexicographically</strong>. (Lexicographical order: <strong>123, 132, 213, 231, 312, and 321</strong>.)</p><p><em>Note:</em> by default, ascending order is the default order for search results.</p><ul><li>The results might looks like this:</li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/sort_cmd.png" title="splunk/sort_cmd.png" alt="splunk/sort_cmd.png"></div><hr><h1 id="filtering-results"><strong>Filtering Results</strong></h1><p>These commands take the results from a previous command and filter them into a smaller set of results.</p><h2 id="where"><strong>where</strong></h2><ul><li>The <code class="language-plaintext highlighter-rouge">where</code> command filters result based on an expression.</li><li>If the evaluation is successful and the result is <code class="language-plaintext highlighter-rouge">true</code>, the result is retained, otherwise, the result is discarded.</li></ul><p><strong>Example 1</strong>:</p><p><code class="language-plaintext highlighter-rouge">source=job_listings | where salary &gt; industry_average</code></p><ul><li><p>The above example will return a list of jobs that has <code class="language-plaintext highlighter-rouge">salary</code> greater than <code class="language-plaintext highlighter-rouge">industry_average</code>.</p></li><li><p>Or we can also specify an explicit value.</p></li></ul><p><code class="language-plaintext highlighter-rouge">source=job_listings | where salary &gt; 70000</code></p><p><br></p><p><strong>Example 2</strong>:</p><p><code class="language-plaintext highlighter-rouge">... | where distance/time &gt; 100</code></p><p>→ Keep results whose <code class="language-plaintext highlighter-rouge">distance</code> divided by <code class="language-plaintext highlighter-rouge">time</code> is greater than <code class="language-plaintext highlighter-rouge">100</code>.</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/where_cmd.png" title="splunk/where_cmd.png" alt="splunk/where_cmd.png"></div><p><br></p><p><strong>Example 3</strong>:</p><ul><li>Keep results that match the IP address or are in the specified subnet.</li></ul><p><code class="language-plaintext highlighter-rouge">... | where like(src, "10.10.10.%") OR cidrmatch("10.10.10.0/24", dst)</code></p><p><br></p><h2 id="dedup"><strong>dedup</strong></h2><p>→ Primarily used to remove redundant data. → The amount of results are based on <code class="language-plaintext highlighter-rouge">count</code> value.</p><p><strong>Example 1:</strong></p><ul><li>Keeps the first result of each <strong>unique</strong> <code class="language-plaintext highlighter-rouge">host</code>.</li></ul><p><code class="language-plaintext highlighter-rouge">... | dedup host</code></p><ul><li>Keeps each unique <code class="language-plaintext highlighter-rouge">source</code> and sorted by <code class="language-plaintext highlighter-rouge">delay</code> field in descending order.</li></ul><p><code class="language-plaintext highlighter-rouge">... | dedup source sortby -delay</code></p><ul><li>Keeps the first result for each <strong>unique combination</strong> of <code class="language-plaintext highlighter-rouge">source</code> and <code class="language-plaintext highlighter-rouge">host</code>.</li></ul><p><code class="language-plaintext highlighter-rouge">... | dedup source,host</code></p><ul><li>Keeps the first result for each unique <code class="language-plaintext highlighter-rouge">source</code>, <strong>including null value</strong>.</li></ul><p><code class="language-plaintext highlighter-rouge">... | dedup source keepempty=true</code></p><p><strong>Example 2:</strong></p><ul><li>3 are the <code class="language-plaintext highlighter-rouge">count</code>, which means it keeps <code class="language-plaintext highlighter-rouge">3</code> results of each unique <code class="language-plaintext highlighter-rouge">host</code></li></ul><p><code class="language-plaintext highlighter-rouge">... | dedup 3 source</code></p><p><br></p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/dedup.png" title="splunk/dedup.png" alt="splunk/dedup.png"></div><h5 id="tips-and-tricks"><strong>Tips and Tricks</strong>:</h5><ul><li>Keeps all results and remove duplications only, use: <code class="language-plaintext highlighter-rouge">keepevents</code> option.</li><li>Using the <code class="language-plaintext highlighter-rouge">sortby</code> option to filter value.</li><li><code class="language-plaintext highlighter-rouge">keepnull=&lt;true/false&gt;</code> option can be used to override the default behaviors.</li></ul><p><br></p><h2 id="head"><strong>head</strong></h2><ul><li>Returns first <code class="language-plaintext highlighter-rouge">count</code> results.</li><li><strong><em>Note: the oppsite <code class="language-plaintext highlighter-rouge">head</code> is <code class="language-plaintext highlighter-rouge">tail</code>.</em></strong></li></ul><p><strong>For example:</strong></p><ul><li>The following command will return first <code class="language-plaintext highlighter-rouge">5</code> results.</li></ul><p><code class="language-plaintext highlighter-rouge">... | head 5</code></p><ul><li>Following image will best illustrate the concept:</li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/head_command.png" title="splunk/head_command.png" alt="splunk/head_command.png"></div><ul><li>The following command will return the <code class="language-plaintext highlighter-rouge">first</code> events until it reaches an event, which does <strong>NOT</strong> have an <code class="language-plaintext highlighter-rouge">action</code> field with the value <code class="language-plaintext highlighter-rouge">startup</code>.</li><li>In order words, we just want the first <strong>events</strong> with a <code class="language-plaintext highlighter-rouge">startup</code> value.</li></ul><p><code class="language-plaintext highlighter-rouge">... | head (action="startup")</code></p><hr><h1 id="grouping-results"><strong>Grouping Results</strong></h1><h2 id="transaction"><strong>transaction</strong></h2><ul><li>Group all the events, which meet <code class="language-plaintext highlighter-rouge">transaction</code> conditions.</li><li>Here are some examples to clarify the concepts:</li></ul><ol><li><code class="language-plaintext highlighter-rouge">... | transaction clientip maxpause=5s</code><ul><li>The commands will group events:</li></ul><ul><li>Have the same client IP address → <code class="language-plaintext highlighter-rouge">clientip</code>.</li><li>Have no gaps or pauses longer than 5 seconds → <code class="language-plaintext highlighter-rouge">maxpause=5s</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | transaction clientip host maxspan=30s maxpause=5s</code><ul><li>The commands will group events:</li></ul><ul><li>Have the same client IP address. → <code class="language-plaintext highlighter-rouge">clientip</code>.</li><li>Have the same host. → <code class="language-plaintext highlighter-rouge">host</code>.</li><li>First and last event gap of each session <strong>&lt;=</strong> 30 seconds. <code class="language-plaintext highlighter-rouge">maxspan=30s</code>.</li><li>Have no gaps or pauses longer than 5 seconds → <code class="language-plaintext highlighter-rouge">maxpause=5s</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">transaction clientip maxspan=10m maxevents=3</code><ul><li>The commands will group events:</li></ul><ul><li>Have the same client IP address. → <code class="language-plaintext highlighter-rouge">clientip</code>.</li><li>First and last event gap of each session <strong>&lt;=</strong> 10 minutes. <code class="language-plaintext highlighter-rouge">maxspan=10m</code>.</li><li>Mo more than three events.</li></ul></li></ol><p><strong>All together</strong></p><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourcetype=access<span class="err">*</span> | transaction JSESSIONID clientip startwith="signon" endwith="purchase" | where duration &gt; 1
</code></pre></div></div><ul><li>The commands will retrieve web access events → <code class="language-plaintext highlighter-rouge">sourcetype=access*</code>, then<ul><li>Group all events:<ul><li>Have same SESSION ID → <code class="language-plaintext highlighter-rouge">JSESSIONID</code>.</li><li>Have the same client IP address. → <code class="language-plaintext highlighter-rouge">clientip</code>.</li><li>First event contains the string <strong>signon</strong> → <code class="language-plaintext highlighter-rouge">startwith="signon"</code>.</li><li>Last event contains the string <strong>purchase</strong> → <code class="language-plaintext highlighter-rouge">endwith="purchase"</code>.</li></ul></li><li>And filter transactions that took less than 1 second to complete. → <code class="language-plaintext highlighter-rouge">duration &gt; 1</code>.</li></ul></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/transaction.png" title="splunk/transaction.png" alt="splunk/transaction.png"></div><h5 id="take-away-concepts"><strong>Take away concepts</strong></h5><ul><li><p><code class="language-plaintext highlighter-rouge">transaction</code> arguments (<code class="language-plaintext highlighter-rouge">startwith</code>, <code class="language-plaintext highlighter-rouge">endwith</code>) are optional, but some arguments as <code class="language-plaintext highlighter-rouge">clientip</code>, <code class="language-plaintext highlighter-rouge">JSESSIONID</code> must be specified to instruct grouping conditions.</p></li><li><p>Splunk does not need a <code class="language-plaintext highlighter-rouge">conjunction</code> (<code class="language-plaintext highlighter-rouge">field1 AND field2</code>) or disconjunction (<code class="language-plaintext highlighter-rouge">field1 OR field2</code>), <code class="language-plaintext highlighter-rouge">transaction</code> will automatically do it.</p></li></ul><p><strong>For example:</strong> if we search 3 events with query: <code class="language-plaintext highlighter-rouge">transaction host cookie</code>. We might ends up grouping the following events into a single <code class="language-plaintext highlighter-rouge">transaction</code>.</p><ul><li><code class="language-plaintext highlighter-rouge">event=1 host=a</code> → <code class="language-plaintext highlighter-rouge">event1</code></li><li><code class="language-plaintext highlighter-rouge">event=2 host=a cookie=b</code> → <code class="language-plaintext highlighter-rouge">event2</code></li><li><code class="language-plaintext highlighter-rouge">event=3 cookie=b</code> → <code class="language-plaintext highlighter-rouge">event3</code></li></ul><p>→ The first two events (<code class="language-plaintext highlighter-rouge">event1</code> and <code class="language-plaintext highlighter-rouge">event2</code>) will be joined because they have the same host (<code class="language-plaintext highlighter-rouge">host=a</code>). → The two last events (<code class="language-plaintext highlighter-rouge">event2</code> and <code class="language-plaintext highlighter-rouge">event3</code>) will be joined because they have the same cookie (<code class="language-plaintext highlighter-rouge">cookie=b</code>).</p><ul><li>The <code class="language-plaintext highlighter-rouge">transaction</code> command results two important fields:<ul><li><code class="language-plaintext highlighter-rouge">duration</code>: timestamp gap for the first and last events in the transaction.</li><li><code class="language-plaintext highlighter-rouge">eventcount</code>: number of events in the transaction.</li></ul></li><li>Later on, we’ll look at the <code class="language-plaintext highlighter-rouge">stat</code> command. It’s worth noticing that they all aggregate events, but here are a few disintctions:<ul><li><p><code class="language-plaintext highlighter-rouge">stat</code> calculates statistical values on events grouped by the value of fields.</p><p>→ Statistics and human-readable.</p></li><li><p><code class="language-plaintext highlighter-rouge">transaction</code> focuses on how events are grouped by providing various arguments.</p><p>→ Heavily groups the events, presents in raw text and is hard to read.</p></li></ul></li></ul><hr><h1 id="reporting-results"><strong>Reporting Results</strong></h1><p>Reporting commands: <code class="language-plaintext highlighter-rouge">top</code>, <code class="language-plaintext highlighter-rouge">stats</code>, <code class="language-plaintext highlighter-rouge">chart</code> and <code class="language-plaintext highlighter-rouge">timechart</code>.</p><h2 id="top"><strong>top</strong></h2><ul><li><p>Given a list of fields, <code class="language-plaintext highlighter-rouge">top</code> command reports the frequency of those field values, along with their count and percentage.</p></li><li><strong><em>Note: the opposite <code class="language-plaintext highlighter-rouge">top</code> is <code class="language-plaintext highlighter-rouge">rare</code></em></strong>.</li><li>Examples:</li></ul><ol><li><code class="language-plaintext highlighter-rouge">... | top 20 url</code> → The command will return the 20 most common URLs.</li><li><code class="language-plaintext highlighter-rouge">... | top 2 user by host</code> → Return the top 2 frequent users for each host.</li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/top_command.png" title="splunk/top_command.png" alt="splunk/top_command.png"></div><hr><h2 id="stats"><strong>stats</strong></h2><ul><li><p>Is used to calculate aggregate statistics over a dataset.</p></li><li><p>The result might be presented in a table format, and might contain a row which has the aggregation in the incoming result, or a row for each distinct value.</p></li><li>Other commands acts as <code class="language-plaintext highlighter-rouge">stats</code>:<ul><li><code class="language-plaintext highlighter-rouge">chart</code>: returns the same table of results, with rows as arbitrary field.</li><li><code class="language-plaintext highlighter-rouge">timechart</code>: return the same table of results, but the row is set to the internal field, <code class="language-plaintext highlighter-rouge">_time</code>, which allows to chart the results based on a time range.</li></ul></li><li>Examples:</li></ul><ol><li><code class="language-plaintext highlighter-rouge">... | stats dc(host)</code><ul><li>Return the distinct count of <code class="language-plaintext highlighter-rouge">host</code> values.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | stats avg(kbps) by host</code><ul><li>Return the average transfer rate for each <code class="language-plaintext highlighter-rouge">host</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | stats count(eval(method="GET")) as GET, count(eval(method="POST")) as POST by host</code><ul><li>Return the total of requests (<code class="language-plaintext highlighter-rouge">POST</code> and <code class="language-plaintext highlighter-rouge">GET</code>) for each <code class="language-plaintext highlighter-rouge">host</code>. <strong><em>Note: with <code class="language-plaintext highlighter-rouge">as</code>, <code class="language-plaintext highlighter-rouge">POST</code> can be used as a name alias for <code class="language-plaintext highlighter-rouge">count(eval(method="POST"))</code></em></strong>.</li><li>The following image will best demonstrate the idea.</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/stats.png" title="splunk/stats.png" alt="splunk/stats.png"></div><ol><li><code class="language-plaintext highlighter-rouge">... | top limit=100 referer_domain | stats sum(count) as total</code><ul><li>Returns the total number of hits from the top 100 values of <code class="language-plaintext highlighter-rouge">referer_domain</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | stats count, max(Magnitude), min(Magnitude), range(Magnitude), avg(Magnitude) by Region</code><ul><li><code class="language-plaintext highlighter-rouge">Magnitude</code> is just a USGS data.</li><li>As we can see, the query processes the <code class="language-plaintext highlighter-rouge">count</code>, <code class="language-plaintext highlighter-rouge">max</code>, etc. and additional statistic for each <code class="language-plaintext highlighter-rouge">Region</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | stats values(product_type) as Type, values(product_name) as Name, sum(price) as "Revenue" by product_id | rename product_id as "Product ID" | eval Revenue="$".tostring(Revenue,"commas")</code><ul><li>Returna table with <code class="language-plaintext highlighter-rouge">Type</code>, <code class="language-plaintext highlighter-rouge">Name</code> and <code class="language-plaintext highlighter-rouge">Revenue</code> of each <code class="language-plaintext highlighter-rouge">product_id</code>.</li><li>Reformat the <code class="language-plaintext highlighter-rouge">Revenue</code> as <code class="language-plaintext highlighter-rouge">$123,345</code>.</li></ul></li></ol><ul><li>Some useful statistical functions:</li></ul><p>[1]. <strong><em>Mathematical Calculation:</em></strong></p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">avg(X)</code></td><td>Returns average of the values of field X; see also, mean(X) .</td></tr><tr><td><code class="language-plaintext highlighter-rouge">count(X)</code></td><td>Returns the number of occurrences of the field X; to indicate a field value to match, format the X argument as an expression: eval(field=”value”) .</td></tr><tr><td><code class="language-plaintext highlighter-rouge">dc(X)</code></td><td>Returns the count of distinct values of field X.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">max(X)</code></td><td>Returns the maximum value of field X. If the values are non-numeric, the max is determined per lexicographic ordering.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">median(X)</code></td><td>Returns the middle-most value of field X.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">min(X)</code></td><td>Returns the minimum value of field X. If the values are non-numeric, the min is determined per lexicographic ordering.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">mode(X)</code></td><td>Returns the most frequent value of field X.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">perc&lt;percent-num&gt;(X)</code></td><td>Returns the &lt;percent-num&gt;-th value of field X; for example, <code class="language-plaintext highlighter-rouge">perc5(total)</code> returns the 5 th percentile value of the total field.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">range(X)</code></td><td>Returns the difference between the max and min values of field X, provided values are numeric.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">stdev(X)</code></td><td>Returns the sample standard deviation of field X. You can use wildcards when you specify the field name; for example, “delay”, which matches both “delay” and “xdelay”.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">sum(X)</code></td><td>Returns the sum of the values of field X.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">var(X)</code></td><td>Returns the sample variance of field X.</td></tr></tbody></table><p>[2]. <strong><em>Value Selections</em></strong></p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">first(X)</code></td><td>Returns the first value of field X; opposite of last(X) .</td></tr><tr><td><code class="language-plaintext highlighter-rouge">last(X)</code></td><td>Returns the last value of field X; opposite of first(X). Generally, a field’s last value is the most chronologically oldest value.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">list(X)</code></td><td>Returns the list of all values of field X as a multivalue entry. The order of the values matches the order of input events.</td></tr><tr><td><code class="language-plaintext highlighter-rouge">values(X)</code></td><td>Returns a list (as a multivalue entry) of all distinct values of field X, ordered lexicographically.</td></tr></tbody></table><p>[3]. <strong><em><code class="language-plaintext highlighter-rouge">timechart</code> command only.</em></strong> ( <strong><em>Not apply to <code class="language-plaintext highlighter-rouge">chart</code> or <code class="language-plaintext highlighter-rouge">stats</code> command</em></strong>)</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">per_day(X)</code></td><td>Returns the rate of field X per day</td></tr><tr><td><code class="language-plaintext highlighter-rouge">per_hour(X)</code></td><td>Returns the rate of field X per hour</td></tr><tr><td><code class="language-plaintext highlighter-rouge">per_minute(X)</code></td><td>Returns the rate of field X per minute</td></tr><tr><td><code class="language-plaintext highlighter-rouge">per_second(X)</code></td><td>Returns the rate of field X per year</td></tr></tbody></table><p><br></p><h2 id="chart">chart</h2><ul><li>Creates a tabular data output suitable for charting. You can specify the x-axis variable using <code class="language-plaintext highlighter-rouge">over</code> or <code class="language-plaintext highlighter-rouge">by</code>.</li></ul><ol><li><code class="language-plaintext highlighter-rouge">... | chart max(delay) over host</code><ul><li>Return <code class="language-plaintext highlighter-rouge">max(delay)</code> for each value of <code class="language-plaintext highlighter-rouge">host</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | chart max(delay) by size bins=10</code><ul><li>Chart the maximum <code class="language-plaintext highlighter-rouge">delay</code> by <code class="language-plaintext highlighter-rouge">size</code>, where <code class="language-plaintext highlighter-rouge">size</code> is broken down into a maximum of 10 equal-size bucket.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | chart eval(avg(size)/max(delay)) as ratio by host user</code><ul><li>Chart the ratio of the average (mean) <code class="language-plaintext highlighter-rouge">size</code> to the maximum <code class="language-plaintext highlighter-rouge">delay</code> for each distinct <code class="language-plaintext highlighter-rouge">host</code> and <code class="language-plaintext highlighter-rouge">user</code> pair.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | chart dc(clientip) over date_hour by category_id usenull=f</code><ul><li>Chart the number of unique <code class="language-plaintext highlighter-rouge">clientip</code> values per hour by category, <code class="language-plaintext highlighter-rouge">usenull=f</code> excludes fields that don’thave a value.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | chart count over Magnitude by Region useother=f</code><ul><li>Chart the number of earthwakes by <code class="language-plaintext highlighter-rouge">Magnitude</code> and <code class="language-plaintext highlighter-rouge">Region</code>.</li><li>Use the <code class="language-plaintext highlighter-rouge">useother=f</code> argument to not output an <code class="language-plaintext highlighter-rouge">other</code> value for rarer <code class="language-plaintext highlighter-rouge">Regions</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | chart count(eval(method=”GET”)) as GET, count(eval(method=”POST”)) as POST by host</code><ul><li>Chart the number of <code class="language-plaintext highlighter-rouge">GET</code> and <code class="language-plaintext highlighter-rouge">POST</code> page requests that occurred for each Web server ( host )</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/chart_command.png" title="splunk/chart_command.png" alt="splunk/chart_command.png"></div><p><br></p><h2 id="timechart">timechart</h2><ul><li>As the name suggested, the <code class="language-plaintext highlighter-rouge">timechart</code> command creates a chart for statistical aggregation apply to the field against time in the x-axis.</li></ul><p>Example commands:</p><ol><li><code class="language-plaintext highlighter-rouge">... | timechart span=1m avg(CPU) by host</code><ul><li>Chart the average value of CPU usage each minute for each host.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | timechart span=1d count by product-type</code><ul><li>Chart the number of purchases made daily for each type of product daily.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | timechart avg(cpu_seconds) by host | outlier</code><ul><li>Chart the average <code class="language-plaintext highlighter-rouge">cpu_seconds</code> by <code class="language-plaintext highlighter-rouge">host</code> and remote outlying values that may distort the timechart’s y-axis.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | timechart per_hour(eval(method="GET")) as Views, per_hour(eval(action="purchase")) as Purchases</code><ul><li>Chart the number of <code class="language-plaintext highlighter-rouge">Views</code> against the numer of <code class="language-plaintext highlighter-rouge">Purchases</code> hourly. This resolves the question - How many views did not lead to purchases?</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | timechart count(eval(method="GET")) as GET, count(eval(method="POST")) as POST</code><ul><li>Chart the number of page requests over time.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | timechart per_hour(price) by product_name</code><ul><li>Chart hourly revenue for the products that were purchased yesterday.</li><li>The <code class="language-plaintext highlighter-rouge">per_hour()</code> function sums the values of the price field for each item <code class="language-plaintext highlighter-rouge">product_name</code> and scales that sum appropriately depending on the timespan of each bucket.</li></ul></li></ol><ul><li><strong>Tabulated Results:</strong></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/timechart1.png" title="splunk/timechart1.png" alt="splunk/timechart1.png"></div><ul><li><strong>Formatted Timechart:</strong></li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/timechart2.png" title="splunk/timechart2.png" alt="splunk/timechart2.png"></div><hr><h1 id="filtering-modifying-and-adding-fields"><strong>Filtering, Modifying, and Adding Fields</strong></h1><ul><li>These commands in this section will help us to filter, modify and manipulate our search results.</li></ul><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">field</code></td><td>Simplify results by removing some fields</td></tr><tr><td><code class="language-plaintext highlighter-rouge">replave</code></td><td>Make field values become more readable for a particular audience</td></tr><tr><td><code class="language-plaintext highlighter-rouge">eval</code></td><td>Calculate the values of a new field based on other fields</td></tr><tr><td><code class="language-plaintext highlighter-rouge">rex</code></td><td>Create new fields using regular expression, to extracting patterned data into other fields</td></tr><tr><td><code class="language-plaintext highlighter-rouge">lookup</code></td><td>Add fields based on looking at the value in an event, referencing a lookup table, adding the fields in matching rows in the lookup table to your event.</td></tr></tbody></table><p><br></p><h2 id="fields"><strong>fields</strong></h2><ul><li>Remove fields from the search results.</li><li>Example:</li></ul><ol><li><code class="language-plaintext highlighter-rouge">... | fields - field1, field2</code><ul><li>Remove <code class="language-plaintext highlighter-rouge">field1</code> and <code class="language-plaintext highlighter-rouge">field2</code> from the search results.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | fields field1 field2</code><ul><li>Keep only <code class="language-plaintext highlighter-rouge">field1</code> and <code class="language-plaintext highlighter-rouge">field2</code></li></ul></li><li><code class="language-plaintext highlighter-rouge">... | fields field1 error*</code><ul><li>Keep only <code class="language-plaintext highlighter-rouge">field1</code> and all fields, whose name begin with <code class="language-plaintext highlighter-rouge">error</code></li></ul></li><li><code class="language-plaintext highlighter-rouge">... | fields field1 field2 | fields - _*</code><ul><li>Keep only <code class="language-plaintext highlighter-rouge">field1</code> and <code class="language-plaintext highlighter-rouge">field2</code> and remove all internal fields, (which begins with an underscore (<code class="language-plaintext highlighter-rouge">_</code>)). Proceeds with cautions because it might render incorrect results in the future search.</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/field_cmd.png" title="splunk/field_cmd.png" alt="splunk/field_cmd.png"></div><h5 id="take-away"><strong>Take away</strong></h5><ul><li>Internal fields i.e. fields start with underscore are unaffected by the <code class="language-plaintext highlighter-rouge">fields</code> command, unless explicitly specified.</li></ul><p><br></p><h2 id="replace"><strong>replace</strong></h2><ul><li>The <code class="language-plaintext highlighter-rouge">replace</code> command performs a search-and-replace for specified field values with replacement values.</li></ul><p>Examples:</p><ol><li><code class="language-plaintext highlighter-rouge">replace *localhost with localhost in host</code><ul><li>Change any <code class="language-plaintext highlighter-rouge">host</code> value that ends with <code class="language-plaintext highlighter-rouge">localhost</code> to <code class="language-plaintext highlighter-rouge">localhost</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">replace 0 with Critical, 1 with Error in msg_level</code><ul><li>Change <code class="language-plaintext highlighter-rouge">msg_level</code> values of <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">Critical</code>, and change <code class="language-plaintext highlighter-rouge">msg_level</code> values of <code class="language-plaintext highlighter-rouge">1</code> to <code class="language-plaintext highlighter-rouge">Error</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">replace aug with August in start_month end_month</code><ul><li>Change any <code class="language-plaintext highlighter-rouge">start_month</code> or <code class="language-plaintext highlighter-rouge">end_month</code> value of <code class="language-plaintext highlighter-rouge">aug</code> to <code class="language-plaintext highlighter-rouge">August</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">replace 127.0.0.1 with localhost</code><ul><li>Change all field values of <code class="language-plaintext highlighter-rouge">127.0.0.1</code> to <code class="language-plaintext highlighter-rouge">localhost</code>.</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/replace.png" title="splunk/replace.png" alt="splunk/replace.png"></div><p><br></p><h2 id="eval"><strong>eval</strong></h2><ul><li>The <code class="language-plaintext highlighter-rouge">eval</code> command calculates an expression and puts the results into a new field.</li></ul><p>Examples:</p><ol><li><code class="language-plaintext highlighter-rouge">... | eval velocity=distance/time</code><ul><li>Set <code class="language-plaintext highlighter-rouge">velocity</code> to <code class="language-plaintext highlighter-rouge">distance</code> divided by <code class="language-plaintext highlighter-rouge">time</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | eval status = if(error == 200, “OK”, “Error”)</code><ul><li>Set <code class="language-plaintext highlighter-rouge">status</code> to <code class="language-plaintext highlighter-rouge">OK</code> if <code class="language-plaintext highlighter-rouge">error</code> is <code class="language-plaintext highlighter-rouge">200</code>; otherwise set <code class="language-plaintext highlighter-rouge">status</code> to <code class="language-plaintext highlighter-rouge">Error</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | eval sum_of_areas = pi()* pow(radius_a, 2) + pi() * pow(radius_b, 2)</code><ul><li>Set <code class="language-plaintext highlighter-rouge">sum_of_areas</code> to be the sum of the areas of two circles.</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/evak.png" title="splunk/evak.png" alt="splunk/evak.png"></div><hr><h2 id="rex"><strong>rex</strong></h2><ul><li>Extract fields and values that matches a specified Regular Expression.</li></ul><p>Example:</p><ol><li><code class="language-plaintext highlighter-rouge">... | rex “From: (?&lt;from&gt;.*) To: (?&lt;to&gt;.*)”</code><ul><li>Extract from and to fields using regular expressions. If a raw event contains <code class="language-plaintext highlighter-rouge">“From: Susan To: Bob”</code> , then <code class="language-plaintext highlighter-rouge">from=Susan</code> and <code class="language-plaintext highlighter-rouge">to=Bob</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">rex field=savedsearch_id (?&lt;user&gt;\w+);(?&lt;app&gt;\w+); (?&lt;SavedSearchName&gt;\w+)</code><ul><li>Extract <code class="language-plaintext highlighter-rouge">user</code> ,<code class="language-plaintext highlighter-rouge">app</code> , and <code class="language-plaintext highlighter-rouge">SavedSearchName</code> from a field called <code class="language-plaintext highlighter-rouge">savedsearch_id</code>. If <code class="language-plaintext highlighter-rouge">savedsearch_id = “bob;search;my_saved_search”</code> , then <code class="language-plaintext highlighter-rouge">user=bob</code>, <code class="language-plaintext highlighter-rouge">app=search</code>, and <code class="language-plaintext highlighter-rouge">SavedSearchName=my_saved_search</code>.</li></ul></li><li><code class="language-plaintext highlighter-rouge">rex mode=sed “s/(\\d{4}-){3}/XXXX-XXXX-XXXX-/g”</code><ul><li>Use <code class="language-plaintext highlighter-rouge">sed</code> syntax to match the regex to a series of numbers, and replace them with an anonymized string.</li></ul></li></ol><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/rex.png" title="splunk/rex.png" alt="splunk/rex.png"></div><p><br></p><h2 id="lookup"><strong>lookup</strong></h2><ul><li>A <code class="language-plaintext highlighter-rouge">lookup</code> command manually invokes field lookups from a lookup table, enabling you to add field values from an external source.</li></ul><p>Examples:</p><ol><li><code class="language-plaintext highlighter-rouge">... | lookup usertogroup user as local_user OUTPUT group as user_group</code><ul><li>For a lookup table with fields <code class="language-plaintext highlighter-rouge">user</code> and <code class="language-plaintext highlighter-rouge">group</code> , specified in stanza name <code class="language-plaintext highlighter-rouge">usertogroup</code> in <code class="language-plaintext highlighter-rouge">transform.conf</code>, look up the value of each event’s <code class="language-plaintext highlighter-rouge">local_user</code> field.</li><li>For entries that match, the value of the lookup table’s group field is written to the event’s <code class="language-plaintext highlighter-rouge">user_group</code> field.</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | lookup dnslookup host OUTPUT ip</code><ul><li>Given a field lookup named <code class="language-plaintext highlighter-rouge">dnslookup</code> , referencing a Python script that performs a reverse DNS lookup and accepts either a host name or IP address as arguments, match the host name values ( host field in your events to the host name values in the table, and then add the corresponding IP address values to your events (in the ip field).</li></ul></li><li><code class="language-plaintext highlighter-rouge">... | lookup local=true userziplookup user as local_user OUTPUT zip as user_zip</code></li></ol><ul><li>For a local lookup table that is present only in the search head, look up the value of each event’s <code class="language-plaintext highlighter-rouge">user</code> field. For entries that match, the value of the lookup table’s <code class="language-plaintext highlighter-rouge">zip</code> field is written to the event’s <code class="language-plaintext highlighter-rouge">user_zip</code> field.</li></ul><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/splunk/lookup.png" title="splunk/lookup.png" alt="splunk/lookup.png"></div><ul><li>The above commands are not everything about SPL. Yet, those are powerful enough to extract any data in any format.</li></ul><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2023 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>